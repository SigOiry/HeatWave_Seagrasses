<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
    <meta charset="utf-8">
    <meta name="generator" content="quarto-1.5.57">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

    <meta name="author" content="Simon Oiry">
    <meta name="author" content="Bede Ffinian Rowe Davies">
    <meta name="author" content="Philippe Rosa">
    <meta name="author" content="Augustin Debly">
    <meta name="author" content="Maria Laura Zoffoli">
    <meta name="author" content="Anne-Laure Barillé">
    <meta name="author" content="Nicolas Harin">
    <meta name="author" content="Pierre Gernez">
    <meta name="author" content="Laurent Barillé">
    <meta name="dcterms.date" content="2024-10-24">
    <meta name="keywords" content="Remote Sensing, Pigment Composition, Seagrass, Coastal Ecosystems, Heatwaves">

    <title>Draft – Effect of Atmospheric Heatwaves on Reflectance and Pigment Composition of Intertidal Nanozostera noltei – Draft</title>
    <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      div.columns{display: flex; gap: min(4vw, 1.5em);}
      div.column{flex: auto; overflow-x: auto;}
      div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
      ul.task-list{list-style: none;}
      ul.task-list li input[type="checkbox"] {
        width: 0.8em;
        margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
        vertical-align: middle;
      }
      /* CSS for syntax highlighting */
      pre > code.sourceCode { white-space: pre; position: relative; }
      pre > code.sourceCode > span { line-height: 1.25; }
      pre > code.sourceCode > span:empty { height: 1.2em; }
      .sourceCode { overflow: visible; }
      code.sourceCode > span { color: inherit; text-decoration: inherit; }
      div.sourceCode { margin: 1em 0; }
      pre.sourceCode { margin: 0; }
      @media screen {
      div.sourceCode { overflow: auto; }
      }
      @media print {
      pre > code.sourceCode { white-space: pre-wrap; }
      pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
      }
      pre.numberSource code
        { counter-reset: source-line 0; }
      pre.numberSource code > span
        { position: relative; left: -4em; counter-increment: source-line; }
      pre.numberSource code > span > a:first-child::before
        { content: counter(source-line);
          position: relative; left: -1em; text-align: right; vertical-align: baseline;
          border: none; display: inline-block;
          -webkit-touch-callout: none; -webkit-user-select: none;
          -khtml-user-select: none; -moz-user-select: none;
          -ms-user-select: none; user-select: none;
          padding: 0 4px; width: 4em;
        }
      pre.numberSource { margin-left: 3em;  padding-left: 4px; }
      div.sourceCode
        {   }
      @media screen {
      pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
      }
      /* CSS for citations */
      div.csl-bib-body { }
      div.csl-entry {
        clear: both;
        margin-bottom: 0em;
      }
      .hanging-indent div.csl-entry {
        margin-left:2em;
        text-indent:-2em;
      }
      div.csl-left-margin {
        min-width:2em;
        float:left;
      }
      div.csl-right-inline {
        margin-left:2em;
        padding-left:1em;
      }
      div.csl-indent {
        margin-left: 2em;
      }    </style>

    <style>
      body.hypothesis-enabled #quarto-embed-header {
        padding-right: 36px;
      }

      #quarto-embed-header {
        height: 3em;
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: solid 1px;
      }

      #quarto-embed-header h6 {
        font-size: 1.1em;
        padding-top: 0.6em;
        margin-left: 1em;
        margin-right: 1em;
        font-weight: 400;
      }

      #quarto-embed-header a.quarto-back-link,
      #quarto-embed-header a.quarto-download-embed {
        font-size: 0.8em;
        margin-top: 1em;
        margin-bottom: 1em;
        margin-left: 1em;
        margin-right: 1em;
      }

      .quarto-back-container {
        padding-left: 0.5em;
        display: flex;
      }

      .headroom {
          will-change: transform;
          transition: transform 200ms linear;
      }

      .headroom--pinned {
          transform: translateY(0%);
      }

      .headroom--unpinned {
          transform: translateY(-100%);
      }      
    </style>

    <script>
    window.document.addEventListener("DOMContentLoaded", function () {

      var header = window.document.querySelector("#quarto-embed-header");
      const titleBannerEl = window.document.querySelector("body > #title-block-header");
      if (titleBannerEl) {
        titleBannerEl.style.paddingTop = header.clientHeight + "px";
      }
      const contentEl = window.document.getElementById('quarto-content');
      for (const child of contentEl.children) {
        child.style.paddingTop = header.clientHeight + "px";
        child.style.marginTop = "1em";
      }

      // Use the article root if the `back` call doesn't work. This isn't perfect
      // but should typically work
      window.quartoBackToArticle = () => {
        var currentUrl = window.location.href;
        window.history.back();
        setTimeout(() => {
            // if location was not changed in 100 ms, then there is no history back
            if(currentUrl === window.location.href){              
                // redirect to site root
                window.location.href = "index.html";
            }
        }, 100);
      }

      const headroom = new window.Headroom(header, {
        tolerance: 5,
        onPin: function () {
        },
        onUnpin: function () {
        },
      });
      headroom.init();
    });
    </script>

    
<script src="site_libs/manuscript-notebook/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
     <script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>   <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script> 
      <meta name="citation_title" content="Draft -- Effect of Atmospheric Heatwaves on Reflectance and Pigment Composition of Intertidal *Nanozostera noltei*  -- Draft">
<meta name="citation_abstract" content="To be written
">
<meta name="citation_keywords" content="Remote Sensing,Pigment Composition,Seagrass,Coastal Ecosystems,Heatwaves">
<meta name="citation_author" content="Simon Oiry">
<meta name="citation_author" content="Bede Ffinian Rowe Davies">
<meta name="citation_author" content="Philippe Rosa">
<meta name="citation_author" content="Augustin Debly">
<meta name="citation_author" content="Maria Laura Zoffoli">
<meta name="citation_author" content="Anne-Laure Barillé">
<meta name="citation_author" content="Nicolas Harin">
<meta name="citation_author" content="Pierre Gernez">
<meta name="citation_author" content="Laurent Barillé">
<meta name="citation_publication_date" content="2024-10-24">
<meta name="citation_cover_date" content="2024-10-24">
<meta name="citation_year" content="2024">
<meta name="citation_online_date" content="2024-10-24">
<meta name="citation_language" content="en">
<meta name="citation_journal_title" content="Remote Sensing of Environment">
<meta name="citation_reference" content="citation_title=Sen2Cor: Sentinel-2 Atmospheric Correction Processor;,citation_abstract=Sen2Cor is a processor for Sentinel-2 Level-2A product generation and formatting, including atmospheric, terrain, and cirrus correction of Top-Of-Atmosphere Level-1C input data. It provides bottom-of-atmosphere corrected reflectance images in various formats.;,citation_author=European Space Agency;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_publisher=European Space Agency (ESA); https://step.esa.int/main/third-party-plugins-2/sen2cor/;">
<meta name="citation_reference" content="citation_title=Intergovernmental Oceanographic Commission ; Sea Level Monitoring Station - Le Conquet, France (LECY);,citation_author=undefined IOC;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_publisher=https://www.ioc-sealevelmonitoring.org/station.php?code=lecy;">
<meta name="citation_reference" content="citation_title=Service Hydrographique et Océanographique de la Marine ; Références Altimétriques Maritimes: Ports de France métropolitaine et d’outre-mer, Cotes du zéro hydrographique et niveaux caractéristiques de la marée;,citation_author=undefined Shom;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_fulltext_html_url=https://diffusion.shom.fr/references-altimetriques-maritimes-ram.html;,citation_isbn=978-2-11-139505-3;">
<meta name="citation_reference" content="citation_title=Service Hydrographique et Océanographique de la Marine ; Bathymétrie Litto3D® Bretagne 2018-2021;,citation_author=undefined SHOM;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_publisher=https://services.data.shom.fr/geonetwork/srv/fre/catalog.search#/metadata/BATHYMETRIE_LITTO3D_BZH_2018_2021.xml;">
<meta name="citation_reference" content="citation_title=Copernicus Open Access Hub;,citation_abstract=The Copernicus Open Access Hub (previously known as Sentinels Scientific Data Hub) provides free access to Sentinel-1, Sentinel-2, and Sentinel-3 data, among others. Sentinel-2 data offers high-resolution optical imagery for land monitoring, including features like vegetation, soil, water cover, inland waterways, and coastal areas.;,citation_author=European Space Agency;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_publisher=European Space Agency (ESA); https://scihub.copernicus.eu;">
<meta name="citation_reference" content="citation_title=Nearshore and offshore co-occurrence of marine heatwaves and cold-spells;,citation_author=Robert W Schlegel;,citation_author=Eric CJ Oliver;,citation_author=Thomas Wernberg;,citation_author=Albertus J Smit;,citation_publication_date=2017;,citation_cover_date=2017;,citation_year=2017;,citation_volume=151;,citation_journal_title=Progress in Oceanography;,citation_publisher=Elsevier;">
<meta name="citation_reference" content="citation_title=European North West Shelf/Iberia Biscay Irish Seas – High Resolution ODYSSEA Sea Surface Temperature Multi-sensor L3 Observations Reprocessed, E.U. Copernicus Marine Service Information (CMEMS). Marine Data Store (MDS). (Accessed on 17-10-2024);,citation_author=undefined CMEMS;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_doi=10.48670/moi-00311;">
<meta name="citation_reference" content="citation_title=The role of herbivory in structuring tropical seagrass ecosystem service delivery;,citation_author=Abigail L Scott;,citation_author=Paul H York;,citation_author=Clare Duncan;,citation_author=Peter I Macreadie;,citation_author=Rod M Connolly;,citation_author=Megan T Ellis;,citation_author=Jessie C Jarvis;,citation_author=Kristin I Jinks;,citation_author=Helene Marsh;,citation_author=Michael A Rasheed;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;,citation_volume=9;,citation_journal_title=Frontiers in Plant Science;,citation_publisher=Frontiers Media SA;">
<meta name="citation_reference" content="citation_title=Seagrass Ecosystems of Andaman and Nicobar Islands: Status and Future Perspective.;,citation_author=Chatragadda Ramesh;,citation_author=Raju Mohanraju;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;,citation_issue=4;,citation_volume=7;,citation_journal_title=Environmental &amp;amp;amp; Earth Sciences Research Journal;">
<meta name="citation_reference" content="citation_title=The planetary role of seagrass conservation;,citation_author=Richard KF Unsworth;,citation_author=Leanne C Cullen-Unsworth;,citation_author=Benjamin LH Jones;,citation_author=Richard J Lilley;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_issue=6606;,citation_volume=377;,citation_journal_title=Science;,citation_publisher=American Association for the Advancement of Science;">
<meta name="citation_reference" content="citation_title=Blue Carbon stock in Zostera noltei meadows at Ria de Aveiro coastal lagoon (Portugal) over a decade;,citation_author=Ana I Sousa;,citation_author=José Figueiredo Silva;,citation_author=Ana Azevedo;,citation_author=Ana I Lillebø;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_issue=1;,citation_volume=9;,citation_journal_title=Scientific reports;,citation_publisher=Nature Publishing Group UK London;">
<meta name="citation_reference" content="citation_title=Decadal increase in the ecological status of a North-Atlantic intertidal seagrass meadow observed with multi-mission satellite time-series;,citation_author=Maria Laura Zoffoli;,citation_author=Pierre Gernez;,citation_author=Laurent Godet;,citation_author=Steef Peters;,citation_author=Simon Oiry;,citation_author=Laurent Barillé;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_volume=130;,citation_journal_title=Ecological Indicators;,citation_publisher=Elsevier;">
<meta name="citation_reference" content="citation_title=Sentinel-2 remote sensing of Zostera noltei-dominated intertidal seagrass meadows;,citation_author=Maria Laura Zoffoli;,citation_author=Pierre Gernez;,citation_author=Philippe Rosa;,citation_author=Anthony Le Bris;,citation_author=Vittorio E Brando;,citation_author=Anne-Laure Barillé;,citation_author=Nicolas Harin;,citation_author=Steef Peters;,citation_author=Kathrin Poser;,citation_author=Lazaros Spaias;,citation_author=others;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;,citation_volume=251;,citation_journal_title=Remote Sensing of Environment;,citation_publisher=Elsevier;">
<meta name="citation_reference" content="citation_title=Global wetland outlook: state of the world’s wetlands and their services to people;,citation_author=Royal C Gardner;,citation_author=C Finlayson;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;,citation_conference_title=Ramsar convention secretariat;">
<meta name="citation_reference" content="citation_title=Remote sensing in seagrass ecology: coupled dynamics between migratory herbivorous birds and intertidal meadows observed by satellite during four decades;,citation_author=Maria Laura Zoffoli;,citation_author=Pierre Gernez;,citation_author=Simon Oiry;,citation_author=Laurent Godet;,citation_author=Sébastien Dalloyau;,citation_author=Bede Ffinian Rowe Davies;,citation_author=Laurent Barillé;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_issue=3;,citation_volume=9;,citation_journal_title=Remote Sensing in Ecology and Conservation;,citation_publisher=Wiley Online Library;">
<meta name="citation_reference" content="citation_title=Stabilizing effects of seagrass meadows on coastal water benthic food webs;,citation_author=Emilia Jankowska;,citation_author=Loı̈c N Michel;,citation_author=Gilles Lepoint;,citation_author=Maria Włodarska-Kowalczuk;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_volume=510;,citation_journal_title=Journal of Experimental Marine Biology and Ecology;,citation_publisher=Elsevier;">
<meta name="citation_reference" content="citation_title=Accelerating loss of seagrasses across the globe threatens coastal ecosystems;,citation_author=Michelle Waycott;,citation_author=Carlos M Duarte;,citation_author=Tim JB Carruthers;,citation_author=Robert J Orth;,citation_author=William C Dennison;,citation_author=Suzanne Olyarnik;,citation_author=Ainsley Calladine;,citation_author=James W Fourqurean;,citation_author=Kenneth L Heck Jr;,citation_author=A Randall Hughes;,citation_author=others;,citation_publication_date=2009;,citation_cover_date=2009;,citation_year=2009;,citation_issue=30;,citation_volume=106;,citation_journal_title=Proceedings of the national academy of sciences;,citation_publisher=National Acad Sciences;">
<meta name="citation_reference" content="citation_title=Meadow trophic status regulates the nitrogen filter function of tropical seagrasses in seasonally eutrophic coastal waters;,citation_author=Esther Thomsen;,citation_author=Lucia S Herbeck;,citation_author=Inés G Viana;,citation_author=Tim C Jennerjahn;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_issue=8;,citation_volume=68;,citation_journal_title=Limnology and Oceanography;,citation_publisher=Wiley Online Library;">
<meta name="citation_reference" content="citation_title=Bitkilerde ağır metal stresine verilen fizyolojik ve moleküler yanıtlar;,citation_author=Kübra Sevgi;,citation_author=Sema Leblebici;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_issue=4;,citation_volume=7;,citation_journal_title=Journal of Anatolian Environmental and Animal Sciences;,citation_publisher=Bülent VEREP;">
<meta name="citation_reference" content="citation_title=Distribution and localised effects of the invasive ascidian Didemnum perlucidum (Monniot 1983) in an urban estuary;,citation_author=Tiffany Schenk Simpson;,citation_author=Thomas Wernberg;,citation_author=Justin I McDonald;,citation_publication_date=2016;,citation_cover_date=2016;,citation_year=2016;,citation_issue=5;,citation_volume=11;,citation_journal_title=PLoS One;,citation_publisher=Public Library of Science San Francisco, CA USA;">
<meta name="citation_reference" content="citation_title=Heat wave intensity can vary the cumulative effects of multiple environmental stressors on Posidonia oceanica seedlings;,citation_author=Laura Guerrero-Meseguer;,citation_author=Arnaldo Marı́n;,citation_author=Carlos Sanz-Lázaro;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;,citation_volume=159;,citation_journal_title=Marine Environmental Research;,citation_publisher=Elsevier;">
<meta name="citation_reference" content="citation_title=A hierarchical approach to defining marine heatwaves;,citation_author=Alistair J Hobday;,citation_author=Lisa V Alexander;,citation_author=Sarah E Perkins;,citation_author=Dan A Smale;,citation_author=Sandra C Straub;,citation_author=Eric CJ Oliver;,citation_author=Jessica A Benthuysen;,citation_author=Michael T Burrows;,citation_author=Markus G Donat;,citation_author=Ming Feng;,citation_author=others;,citation_publication_date=2016;,citation_cover_date=2016;,citation_year=2016;,citation_volume=141;,citation_journal_title=Progress in oceanography;,citation_publisher=Elsevier;">
<meta name="citation_reference" content="citation_title=On the measurement of heat waves;,citation_author=Sarah E Perkins;,citation_author=Lisa V Alexander;,citation_publication_date=2013;,citation_cover_date=2013;,citation_year=2013;,citation_issue=13;,citation_volume=26;,citation_journal_title=Journal of climate;">
<meta name="citation_reference" content="citation_title=Chronically elevated sea surface temperatures revealed high susceptibility of the eelgrass Zostera marina to winter and spring warming;,citation_author=Yvonne Sawall;,citation_author=Maysa Ito;,citation_author=Christian Pansch;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_issue=12;,citation_volume=66;,citation_journal_title=Limnology and Oceanography;,citation_publisher=Wiley Online Library;">
<meta name="citation_reference" content="citation_title=Physiological and morphological effects of a marine heatwave on the seagrass Cymodocea nodosa;,citation_author=Alizé Deguette;,citation_author=Isabel Barrote;,citation_author=João Silva;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_issue=1;,citation_volume=12;,citation_journal_title=Scientific Reports;,citation_publisher=Nature Publishing Group UK London;">
<meta name="citation_reference" content="citation_title=Effects of a simulated heat wave on photophysiology and gene expression of high-and low-latitude populations of Zostera marina;,citation_author=Gidon Winters;,citation_author=Peter Nelle;,citation_author=Birgit Fricke;,citation_author=Gisep Rauch;,citation_author=Thorsten BH Reusch;,citation_publication_date=2011;,citation_cover_date=2011;,citation_year=2011;,citation_volume=435;,citation_journal_title=Marine Ecology Progress Series;">
<meta name="citation_reference" content="citation_title=Satellite-assisted monitoring of water quality to support the implementation of the Water Framework Directive;,citation_author=E Papathanasopoulou;,citation_author=SGH Simis;,citation_author=K Alikas;,citation_author=A Ansper;,citation_author=J Anttila;,citation_author=A Barillé;,citation_author=L Barillé;,citation_author=V Brando;,citation_author=M Bresciani;,citation_author=M Bučas;,citation_author=others;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_journal_title=EOMORES white paper;">
<meta name="citation_reference" content="citation_title=Vegetation indices, remote sensing and forest monitoring;,citation_author=Alfredo R Huete;,citation_publication_date=2012;,citation_cover_date=2012;,citation_year=2012;,citation_issue=9;,citation_volume=6;,citation_journal_title=Geography Compass;,citation_publisher=Wiley Online Library;">
<meta name="citation_reference" content="citation_title=Agricultural drought detection with MODIS based vegetation health indices in southeast Germany;,citation_author=Simon Kloos;,citation_author=Ye Yuan;,citation_author=Mariapina Castelli;,citation_author=Annette Menzel;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_issue=19;,citation_volume=13;,citation_journal_title=Remote Sensing;,citation_publisher=MDPI;">
<meta name="citation_reference" content="citation_title=Identifying urban vegetation stress factors based on open access remote sensing imagery and field observations;,citation_author=Irina Cârlan;,citation_author=Bogdan-Andrei Mihai;,citation_author=Constantin Nistor;,citation_author=André Große-Stoltenberg;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;,citation_volume=55;,citation_journal_title=Ecological Informatics;,citation_publisher=Elsevier;">
<meta name="citation_reference" content="citation_title=Mangrove vegetation health index analysis by implementing NDVI (normalized difference vegetation index) classification method on sentinel-2 image data case study: Segara Anakan, Kabupaten Cilacap;,citation_author=MR Akbar;,citation_author=PAA Arisanto;,citation_author=BA Sukirno;,citation_author=PH Merdeka;,citation_author=MM Priadhi;,citation_author=S Zallesa;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;,citation_volume=584;,citation_conference_title=IOP Conference Series: Earth and Environmental Science;,citation_conference=IOP Publishing;">
<meta name="citation_reference" content="citation_title=Monitoring vegetation systems in the Great Plains with ERTS;,citation_author=John Wilson Rouse;,citation_author=Rüdiger H Haas;,citation_author=John A Schell;,citation_author=Donald W Deering;,citation_author=others;,citation_publication_date=1974;,citation_cover_date=1974;,citation_year=1974;,citation_issue=1;,citation_volume=351;,citation_journal_title=NASA Spec. Publ;">
<meta name="citation_reference" content="citation_title=Spatially located platform and aerial photography for documentation of grazing impacts on wheat;,citation_author=Mounir Louhaichi;,citation_author=Michael M Borman;,citation_author=Douglas E Johnson;,citation_publication_date=2001;,citation_cover_date=2001;,citation_year=2001;,citation_issue=1;,citation_volume=16;,citation_journal_title=Geocarto International;,citation_publisher=Taylor &amp;amp;amp; Francis;">
<meta name="citation_reference" content="citation_title=heatwaveR: A central algorithm for the detection of heatwaves and cold-spells;,citation_author=Robert W. Schlegel;,citation_author=Albertus J. Smit;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;,citation_issue=27;,citation_doi=10.21105/joss.00821;,citation_volume=3;,citation_journal_title=Journal of Open Source Software;">
<meta name="citation_reference" content="citation_title=Categorizing and naming marine heatwaves;,citation_author=Alistair J Hobday;,citation_author=Eric CJ Oliver;,citation_author=Alex Sen Gupta;,citation_author=Jessica A Benthuysen;,citation_author=Michael T Burrows;,citation_author=Markus G Donat;,citation_author=Neil J Holbrook;,citation_author=Pippa J Moore;,citation_author=Mads S Thomsen;,citation_author=Thomas Wernberg;,citation_author=others;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;,citation_issue=2;,citation_volume=31;,citation_journal_title=Oceanography;,citation_publisher=JSTOR;">
</head>

  <body class="quarto-notebook">
    <div id="quarto-embed-header" class="headroom fixed-top bg-primary">
      
      <a onclick="window.quartoBackToArticle(); return false;" class="btn btn-primary quarto-back-link" href=""><i class="bi bi-caret-left"></i> Back to Article</a>
      <h6><i class="bi bi-journal-code"></i> Article Notebook</h6>

            <a href="./index.qmd" class="btn btn-primary quarto-download-embed" download="index.qmd">Download Source</a>
          </div>

     <header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Draft – Effect of Atmospheric Heatwaves on Reflectance and Pigment Composition of Intertidal <em>Nanozostera noltei</em> – Draft</h1>
          </div>

    
    <div class="quarto-title-meta-container">
      <div class="quarto-title-meta-column-start">
            <div class="quarto-title-meta-author">
          <div class="quarto-title-meta-heading">Authors</div>
          <div class="quarto-title-meta-heading">Affiliations</div>
          
                <div class="quarto-title-meta-contents">
            <p class="author">Simon Oiry <a href="mailto:oirysimon@gmail.com" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> <a href="https://orcid.org/0000-0001-7161-5246" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        Institut des Substances et Organismes de la Mer, ISOMer, Nantes Université, UR 2160, F-44000 Nantes, France
                      </p>
                  </div>
                      <div class="quarto-title-meta-contents">
            <p class="author">Bede Ffinian Rowe Davies </p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        Institut des Substances et Organismes de la Mer, ISOMer, Nantes Université, UR 2160, F-44000 Nantes, France
                      </p>
                  </div>
                      <div class="quarto-title-meta-contents">
            <p class="author">Philippe Rosa </p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        Institut des Substances et Organismes de la Mer, ISOMer, Nantes Université, UR 2160, F-44000 Nantes, France
                      </p>
                  </div>
                      <div class="quarto-title-meta-contents">
            <p class="author">Augustin Debly </p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        Institut des Substances et Organismes de la Mer, ISOMer, Nantes Université, UR 2160, F-44000 Nantes, France
                      </p>
                  </div>
                      <div class="quarto-title-meta-contents">
            <p class="author">Maria Laura Zoffoli </p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        Consiglio Nazionale delle Ricerche, Istituto di Scienze Marine (CNR-ISMAR), 00133 Rome, Italy
                      </p>
                  </div>
                      <div class="quarto-title-meta-contents">
            <p class="author">Anne-Laure Barillé </p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        Bio-littoral, Immeuble Le Nevada, 2 Rue du Château de l’Eraudière, 44300 Nantes, France
                      </p>
                  </div>
                      <div class="quarto-title-meta-contents">
            <p class="author">Nicolas Harin </p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        Bio-littoral, Immeuble Le Nevada, 2 Rue du Château de l’Eraudière, 44300 Nantes, France
                      </p>
                  </div>
                      <div class="quarto-title-meta-contents">
            <p class="author">Pierre Gernez </p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        Institut des Substances et Organismes de la Mer, ISOMer, Nantes Université, UR 2160, F-44000 Nantes, France
                      </p>
                  </div>
                      <div class="quarto-title-meta-contents">
            <p class="author">Laurent Barillé </p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        Institut des Substances et Organismes de la Mer, ISOMer, Nantes Université, UR 2160, F-44000 Nantes, France
                      </p>
                  </div>
                    </div>
        
        <div class="quarto-title-meta">

                      
                <div>
            <div class="quarto-title-meta-heading">Published</div>
            <div class="quarto-title-meta-contents">
              <p class="date">October 24, 2024</p>
            </div>
          </div>
          
                
              </div>
      </div>
      <div class="quarto-title-meta-column-end quarto-other-formats-target">
      </div>
    </div>

    <div>
      <div class="abstract">
        <div class="block-title">Abstract</div>
        <p>To be written</p>
      </div>
    </div>

    <div>
      <div class="keywords">
        <div class="block-title">Keywords</div>
        <p>Remote Sensing, Pigment Composition, Seagrass, Coastal Ecosystems, Heatwaves</p>
      </div>
    </div>

    <div class="quarto-other-links-text-target">
    </div>  </div>
</header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#material-methods" id="toc-material-methods" class="nav-link" data-scroll-target="#material-methods"><span class="header-section-number">2</span> Material &amp; Methods</a>
  <ul class="collapse">
  <li><a href="#observation-of-seagrass-leaves-darkening." id="toc-observation-of-seagrass-leaves-darkening." class="nav-link" data-scroll-target="#observation-of-seagrass-leaves-darkening."><span class="header-section-number">2.1</span> Observation of seagrass leaves darkening.</a>
  <ul class="collapse">
  <li><a href="#field-observation" id="toc-field-observation" class="nav-link" data-scroll-target="#field-observation"><span class="header-section-number">2.1.1</span> Field Observation</a></li>
  <li><a href="#temparature-data-and-identification-of-heatwaves" id="toc-temparature-data-and-identification-of-heatwaves" class="nav-link" data-scroll-target="#temparature-data-and-identification-of-heatwaves"><span class="header-section-number">2.1.2</span> Temparature Data and identification of heatwaves</a></li>
  <li><a href="#satellite-observation" id="toc-satellite-observation" class="nav-link" data-scroll-target="#satellite-observation"><span class="header-section-number">2.1.3</span> Satellite Observation</a></li>
  <li><a href="#emersion-time-of-seagrasses" id="toc-emersion-time-of-seagrasses" class="nav-link" data-scroll-target="#emersion-time-of-seagrasses"><span class="header-section-number">2.1.4</span> Emersion Time of Seagrasses</a></li>
  </ul></li>
  <li><a href="#laboratory-experiment" id="toc-laboratory-experiment" class="nav-link" data-scroll-target="#laboratory-experiment"><span class="header-section-number">2.2</span> Laboratory experiment</a>
  <ul class="collapse">
  <li><a href="#sampling-and-acclimation-of-seagrasses" id="toc-sampling-and-acclimation-of-seagrasses" class="nav-link" data-scroll-target="#sampling-and-acclimation-of-seagrasses"><span class="header-section-number">2.2.1</span> Sampling and acclimation of seagrasses</a></li>
  <li><a href="#experimental-design" id="toc-experimental-design" class="nav-link" data-scroll-target="#experimental-design"><span class="header-section-number">2.2.2</span> Experimental design</a></li>
  <li><a href="#bio-optical-measurmenents-over-seagrass-leaves" id="toc-bio-optical-measurmenents-over-seagrass-leaves" class="nav-link" data-scroll-target="#bio-optical-measurmenents-over-seagrass-leaves"><span class="header-section-number">2.2.3</span> Bio-optical measurmenents over seagrass leaves</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results"><span class="header-section-number">3</span> Results</a>
  <ul class="collapse">
  <li><a href="#heatwaves-of-quiberon" id="toc-heatwaves-of-quiberon" class="nav-link" data-scroll-target="#heatwaves-of-quiberon"><span class="header-section-number">3.1</span> Heatwaves of Quiberon</a>
  <ul class="collapse">
  <li><a href="#spectral-inspection" id="toc-spectral-inspection" class="nav-link" data-scroll-target="#spectral-inspection"><span class="header-section-number">3.1.1</span> Spectral inspection</a></li>
  <li><a href="#radiometric-indices-comparison" id="toc-radiometric-indices-comparison" class="nav-link" data-scroll-target="#radiometric-indices-comparison"><span class="header-section-number">3.1.2</span> Radiometric indices comparison</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#bibliography" id="toc-bibliography" class="nav-link" data-scroll-target="#bibliography"><span class="header-section-number">4</span> Bibliography</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">      

       <div class="cell-container"><div class="cell-decorator"><pre>In [1]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>Intertidal seagrasses play a crucial role in the ecosystem by providing habitats and feeding grounds for various marine species, supporting rich marine biodiversity, and contributing significantly to primary production and carbon sequestration <span class="citation" data-cites="unsworth2022planetary sousa2019blue">(<a href="#ref-sousa2019blue" role="doc-biblioref">Sousa et al., 2019</a>; <a href="#ref-unsworth2022planetary" role="doc-biblioref">Unsworth et al., 2022</a>)</span>. These seagrasses are essential in maintaining the health of coastal ecosystems by stabilizing sediments, filtering water, and serving as indicators of environmental changes due to their sensitivity to water quality variations <span class="citation" data-cites="zoffoli2021decadal">(<a href="#ref-zoffoli2021decadal" role="doc-biblioref">Zoffoli et al., 2021</a>)</span>. The interactions between seagrass meadows and their associated herbivores further enhance the delivery of ecosystem services, including coastal protection and fisheries support <span class="citation" data-cites="jankowska2019stabilizing zoffoli2023remote gardner2018global">(<a href="#ref-gardner2018global" role="doc-biblioref">Gardner and Finlayson, 2018</a>; <a href="#ref-jankowska2019stabilizing" role="doc-biblioref">Jankowska et al., 2019</a>; <a href="#ref-zoffoli2023remote" role="doc-biblioref">Zoffoli et al., 2023</a>)</span>. Understanding and preserving these ecosystems are vital for maintaining the biodiversity and productivity of coastal regions <span class="citation" data-cites="scott2018role ramesh2020seagrass">(<a href="#ref-ramesh2020seagrass" role="doc-biblioref">Ramesh and Mohanraju, 2020</a>; <a href="#ref-scott2018role" role="doc-biblioref">Scott et al., 2018</a>)</span>.</p>
<p>Despite their crucial role in marine ecosystems, intertidal seagrasses face numerous threats that compromise their health and functionality. Coastal development and human activities are primary threats. These activities not only reduce the available habitat for seagrasses but also increase water turbidity, which limits light penetration and hampers photosynthesis <span class="citation" data-cites="waycott2009accelerating">(<a href="#ref-waycott2009accelerating" role="doc-biblioref">Waycott et al., 2009</a>)</span>. Seagrasses are also threatened by nutrient enrichment from agricultural and urban runoff, which can lead to eutrophication. This condition promotes the overgrowth of algal blooms that compete with seagrasses for light and nutrients, further stressing these important plants <span class="citation" data-cites="thomsen2023meadow">(<a href="#ref-thomsen2023meadow" role="doc-biblioref">Thomsen et al., 2023</a>)</span> (Oiry et al.&nbsp;2024). Pollution from industrial and agricultural fields sources introduces harmful chemicals and heavy metals into coastal waters, posing toxic risks to seagrass health. These pollutants can affect the physiological processes of seagrasses, reducing their growth and survival rates <span class="citation" data-cites="sevgi2022bitkilerde">(<a href="#ref-sevgi2022bitkilerde" role="doc-biblioref">Sevgi and Leblebici, 2022</a>)</span> Additionally, invasive species can out compete native seagrasses for resources, altering community structure and function <span class="citation" data-cites="simpson2016distribution">(<a href="#ref-simpson2016distribution" role="doc-biblioref">Simpson et al., 2016</a>)</span>.</p>
<p>Heatwaves, exacerbated by climate change, pose a growing threat to seagrasses. Marine Heatwaves (MHW), defined by <span class="citation" data-cites="hobday2016hierarchical">Hobday et al. (<a href="#ref-hobday2016hierarchical" role="doc-biblioref">2016</a>)</span> as prolonged discrete anomalously warm water events, and Atmospheric Heatwaves (AHW), defined by <span class="citation" data-cites="perkins2013measurement">Perkins and Alexander (<a href="#ref-perkins2013measurement" role="doc-biblioref">2013</a>)</span> as periods of at least three consecutive days with temperatures exceeding the 90th percentile, cause severe physiological stress on seagrasses <span class="citation" data-cites="sawall2021chronically deguette2022physiological">(<a href="#ref-deguette2022physiological" role="doc-biblioref">Deguette et al., 2022</a>; <a href="#ref-sawall2021chronically" role="doc-biblioref">Sawall et al., 2021</a>)</span>. At the interface between the land and oceans, intertidal seagrasses are exposed to both MHW and AHW. Heatwaves have profound impacts on seagrasses, with their effects varying based on species and geographic location. For instance, the seagrass <em>Zostera marina</em> exhibits high susceptibility to elevated sea surface temperatures during winter and spring, leading to advanced flowering, high mortality rates, and reduced biomass <span class="citation" data-cites="sawall2021chronically">(<a href="#ref-sawall2021chronically" role="doc-biblioref">Sawall et al., 2021</a>)</span>. Similarly, <em>Cymodocea nodosa</em> shows increased photosynthetic activity during heatwaves but suffers negative effects on photosynthetic performance and leaf biomass during recovery <span class="citation" data-cites="deguette2022physiological">(<a href="#ref-deguette2022physiological" role="doc-biblioref">Deguette et al., 2022</a>)</span>. Additionally, different populations of <em>Zostera marina</em> along the European thermal gradient exhibit varied photophysiological responses during the recovery phase of heatwaves, indicating differential adaptation capabilities among populations <span class="citation" data-cites="winters2011effects">(<a href="#ref-winters2011effects" role="doc-biblioref">Winters et al., 2011</a>)</span>. These events intensify other stressors, such as overgrazing and seed burial, compromising sexual recruitment <span class="citation" data-cites="guerrero2020heat">(<a href="#ref-guerrero2020heat" role="doc-biblioref">Guerrero-Meseguer et al., 2020</a>)</span>.</p>
<p>Remote sensing is increasingly being used to monitor marine ecosystems, including seagrass meadows. Spectral indices such as the Normalized Difference Vegetation Index (NDVI) and the Soil-Adjusted Vegetation Index (SAVI) are effective for quantifying vegetation health over time <span class="citation" data-cites="huete2012vegetation kloos2021agricultural carlan2020identifying akbar2020mangrove">(<a href="#ref-akbar2020mangrove" role="doc-biblioref">Akbar et al., 2020</a>; <a href="#ref-carlan2020identifying" role="doc-biblioref">Cârlan et al., 2020</a>; <a href="#ref-huete2012vegetation" role="doc-biblioref">Huete, 2012</a>; <a href="#ref-kloos2021agricultural" role="doc-biblioref">Kloos et al., 2021</a>)</span>. By analyzing specific spectral patterns, remote sensing can track changes in seagrass meadows with high temporal and spatial resolution. Europe promotes these techniques through frameworks like the Water Framework Directive and the Marine Strategy Framework Directive, which advocate for habitat mapping using remote sensing technologies to cover large areas and detect long-term trends <span class="citation" data-cites="papathanasopoulou2019satellite">(<a href="#ref-papathanasopoulou2019satellite" role="doc-biblioref">Papathanasopoulou et al., 2019</a>)</span>.</p>
<p>This study aims to experimentally test the hypothesis that warm events, such as atmospheric heatwaves, alter the pigment composition and reflectance of the intertidal seagrass Nanozostera noltei. By linking these changes with satellite remote sensing data, the study seeks to provide insights into how heatwaves affect seagrass meadows and to assess the potential of remote sensing in monitoring these impacts</p>
</section>
<section id="material-methods" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Material &amp; Methods</h1>
<section id="observation-of-seagrass-leaves-darkening." class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="observation-of-seagrass-leaves-darkening."><span class="header-section-number">2.1</span> Observation of seagrass leaves darkening.</h2>
<section id="field-observation" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="field-observation"><span class="header-section-number">2.1.1</span> Field Observation</h3>
<div class="cell-container"><div class="cell-decorator"><pre>In [2]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(exiftoolr)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>image_list <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">"Data/Biolittoral/Bio-Littoral_Drone/OFB2021_Quadrat_Zost_QBR"</span>, <span class="at">recursive =</span> T, <span class="at">full.names =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">path =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">filename =</span> <span class="fu">gsub</span>(<span class="st">".*/"</span>,<span class="st">""</span>,path),</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">lat =</span> <span class="cn">NA</span>,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">lon=</span><span class="cn">NA</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">str_detect</span>(path,<span class="st">"Quadrats"</span>))</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(image_list)) {</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    a <span class="ot">&lt;-</span> exiftoolr<span class="sc">::</span><span class="fu">exif_read</span>(image_list<span class="sc">$</span>path[i])</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    lat_a <span class="ot">&lt;-</span> a<span class="sc">$</span>GPSLatitude</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    lon_B <span class="ot">&lt;-</span> a<span class="sc">$</span>GPSLongitude</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    image_list<span class="sc">$</span>lat[i] <span class="ot">&lt;-</span> lat_a</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    image_list<span class="sc">$</span>lon[i] <span class="ot">&lt;-</span> lon_B</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  } </span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a> <span class="cf">if</span> (<span class="sc">!</span><span class="st">"Target_types"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(image_list)) {</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  image_list<span class="sc">$</span>Target_types <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">titlePanel</span>(<span class="st">"Image Annotation App"</span>),</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sidebarLayout</span>(</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sidebarPanel</span>(</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">uiOutput</span>(<span class="st">"category_ui"</span>),</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">textInput</span>(<span class="st">"new_category"</span>, <span class="st">"Add New Category"</span>),</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>      <span class="fu">actionButton</span>(<span class="st">"add_category_btn"</span>, <span class="st">"Add Category"</span>),</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>      <span class="fu">actionButton</span>(<span class="st">"next_btn"</span>, <span class="st">"Next Image"</span>)</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mainPanel</span>(</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>      <span class="fu">imageOutput</span>(<span class="st">"image_display"</span>, <span class="at">width =</span> <span class="st">"900px"</span>)</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reactive value to keep track of the current image index</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>  current_index <span class="ot">&lt;-</span> <span class="fu">reactiveVal</span>(<span class="dv">1</span>)</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ReactiveValues to store categories</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>  rv <span class="ot">&lt;-</span> <span class="fu">reactiveValues</span>(<span class="at">categories =</span> <span class="fu">character</span>())</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Display the current image</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>image_display <span class="ot">&lt;-</span> <span class="fu">renderImage</span>({</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the current image path</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>    img_path <span class="ot">&lt;-</span> image_list<span class="sc">$</span>path[<span class="fu">current_index</span>()]</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if the image file exists</span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">file.exists</span>(img_path)) {</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(<span class="at">src =</span> img_path, <span class="at">contentType =</span> <span class="st">'image/jpeg'</span>, <span class="at">style =</span> <span class="st">"width:100%; height:auto;"</span>, <span class="at">alt =</span> <span class="st">"Image"</span>)</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(<span class="at">src =</span> <span class="st">"https://via.placeholder.com/400x300?text=Image+Not+Found"</span>, <span class="at">contentType =</span> <span class="st">'image/png'</span>, <span class="at">alt =</span> <span class="st">"Image Not Found"</span>)</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">deleteFile =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate the UI for categories</span></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>category_ui <span class="ot">&lt;-</span> <span class="fu">renderUI</span>({</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(rv<span class="sc">$</span>categories) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>      <span class="fu">checkboxGroupInput</span>(<span class="st">"selected_categories"</span>, <span class="st">"Select Categories:"</span>, <span class="at">choices =</span> rv<span class="sc">$</span>categories)</span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>      tags<span class="sc">$</span><span class="fu">p</span>(<span class="st">"No categories available. Please add a new category."</span>)</span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add new category</span></span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">observeEvent</span>(input<span class="sc">$</span>add_category_btn, {</span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>    new_cat <span class="ot">&lt;-</span> input<span class="sc">$</span>new_category</span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(new_cat) <span class="sc">&amp;&amp;</span> new_cat <span class="sc">!=</span> <span class="st">""</span>) {</span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>      rv<span class="sc">$</span>categories <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(rv<span class="sc">$</span>categories, new_cat))</span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateTextInput</span>(session, <span class="st">"new_category"</span>, <span class="at">value =</span> <span class="st">""</span>)</span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Next button logic</span></span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">observeEvent</span>(input<span class="sc">$</span>next_btn, {</span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get selected categories</span></span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>    selected_cats <span class="ot">&lt;-</span> input<span class="sc">$</span>selected_categories</span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(selected_cats)) {</span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>      selected_cats <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>      selected_cats <span class="ot">&lt;-</span> <span class="fu">paste</span>(selected_cats, <span class="at">collapse =</span> <span class="st">", "</span>)</span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Save the selected categories to 'Target_types' column</span></span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>    image_list<span class="sc">$</span>Target_types[<span class="fu">current_index</span>()] <span class="ot">&lt;&lt;-</span> selected_cats</span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Move to next image</span></span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">current_index</span>() <span class="sc">&lt;</span> <span class="fu">nrow</span>(image_list)) {</span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>      <span class="fu">current_index</span>(<span class="fu">current_index</span>() <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Reset the selected categories input</span></span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateCheckboxGroupInput</span>(session, <span class="st">"selected_categories"</span>, <span class="at">selected =</span> <span class="fu">character</span>(<span class="dv">0</span>))</span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>      <span class="fu">showModal</span>(<span class="fu">modalDialog</span>(</span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"End of Images"</span>,</span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a>        <span class="st">"You have reached the end of the images."</span>,</span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a>        <span class="at">easyClose =</span> <span class="cn">TRUE</span></span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a>      ))</span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(<span class="at">ui =</span> ui, <span class="at">server =</span> server)</span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(image_list, <span class="st">"Data/Biolittoral/Bio-Littoral_Drone/Quadrat_metadata.csv"</span>, <span class="at">row.names =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [3]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>image_list <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../Data/Biolittoral/Bio-Littoral_Drone/Quadrat_metadata.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Target_types <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Bleached_Seagrass"</span>, <span class="st">"Healthy_Seagrasses"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [4]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MapRs)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nngeo)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(smoothr)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rnaturalearth) </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rnaturalearthdata) </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>quadrat_sf <span class="ot">&lt;-</span> image_list <span class="sc">%&gt;%</span> </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>), <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Target_types =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(Target_types,<span class="st">"Mix"</span>) <span class="sc">~</span> <span class="st">"Other"</span>,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">str_detect</span>(Target_types,<span class="st">"Healthy"</span>) <span class="sc">~</span> <span class="st">"Healthy_seagrass"</span>,</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">str_detect</span>(Target_types,<span class="st">"Bleached"</span>) <span class="sc">~</span> <span class="st">"Bleached_seagrass"</span>,</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>                                  T <span class="sc">~</span> <span class="st">"Other"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Target_types <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Bleached_seagrass"</span>,<span class="st">"Healthy_seagrass"</span>))<span class="co"># Assuming your data is in WGS84 (EPSG: 4326)</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>Drone_flight_area <span class="ot">&lt;-</span> <span class="st">"Data/shp/Flight_area_drone.shp"</span> <span class="sc">%&gt;%</span> </span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_sf</span>()</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="do">######  Intertidal mask computing ######</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>lon_min <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">3.15</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>lon_max <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">3.07</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>lat_min <span class="ot">&lt;-</span> <span class="fl">47.54</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>lat_max <span class="ot">&lt;-</span> <span class="fl">47.6</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>poly <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(lon_min,lon_max,lon_max,lon_min),</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(lat_max,lat_max,lat_min,lat_min),</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure the polygon is closed by adding the first point at the end if necessary</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(poly[<span class="dv">1</span>, <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>)] <span class="sc">==</span> poly[<span class="fu">nrow</span>(poly), <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>)])) {</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>  poly <span class="ot">&lt;-</span> <span class="fu">rbind</span>(poly, poly[<span class="dv">1</span>, ])</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a matrix of coordinates</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(poly[, <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>)])</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a list of coordinate matrices (required by st_polygon)</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>polygon_list <span class="ot">&lt;-</span> <span class="fu">list</span>(coords)</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an 'sfc' (simple features geometry list column) object with the appropriate CRS</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>polygon_sfc <span class="ot">&lt;-</span> <span class="fu">st_sfc</span>(<span class="fu">st_polygon</span>(polygon_list), <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32630</span>)</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># CRS 4326 corresponds to WGS84</span></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the 'id' with the geometry to create an 'sf' object</span></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>poly_sf <span class="ot">&lt;-</span> <span class="fu">st_sf</span>(<span class="at">id =</span> <span class="fu">unique</span>(poly<span class="sc">$</span>id), <span class="at">geometry =</span> polygon_sfc)</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>Low_Tide <span class="ot">&lt;-</span> <span class="st">"Data/Sentinel2/S2B_MSIL2A_20230903T110629_N0509_R137_T30TVT_20230903T125637.SAFE"</span> <span class="sc">%&gt;%</span> </span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list.files</span>(<span class="at">pattern =</span> <span class="st">".jp2"</span>, <span class="at">recursive =</span> T, <span class="at">full.names =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">path =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">str_detect</span>(path, <span class="st">"10m"</span>))</span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>High_Tide <span class="ot">&lt;-</span> <span class="st">"Data/Sentinel2/S2B_MSIL2A_20240503T112119_N0510_R037_T30TVT_20240503T130006.SAFE"</span> <span class="sc">%&gt;%</span> </span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list.files</span>(<span class="at">pattern =</span> <span class="st">".jp2"</span>, <span class="at">recursive =</span> T, <span class="at">full.names =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">path =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">str_detect</span>(path, <span class="st">"10m"</span>))</span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>RGB_High <span class="ot">&lt;-</span> <span class="fu">rast</span>(High_Tide<span class="sc">$</span>path[<span class="dv">6</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crop</span>(poly_sf)</span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>RGB_Low <span class="ot">&lt;-</span> <span class="fu">rast</span>(Low_Tide<span class="sc">$</span>path[<span class="dv">6</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crop</span>(poly_sf)</span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a><span class="fu">RGB</span>(RGB_High) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span></span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a><span class="fu">RGB</span>(RGB_Low) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span></span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>NDVI_comp <span class="ot">&lt;-</span> <span class="cf">function</span>(df,mask){</span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a>  B4 <span class="ot">&lt;-</span> (<span class="fu">rast</span>(df<span class="sc">$</span>path[<span class="dv">4</span>])<span class="sc">-</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a>    <span class="fu">crop</span>(mask)</span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>  B8 <span class="ot">&lt;-</span> (<span class="fu">rast</span>(df<span class="sc">$</span>path[<span class="dv">5</span>])<span class="sc">-</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a>    <span class="fu">crop</span>(mask)</span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a>  ndvi <span class="ot">=</span> (B8<span class="sc">-</span>B4)<span class="sc">/</span>(B8<span class="sc">+</span>B4)</span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(ndvi)</span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a> NDVI_High<span class="ot">&lt;-</span> <span class="fu">NDVI_comp</span>(High_Tide,poly_sf)</span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a> NDVI_Low<span class="ot">&lt;-</span> <span class="fu">NDVI_comp</span>(Low_Tide,poly_sf)</span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a>int_mask <span class="ot">&lt;-</span> NDVI_High <span class="sc">&lt;</span> <span class="sc">-</span><span class="fl">0.05</span> <span class="sc">&amp;</span> NDVI_Low <span class="sc">&gt;</span> <span class="fl">0.05</span></span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a><span class="fu">values</span>(int_mask)[<span class="fu">values</span>(int_mask) <span class="sc">==</span> F] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a>mask_sf <span class="ot">&lt;-</span> <span class="fu">as.polygons</span>(int_mask) <span class="sc">%&gt;%</span> </span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"POLYGON"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">area =</span> <span class="fu">st_area</span>(geometry)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">as.numeric</span>(area) <span class="sc">&gt;</span> <span class="dv">6500</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true" tabindex="-1"></a>  nngeo<span class="sc">::</span><span class="fu">st_remove_holes</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true" tabindex="-1"></a>  smoothr<span class="sc">::</span><span class="fu">smooth</span>(<span class="at">method =</span> <span class="st">"ksmooth"</span>, <span class="at">smoothness =</span> <span class="dv">3</span>)</span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-102"><a href="#cb4-102" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mask_sf)</span>
<span id="cb4-103"><a href="#cb4-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-104"><a href="#cb4-104" aria-hidden="true" tabindex="-1"></a><span class="fu">write_sf</span>(mask_sf,<span class="st">"Data/shp/mask_intertidal_quiberon.shp"</span>)</span>
<span id="cb4-105"><a href="#cb4-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-106"><a href="#cb4-106" aria-hidden="true" tabindex="-1"></a><span class="do">########## Geomgrob ##################"</span></span>
<span id="cb4-107"><a href="#cb4-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-108"><a href="#cb4-108" aria-hidden="true" tabindex="-1"></a>sovereignty10 <span class="ot">&lt;-</span> <span class="fu">ne_countries</span>(<span class="at">scale =</span> <span class="dv">10</span>, <span class="at">returnclass =</span> <span class="st">"sf"</span>)</span>
<span id="cb4-109"><a href="#cb4-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-110"><a href="#cb4-110" aria-hidden="true" tabindex="-1"></a>world_map <span class="ot">&lt;-</span> sovereignty10 <span class="sc">%&gt;%</span> </span>
<span id="cb4-111"><a href="#cb4-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb4-112"><a href="#cb4-112" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(sovereignt<span class="sc">%in%</span><span class="fu">c</span>(<span class="st">"Spain"</span>,<span class="st">"France"</span>,<span class="st">"Portugal"</span>,</span>
<span id="cb4-113"><a href="#cb4-113" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Italy"</span>,<span class="st">"Andorra"</span>,</span>
<span id="cb4-114"><a href="#cb4-114" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"United Kingdom"</span>,</span>
<span id="cb4-115"><a href="#cb4-115" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Switzerland"</span>,<span class="st">"Belgium"</span>,</span>
<span id="cb4-116"><a href="#cb4-116" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Germany"</span>,<span class="st">"Luxembourg"</span>) ) </span>
<span id="cb4-117"><a href="#cb4-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-118"><a href="#cb4-118" aria-hidden="true" tabindex="-1"></a>bbox_europe <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(<span class="fu">c</span>(<span class="at">xmin =</span> <span class="sc">-</span><span class="dv">20</span>, <span class="at">ymin =</span> <span class="dv">34</span>,</span>
<span id="cb4-119"><a href="#cb4-119" aria-hidden="true" tabindex="-1"></a>                         <span class="at">xmax =</span> <span class="dv">20</span>, <span class="at">ymax =</span> <span class="dv">55</span>) ,</span>
<span id="cb4-120"><a href="#cb4-120" aria-hidden="true" tabindex="-1"></a>                       <span class="at">crs =</span> <span class="fu">st_crs</span>(world_map) ) </span>
<span id="cb4-121"><a href="#cb4-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-122"><a href="#cb4-122" aria-hidden="true" tabindex="-1"></a>world_map<span class="ot">&lt;-</span><span class="fu">st_make_valid</span>(world_map) </span>
<span id="cb4-123"><a href="#cb4-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-124"><a href="#cb4-124" aria-hidden="true" tabindex="-1"></a>european_union_map_cropped <span class="ot">&lt;-</span> <span class="fu">st_crop</span>(world_map, bbox_europe)  <span class="sc">%&gt;%</span> </span>
<span id="cb4-125"><a href="#cb4-125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="st">"+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +units=m +no_defs "</span>)  </span>
<span id="cb4-126"><a href="#cb4-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-127"><a href="#cb4-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-128"><a href="#cb4-128" aria-hidden="true" tabindex="-1"></a>UnitedKingdom<span class="ot">&lt;-</span>sovereignty10 <span class="sc">%&gt;%</span> </span>
<span id="cb4-129"><a href="#cb4-129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb4-130"><a href="#cb4-130" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(sovereignt<span class="sc">%in%</span><span class="fu">c</span>(<span class="st">"United Kingdom"</span>) ) <span class="sc">%&gt;%</span> </span>
<span id="cb4-131"><a href="#cb4-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"POLYGON"</span>) </span>
<span id="cb4-132"><a href="#cb4-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-133"><a href="#cb4-133" aria-hidden="true" tabindex="-1"></a>bbox_UK <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(<span class="fu">c</span>(<span class="at">xmin =</span> <span class="sc">-</span><span class="dv">20</span>, <span class="at">ymin =</span> <span class="dv">45</span>,</span>
<span id="cb4-134"><a href="#cb4-134" aria-hidden="true" tabindex="-1"></a>                         <span class="at">xmax =</span> <span class="dv">20</span>, <span class="at">ymax =</span> <span class="dv">55</span>) ,</span>
<span id="cb4-135"><a href="#cb4-135" aria-hidden="true" tabindex="-1"></a>                       <span class="at">crs =</span> <span class="fu">st_crs</span>(UnitedKingdom) ) </span>
<span id="cb4-136"><a href="#cb4-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-137"><a href="#cb4-137" aria-hidden="true" tabindex="-1"></a>UnitedKingdom<span class="ot">&lt;-</span><span class="fu">st_make_valid</span>(UnitedKingdom) </span>
<span id="cb4-138"><a href="#cb4-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-139"><a href="#cb4-139" aria-hidden="true" tabindex="-1"></a>UK_map_cropped <span class="ot">&lt;-</span> <span class="fu">st_crop</span>(UnitedKingdom, bbox_UK)  <span class="sc">%&gt;%</span> </span>
<span id="cb4-140"><a href="#cb4-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="st">"+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +units=m +no_defs "</span>) </span>
<span id="cb4-141"><a href="#cb4-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-142"><a href="#cb4-142" aria-hidden="true" tabindex="-1"></a>Europe_sf<span class="ot">&lt;-</span>european_union_map_cropped <span class="sc">%&gt;%</span> </span>
<span id="cb4-143"><a href="#cb4-143" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(UK_map_cropped) </span>
<span id="cb4-144"><a href="#cb4-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-145"><a href="#cb4-145" aria-hidden="true" tabindex="-1"></a>Miniworld_map <span class="ot">&lt;-</span> sovereignty10 <span class="sc">%&gt;%</span> </span>
<span id="cb4-146"><a href="#cb4-146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>()</span>
<span id="cb4-147"><a href="#cb4-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-148"><a href="#cb4-148" aria-hidden="true" tabindex="-1"></a><span class="fu">sf_use_s2</span>(<span class="cn">FALSE</span>)</span>
<span id="cb4-149"><a href="#cb4-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-150"><a href="#cb4-150" aria-hidden="true" tabindex="-1"></a>bbox_EU <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(<span class="fu">c</span>(<span class="at">xmin =</span> <span class="sc">-</span><span class="dv">30</span>, <span class="at">ymin =</span> <span class="dv">20</span>,</span>
<span id="cb4-151"><a href="#cb4-151" aria-hidden="true" tabindex="-1"></a>                         <span class="at">xmax =</span> <span class="dv">50</span>, <span class="at">ymax =</span> <span class="dv">70</span>) ,</span>
<span id="cb4-152"><a href="#cb4-152" aria-hidden="true" tabindex="-1"></a>                       <span class="at">crs =</span> <span class="fu">st_crs</span>(Miniworld_map) ) </span>
<span id="cb4-153"><a href="#cb4-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-154"><a href="#cb4-154" aria-hidden="true" tabindex="-1"></a>MiniEU_map<span class="ot">&lt;-</span><span class="fu">st_crop</span>(Miniworld_map, bbox_EU)  <span class="sc">%&gt;%</span> </span>
<span id="cb4-155"><a href="#cb4-155" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="st">"+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +units=m +no_defs "</span>)  </span>
<span id="cb4-156"><a href="#cb4-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-157"><a href="#cb4-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-158"><a href="#cb4-158" aria-hidden="true" tabindex="-1"></a>scaleFUN <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">paste0</span>(<span class="fu">sprintf</span>(<span class="st">"%.2f"</span>, x),<span class="st">"°N"</span>)</span>
<span id="cb4-159"><a href="#cb4-159" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-160"><a href="#cb4-160" aria-hidden="true" tabindex="-1"></a>Quiberon_Location <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb4-161"><a href="#cb4-161" aria-hidden="true" tabindex="-1"></a>  <span class="at">lon =</span> <span class="fu">mean</span>(<span class="fu">c</span>(lon_max,lon_min)),</span>
<span id="cb4-162"><a href="#cb4-162" aria-hidden="true" tabindex="-1"></a>  <span class="at">lat =</span> <span class="fu">mean</span>(<span class="fu">c</span>(lat_max,lat_min)),</span>
<span id="cb4-163"><a href="#cb4-163" aria-hidden="true" tabindex="-1"></a>  <span class="at">ID =</span> <span class="st">"Quiberon"</span>,</span>
<span id="cb4-164"><a href="#cb4-164" aria-hidden="true" tabindex="-1"></a>  <span class="at">Site =</span> <span class="st">" baie de Plouharnel"</span></span>
<span id="cb4-165"><a href="#cb4-165" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-166"><a href="#cb4-166" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords=</span><span class="fu">c</span>(<span class="st">"lon"</span>,<span class="st">"lat"</span>) )  <span class="sc">%&gt;%</span> </span>
<span id="cb4-167"><a href="#cb4-167" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_set_crs</span>(<span class="st">"EPSG:4326"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-168"><a href="#cb4-168" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="st">"+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +units=m +no_defs "</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb4-169"><a href="#cb4-169" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">lon =</span> sf<span class="sc">::</span><span class="fu">st_coordinates</span>(.) [,<span class="dv">1</span>],</span>
<span id="cb4-170"><a href="#cb4-170" aria-hidden="true" tabindex="-1"></a>                <span class="at">lat =</span> sf<span class="sc">::</span><span class="fu">st_coordinates</span>(.) [,<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb4-171"><a href="#cb4-171" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_set_geometry</span>(<span class="cn">NULL</span>)</span>
<span id="cb4-172"><a href="#cb4-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-173"><a href="#cb4-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-174"><a href="#cb4-174" aria-hidden="true" tabindex="-1"></a>p1  <span class="ot">&lt;-</span></span>
<span id="cb4-175"><a href="#cb4-175" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(MiniEU_map) <span class="sc">+</span></span>
<span id="cb4-176"><a href="#cb4-176" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">linewidth=</span><span class="fl">0.5</span>,<span class="at">alpha=</span><span class="fl">0.93</span>,</span>
<span id="cb4-177"><a href="#cb4-177" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill=</span><span class="st">"#CFCFCF"</span>,<span class="at">colour=</span><span class="st">"grey30"</span>)<span class="sc">+</span></span>
<span id="cb4-178"><a href="#cb4-178" aria-hidden="true" tabindex="-1"></a>    ggforce<span class="sc">::</span><span class="fu">geom_mark_ellipse</span>(<span class="at">data=</span>Quiberon_Location,</span>
<span id="cb4-179"><a href="#cb4-179" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">aes</span>(<span class="at">x=</span>lon,</span>
<span id="cb4-180"><a href="#cb4-180" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y=</span>lat,</span>
<span id="cb4-181"><a href="#cb4-181" aria-hidden="true" tabindex="-1"></a>                     <span class="at">label =</span> ID</span>
<span id="cb4-182"><a href="#cb4-182" aria-hidden="true" tabindex="-1"></a>                     <span class="co"># description=Site</span></span>
<span id="cb4-183"><a href="#cb4-183" aria-hidden="true" tabindex="-1"></a>                     ) ,</span>
<span id="cb4-184"><a href="#cb4-184" aria-hidden="true" tabindex="-1"></a>                 <span class="at">linewidth=</span><span class="fl">0.2</span>,</span>
<span id="cb4-185"><a href="#cb4-185" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill=</span><span class="st">"goldenrod"</span>,</span>
<span id="cb4-186"><a href="#cb4-186" aria-hidden="true" tabindex="-1"></a>                 <span class="at">show.legend=</span>F,</span>
<span id="cb4-187"><a href="#cb4-187" aria-hidden="true" tabindex="-1"></a>                 <span class="at">label.hjust =</span> <span class="fl">0.3</span>,</span>
<span id="cb4-188"><a href="#cb4-188" aria-hidden="true" tabindex="-1"></a>                 <span class="at">con.size =</span> <span class="dv">1</span>,</span>
<span id="cb4-189"><a href="#cb4-189" aria-hidden="true" tabindex="-1"></a>                 <span class="at">con.colour =</span> <span class="st">"goldenrod4"</span>,</span>
<span id="cb4-190"><a href="#cb4-190" aria-hidden="true" tabindex="-1"></a>                 <span class="at">label.fontsize =</span> <span class="fu">c</span>(<span class="dv">12</span>),</span>
<span id="cb4-191"><a href="#cb4-191" aria-hidden="true" tabindex="-1"></a>                 <span class="at">alpha=</span><span class="fl">0.8</span>,</span>
<span id="cb4-192"><a href="#cb4-192" aria-hidden="true" tabindex="-1"></a>                 <span class="at">expand =</span> <span class="fu">unit</span>(<span class="fl">1.5</span>, <span class="st">"mm"</span>) , </span>
<span id="cb4-193"><a href="#cb4-193" aria-hidden="true" tabindex="-1"></a>                 <span class="at">radius =</span> <span class="fu">unit</span>(<span class="fl">1.5</span>, <span class="st">"mm"</span>) , </span>
<span id="cb4-194"><a href="#cb4-194" aria-hidden="true" tabindex="-1"></a>                 <span class="at">label.buffer =</span> <span class="fu">unit</span>(<span class="dv">4</span>, <span class="st">"mm"</span>) ,</span>
<span id="cb4-195"><a href="#cb4-195" aria-hidden="true" tabindex="-1"></a>                 <span class="at">label.fill =</span> <span class="st">"grey90"</span>)<span class="sc">+</span></span>
<span id="cb4-196"><a href="#cb4-196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">2600000</span>,<span class="dv">4100000</span>) ,</span>
<span id="cb4-197"><a href="#cb4-197" aria-hidden="true" tabindex="-1"></a>          <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">1600000</span>,<span class="dv">3100000</span>))<span class="sc">+</span></span>
<span id="cb4-198"><a href="#cb4-198" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_Bede_Map</span>()<span class="sc">+</span></span>
<span id="cb4-199"><a href="#cb4-199" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Longitude"</span>,</span>
<span id="cb4-200"><a href="#cb4-200" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"Latitude"</span>)<span class="sc">+</span></span>
<span id="cb4-201"><a href="#cb4-201" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels=</span>scaleFUN)<span class="sc">+</span></span>
<span id="cb4-202"><a href="#cb4-202" aria-hidden="true" tabindex="-1"></a>  <span class="co"># theme(plot.margin = unit(c(0.0,0.0,0.0,0.0), "cm"),</span></span>
<span id="cb4-203"><a href="#cb4-203" aria-hidden="true" tabindex="-1"></a>  <span class="co">#       axis.title = element_blank(),</span></span>
<span id="cb4-204"><a href="#cb4-204" aria-hidden="true" tabindex="-1"></a>  <span class="co">#       axis.ticks = element_blank(),</span></span>
<span id="cb4-205"><a href="#cb4-205" aria-hidden="true" tabindex="-1"></a>  <span class="co">#       panel.grid.major = element_blank(),</span></span>
<span id="cb4-206"><a href="#cb4-206" aria-hidden="true" tabindex="-1"></a>  <span class="co">#       # axis.text.x = element_text(size = 20),</span></span>
<span id="cb4-207"><a href="#cb4-207" aria-hidden="true" tabindex="-1"></a>  <span class="co">#       # axis.text.y = element_text(size = 20) </span></span>
<span id="cb4-208"><a href="#cb4-208" aria-hidden="true" tabindex="-1"></a>  <span class="co">#       axis.text.x = element_blank(),</span></span>
<span id="cb4-209"><a href="#cb4-209" aria-hidden="true" tabindex="-1"></a>  <span class="co">#       axis.text.y = element_blank() </span></span>
<span id="cb4-210"><a href="#cb4-210" aria-hidden="true" tabindex="-1"></a>  <span class="co">#       )+</span></span>
<span id="cb4-211"><a href="#cb4-211" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()<span class="sc">+</span></span>
<span id="cb4-212"><a href="#cb4-212" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"slategray3"</span>))</span>
<span id="cb4-213"><a href="#cb4-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-214"><a href="#cb4-214" aria-hidden="true" tabindex="-1"></a>col_sf <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Bleached_seagrass"</span> <span class="ot">=</span> <span class="st">"darkred"</span>, </span>
<span id="cb4-215"><a href="#cb4-215" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Healthy_seagrass"</span> <span class="ot">=</span> <span class="st">"darkgreen"</span></span>
<span id="cb4-216"><a href="#cb4-216" aria-hidden="true" tabindex="-1"></a>            <span class="co"># "Other" = "grey"</span></span>
<span id="cb4-217"><a href="#cb4-217" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb4-218"><a href="#cb4-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-219"><a href="#cb4-219" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract x and y ranges</span></span>
<span id="cb4-220"><a href="#cb4-220" aria-hidden="true" tabindex="-1"></a>xlim <span class="ot">&lt;-</span> <span class="fu">c</span>(lon_min, lon_max)</span>
<span id="cb4-221"><a href="#cb4-221" aria-hidden="true" tabindex="-1"></a>ylim <span class="ot">&lt;-</span> <span class="fu">c</span>(lat_min, lat_max)</span>
<span id="cb4-222"><a href="#cb4-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-223"><a href="#cb4-223" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the coordinates for the rectangle (25% to 75% of the ranges)</span></span>
<span id="cb4-224"><a href="#cb4-224" aria-hidden="true" tabindex="-1"></a>xleft   <span class="ot">&lt;-</span> xlim[<span class="dv">1</span>] <span class="sc">+</span> <span class="fl">0.745</span> <span class="sc">*</span> <span class="fu">diff</span>(xlim)</span>
<span id="cb4-225"><a href="#cb4-225" aria-hidden="true" tabindex="-1"></a>xright  <span class="ot">&lt;-</span> xlim[<span class="dv">1</span>] <span class="sc">+</span> <span class="fl">0.99</span> <span class="sc">*</span> <span class="fu">diff</span>(xlim)</span>
<span id="cb4-226"><a href="#cb4-226" aria-hidden="true" tabindex="-1"></a>ybottom <span class="ot">&lt;-</span> ylim[<span class="dv">1</span>] <span class="sc">+</span> <span class="fl">0.854</span> <span class="sc">*</span> <span class="fu">diff</span>(ylim)</span>
<span id="cb4-227"><a href="#cb4-227" aria-hidden="true" tabindex="-1"></a>ytop    <span class="ot">&lt;-</span> ylim[<span class="dv">1</span>] <span class="sc">+</span> <span class="fl">0.975</span> <span class="sc">*</span> <span class="fu">diff</span>(ylim)</span>
<span id="cb4-228"><a href="#cb4-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-229"><a href="#cb4-229" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a rectangle as an sf polygon</span></span>
<span id="cb4-230"><a href="#cb4-230" aria-hidden="true" tabindex="-1"></a>rectangle_coords <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(</span>
<span id="cb4-231"><a href="#cb4-231" aria-hidden="true" tabindex="-1"></a>  xleft,  ybottom,</span>
<span id="cb4-232"><a href="#cb4-232" aria-hidden="true" tabindex="-1"></a>  xleft,  ytop,</span>
<span id="cb4-233"><a href="#cb4-233" aria-hidden="true" tabindex="-1"></a>  xright, ytop,</span>
<span id="cb4-234"><a href="#cb4-234" aria-hidden="true" tabindex="-1"></a>  xright, ybottom,</span>
<span id="cb4-235"><a href="#cb4-235" aria-hidden="true" tabindex="-1"></a>  xleft,  ybottom  <span class="co"># Close the polygon by repeating the first point</span></span>
<span id="cb4-236"><a href="#cb4-236" aria-hidden="true" tabindex="-1"></a>), <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-237"><a href="#cb4-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-238"><a href="#cb4-238" aria-hidden="true" tabindex="-1"></a>rectangle_sf <span class="ot">&lt;-</span> <span class="fu">st_polygon</span>(<span class="fu">list</span>(rectangle_coords)) <span class="sc">%&gt;%</span></span>
<span id="cb4-239"><a href="#cb4-239" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_sfc</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"EPSG:4326"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-240"><a href="#cb4-240" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_transform</span>(<span class="st">"+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +units=m +no_defs "</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-241"><a href="#cb4-241" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_sf</span>()</span>
<span id="cb4-242"><a href="#cb4-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-243"><a href="#cb4-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-244"><a href="#cb4-244" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb4-245"><a href="#cb4-245" aria-hidden="true" tabindex="-1"></a>  tidyterra<span class="sc">::</span><span class="fu">geom_spatraster_rgb</span>(<span class="at">data =</span> RGB_Low) <span class="sc">+</span></span>
<span id="cb4-246"><a href="#cb4-246" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mask_sf, <span class="fu">aes</span>(<span class="at">fill =</span> <span class="st">"Mask"</span>), <span class="at">color =</span> <span class="st">"grey20"</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb4-247"><a href="#cb4-247" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> Drone_flight_area, <span class="fu">aes</span>(<span class="at">fill =</span> <span class="st">"Drone_Flight_Area"</span>), <span class="at">color =</span> <span class="st">"grey0"</span>, <span class="at">size =</span> <span class="fl">2.2</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb4-248"><a href="#cb4-248" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> quadrat_sf, <span class="fu">aes</span>(<span class="at">color =</span> Target_types), <span class="at">size =</span> <span class="fl">2.1</span>)<span class="sc">+</span></span>
<span id="cb4-249"><a href="#cb4-249" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> rectangle_sf, <span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb4-250"><a href="#cb4-250" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb4-251"><a href="#cb4-251" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> col_sf,</span>
<span id="cb4-252"><a href="#cb4-252" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Blackened seagrasses"</span>, <span class="st">"Healthy seagrasses"</span>, <span class="st">"Other"</span>),</span>
<span id="cb4-253"><a href="#cb4-253" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="cn">NULL</span></span>
<span id="cb4-254"><a href="#cb4-254" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb4-255"><a href="#cb4-255" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb4-256"><a href="#cb4-256" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Mask"</span> <span class="ot">=</span> <span class="st">"grey90"</span>, <span class="st">"Drone_Flight_Area"</span> <span class="ot">=</span> <span class="st">"grey70"</span>),</span>
<span id="cb4-257"><a href="#cb4-257" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Drone Flight"</span>, <span class="st">"Intertidal area"</span>),</span>
<span id="cb4-258"><a href="#cb4-258" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="cn">NULL</span>  <span class="co"># No title for the fill legend</span></span>
<span id="cb4-259"><a href="#cb4-259" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb4-260"><a href="#cb4-260" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">expand =</span> F) <span class="sc">+</span></span>
<span id="cb4-261"><a href="#cb4-261" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_Bede_Map</span>() <span class="sc">+</span></span>
<span id="cb4-262"><a href="#cb4-262" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(</span>
<span id="cb4-263"><a href="#cb4-263" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">order =</span> <span class="dv">2</span>),  <span class="co"># Order the fill legend</span></span>
<span id="cb4-264"><a href="#cb4-264" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">order =</span> <span class="dv">1</span>)  <span class="co"># Order the color legend</span></span>
<span id="cb4-265"><a href="#cb4-265" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb4-266"><a href="#cb4-266" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="cn">NULL</span>, <span class="at">colour =</span> <span class="cn">NULL</span>)<span class="sc">+</span></span>
<span id="cb4-267"><a href="#cb4-267" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb4-268"><a href="#cb4-268" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="fu">alpha</span>(<span class="st">"white"</span>, <span class="dv">0</span>)),</span>
<span id="cb4-269"><a href="#cb4-269" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.box =</span> <span class="st">"vertical"</span>,  <span class="co"># Stack legends vertically</span></span>
<span id="cb4-270"><a href="#cb4-270" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.box.just =</span> <span class="st">"left"</span>,  <span class="co"># Align the legends to the left</span></span>
<span id="cb4-271"><a href="#cb4-271" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.spacing.y =</span> <span class="fu">unit</span>(<span class="fl">0.0</span>, <span class="st">'mm'</span>),  <span class="co"># Adjust the spacing between items</span></span>
<span id="cb4-272"><a href="#cb4-272" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">color =</span> <span class="st">"black"</span>),  <span class="co"># Ensure clear legend keys</span></span>
<span id="cb4-273"><a href="#cb4-273" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.box.margin =</span> <span class="fu">margin</span>(<span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>)</span>
<span id="cb4-274"><a href="#cb4-274" aria-hidden="true" tabindex="-1"></a>    )  <span class="co"># Adjust position if needed  )</span></span>
<span id="cb4-275"><a href="#cb4-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-276"><a href="#cb4-276" aria-hidden="true" tabindex="-1"></a><span class="co"># p2</span></span>
<span id="cb4-277"><a href="#cb4-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-278"><a href="#cb4-278" aria-hidden="true" tabindex="-1"></a>combined_plot <span class="ot">&lt;-</span> <span class="fu">ggdraw</span>() <span class="sc">+</span></span>
<span id="cb4-279"><a href="#cb4-279" aria-hidden="true" tabindex="-1"></a>  <span class="fu">draw_plot</span>(p2) <span class="sc">+</span>                    <span class="co"># Main plot</span></span>
<span id="cb4-280"><a href="#cb4-280" aria-hidden="true" tabindex="-1"></a>  <span class="fu">draw_plot</span>(p1, <span class="at">x =</span> <span class="fl">0.65</span>, <span class="at">y =</span> <span class="fl">0.05</span>,   <span class="co"># p1 inset (bottom right)</span></span>
<span id="cb4-281"><a href="#cb4-281" aria-hidden="true" tabindex="-1"></a>            <span class="at">width =</span> <span class="fl">0.3</span>, <span class="at">height =</span> <span class="fl">0.3</span>)</span>
<span id="cb4-282"><a href="#cb4-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-283"><a href="#cb4-283" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Paper/Figs/High_res/Quiberon_map.png"</span>, combined_plot, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">10</span>, <span class="at">dpi =</span> <span class="dv">800</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [5]:</pre></div><div id="cell-fig-quiberonMap" class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"Figs/Low_res/Quiberon_map.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-quiberonMap" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-quiberonMap-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="">
<a href="Figs/Low_res/Quiberon_map.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="Figure&nbsp;1: Location of the fieldtrip campaign that occured in the 10th of September 2021. The light grey polygons indicates the intertidal zone (Zone between High tide and low tide, that is totally emerged at low tide) and the dark grey polygon indicate the extent of the drone flight. Green dots indicate location of quadrat picture over green seagrasses while red dots indicate location of quadrat took over darkened seagrasses."><img src="Figs/Low_res/Quiberon_map.png" class="img-fluid figure-img" style="width:100.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-quiberonMap-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Location of the fieldtrip campaign that occured in the 10th of September 2021. The light grey polygons indicates the intertidal zone (Zone between High tide and low tide, that is totally emerged at low tide) and the dark grey polygon indicate the extent of the drone flight. Green dots indicate location of quadrat picture over green seagrasses while red dots indicate location of quadrat took over darkened seagrasses.
</figcaption>
</figure>
</div>
</div>
</div></div>
<p>A fieldtrip, aiming to map a seagrass meadow near Quiberon (France : 46°57’32.0”N, 2°10’37.0”W), occurred in the 10th of September 2021 (<a href="#fig-quiberonMap" class="quarto-xref">Figure&nbsp;1</a>). During this fieldtrip, darkening of seagrasses have been observed, resulting in the darkening of seagrass leaves over large area of the meadow (<a href="#fig-QuiberonImg" class="quarto-xref">Figure&nbsp;2</a> C &amp; D). During this field trip, drone flights were conducted over two areas of the seagrass meadow using a DJI Matrice 200 equipped with a Sequoia Multispectral camera. The Sequoia captures four spectral bands: Green (550 ± 40 nm), Red (660 ± 40 nm), RedEdge (735 ± 10 nm), and Near Infrared (790 ± 40 nm). A total of 122 Ground Control Points (GCPs) were collected in the form of georeferenced quadrat images across the meadow . These images allow for visual assessment of vegetation type, density, and health status. The images were then divided into two categories: green seagrasses and darkened seagrasses, based on a visual estimation of the leaf condition (<a href="#fig-quiberonMap" class="quarto-xref">Figure&nbsp;1</a>).</p>
<div class="cell-container"><div class="cell-decorator"><pre>In [6]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyterra)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>get_letter_position <span class="ot">&lt;-</span> <span class="cf">function</span>(img){</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  ext <span class="ot">&lt;-</span> <span class="fu">ext</span>(img)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(ext[<span class="dv">1</span>]<span class="sc">+</span>(<span class="fl">0.05</span><span class="sc">*</span>(ext[<span class="dv">2</span>]<span class="sc">-</span>ext[<span class="dv">1</span>])))</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(ext[<span class="dv">3</span>]<span class="sc">+</span>(<span class="fl">0.95</span><span class="sc">*</span>(ext[<span class="dv">4</span>]<span class="sc">-</span>ext[<span class="dv">3</span>])))</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">c</span>(ext[<span class="dv">1</span>]<span class="sc">+</span><span class="fl">0.1</span>, ext[<span class="dv">4</span>]<span class="sc">-</span><span class="fl">0.1</span>))</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"Data/imgs/biolittoral/healthy_landscap.png"</span>) </span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="fu">ext</span>(A) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="sc">-</span><span class="fl">2.05</span>,<span class="dv">0</span>)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"Data/imgs/biolittoral/Quadrat_Healthy.png"</span>) </span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="fu">ext</span>(B) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">1.05</span>,<span class="fl">2.05</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>C <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"Data/imgs/biolittoral/Quadrat_darkened.png"</span>)</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="fu">ext</span>(C) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">1.05</span>,<span class="fl">2.05</span>,<span class="sc">-</span><span class="fl">2.05</span>,<span class="sc">-</span><span class="fl">1.05</span>)</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>D <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"Data/imgs/biolittoral/darkened_landscap.png"</span>) </span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="fu">ext</span>(D) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">2.1</span>,<span class="fl">3.1</span>,<span class="sc">-</span><span class="fl">2.05</span>,<span class="dv">0</span>)</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>letter_A <span class="ot">&lt;-</span> <span class="fu">get_letter_position</span>(A)</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>letter_B <span class="ot">&lt;-</span> <span class="fu">get_letter_position</span>(B)</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>letter_C <span class="ot">&lt;-</span> <span class="fu">get_letter_position</span>(C)</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>letter_D <span class="ot">&lt;-</span> <span class="fu">get_letter_position</span>(D)</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>letter_size <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spatraster_rgb</span>(<span class="at">data =</span> A, <span class="at">maxcell =</span> <span class="fl">20e+05</span>)<span class="sc">+</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spatraster_rgb</span>(<span class="at">data =</span> B, <span class="at">maxcell =</span> <span class="fl">20e+05</span>)<span class="sc">+</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spatraster_rgb</span>(<span class="at">data =</span> C, <span class="at">maxcell =</span> <span class="fl">20e+05</span>)<span class="sc">+</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spatraster_rgb</span>(<span class="at">data =</span> D, <span class="at">maxcell =</span> <span class="fl">20e+05</span>)<span class="sc">+</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>()<span class="sc">+</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">x =</span> letter_A[<span class="dv">1</span>],<span class="at">y=</span>letter_A[<span class="dv">2</span>], <span class="at">label =</span> <span class="st">"A"</span>), <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> letter_size)<span class="sc">+</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">x =</span> letter_B[<span class="dv">1</span>],<span class="at">y=</span>letter_B[<span class="dv">2</span>], <span class="at">label =</span> <span class="st">"B"</span>), <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> letter_size)<span class="sc">+</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">x =</span> letter_C[<span class="dv">1</span>],<span class="at">y=</span>letter_C[<span class="dv">2</span>], <span class="at">label =</span> <span class="st">"C"</span>), <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> letter_size)<span class="sc">+</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">x =</span> letter_D[<span class="dv">1</span>],<span class="at">y=</span>letter_D[<span class="dv">2</span>], <span class="at">label =</span> <span class="st">"D"</span>), <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> letter_size)<span class="sc">+</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()<span class="sc">+</span></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.length =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">"pt"</span>),</span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major=</span><span class="fu">element_blank</span>(), </span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor=</span><span class="fu">element_blank</span>(), </span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="st">"pt"</span>))</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Paper/Figs/High_res/img_Quiberon.png"</span>,plot, <span class="at">width =</span> <span class="fl">3.1</span>, <span class="at">height =</span> <span class="fl">2.05</span>, <span class="at">dpi =</span> <span class="dv">800</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [7]:</pre></div><div id="cell-fig-QuiberonImg" class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"Figs/Low_res/img_Quiberon.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-QuiberonImg" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-QuiberonImg-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="">
<a href="Figs/Low_res/img_Quiberon.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="Figure&nbsp;2: Illustrations of the two health conditions of seagrasses observed in the field. A: Global view of a green green meadow; B: Quadrat images of green seagrasses; C: Quadrat images of darkened seagrasses; D: Global view of an darkened meadow. All images were taken on September 10th, 2021, in Quiberon."><img src="Figs/Low_res/img_Quiberon.png" class="img-fluid figure-img" style="width:100.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-QuiberonImg-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Illustrations of the two health conditions of seagrasses observed in the field. A: Global view of a green green meadow; B: Quadrat images of green seagrasses; C: Quadrat images of darkened seagrasses; D: Global view of an darkened meadow. All images were taken on September 10th, 2021, in Quiberon.
</figcaption>
</figure>
</div>
</div>
</div></div>
</section>
<section id="temparature-data-and-identification-of-heatwaves" class="level3" data-number="2.1.2">
<h3 data-number="2.1.2" class="anchored" data-anchor-id="temparature-data-and-identification-of-heatwaves"><span class="header-section-number">2.1.2</span> Temparature Data and identification of heatwaves</h3>
<section id="air-temperature" class="level4" data-number="2.1.2.1">
<h4 data-number="2.1.2.1" class="anchored" data-anchor-id="air-temperature"><span class="header-section-number">2.1.2.1</span> Air temperature</h4>
<p>Since January 1, 2024, Meteo France weather data has been freely and openly accessible. Hourly air temperature data (°C) for the French Atlantic and Channel coasts was retrieved using a <a href="https://github.com/SigOiry/HeatWave_Seagrasses/blob/main/Scripts/MeteoFrance_Extraction.qmd">custom script</a> as no API was available at the time of this study. Weather stations located within 10 kilometers of the coastline were considered, but only those with at least 30 years of data were included to ensure reliable climatological reconstruction. Of the 156 weather stations within 10 kilometers of the coast, only 36 had sufficient data for climatology reconstruction. The hourly data was then aggregated into daily mean temperatures for each station.</p>
<p>Heatwave detection was performed using the HeatwaveR package in R <span class="citation" data-cites="heatwaveR">(<a href="#ref-heatwaveR" role="doc-biblioref">Schlegel and Smit, 2018</a>)</span>. This package utilizes the methodology proposed by <span class="citation" data-cites="hobday2016hierarchical">Hobday et al. (<a href="#ref-hobday2016hierarchical" role="doc-biblioref">2016</a>)</span> to detect heatwave events. The climatology for the year was computed using the temperature time series. An event was considered a heatwave each time the temperature exceeded the 90th percentile of the climatology for three consecutive days. The severity of each event has been assessed using the methodology proposed by <span class="citation" data-cites="hobday2018categorizing">Hobday et al. (<a href="#ref-hobday2018categorizing" role="doc-biblioref">2018</a>)</span>. Following the methodology of <span class="citation" data-cites="schlegel2017nearshore">Schlegel et al. (<a href="#ref-schlegel2017nearshore" role="doc-biblioref">2017</a>)</span>, coldspell events corresponding to temperature bellow the percentile 10th of the climatology during 3 consecutives days have also been measured.</p>
<p>Concerning heatwaves event near Quiberon, this methodology has been apply solely on the nearest weather station of our study site (Lorient-Lann Bihoue, 47°45’46”N 3°26’11”W , more than 395000 observation since the 1st of February 1952).</p>
</section>
<section id="water-temperature" class="level4" data-number="2.1.2.2">
<h4 data-number="2.1.2.2" class="anchored" data-anchor-id="water-temperature"><span class="header-section-number">2.1.2.2</span> Water temperature</h4>
<div class="cell-container"><div class="cell-decorator"><pre>In [8]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Linking to GEOS 3.12.1, GDAL 3.8.4, PROJ 9.3.1; sf_use_s2() is TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the bounding box around Quiberon (adjust the range as needed)</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>lon_min <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">3.5</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>lon_max <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">2.7</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>lat_min <span class="ot">&lt;-</span> <span class="fl">47.3</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>lat_max <span class="ot">&lt;-</span> <span class="fl">47.7</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>poly <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(lon_min,lon_max,lon_max,lon_min),</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(lat_max,lat_max,lat_min,lat_min),</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure the polygon is closed by adding the first point at the end if necessary</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(poly[<span class="dv">1</span>, <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>)] <span class="sc">==</span> poly[<span class="fu">nrow</span>(poly), <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>)])) {</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  poly <span class="ot">&lt;-</span> <span class="fu">rbind</span>(poly, poly[<span class="dv">1</span>, ])</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a matrix of coordinates</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(poly[, <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>)])</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a list of coordinate matrices (required by st_polygon)</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>polygon_list <span class="ot">&lt;-</span> <span class="fu">list</span>(coords)</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an 'sfc' (simple features geometry list column) object with the appropriate CRS</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>polygon_sfc <span class="ot">&lt;-</span> <span class="fu">st_sfc</span>(<span class="fu">st_polygon</span>(polygon_list), <span class="at">crs =</span> <span class="dv">4326</span>)  <span class="co"># CRS 4326 corresponds to WGS84</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the 'id' with the geometry to create an 'sf' object</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>poly_sf <span class="ot">&lt;-</span> <span class="fu">st_sf</span>(<span class="at">id =</span> <span class="fu">unique</span>(poly<span class="sc">$</span>id), <span class="at">geometry =</span> polygon_sfc)</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>poly_sf_projected <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(poly_sf, <span class="at">crs =</span> <span class="dv">32630</span>)  <span class="co"># UTM Zone 30N</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Calculate the area in square meters</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>area_poly_sst_m2 <span class="ot">&lt;-</span> <span class="fu">st_area</span>(poly_sf_projected)</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Convert the area to square kilometers</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>area_poly_sst_km2 <span class="ot">&lt;-</span> units<span class="sc">::</span><span class="fu">set_units</span>(area_poly_sst_m2, km<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the units object to numeric for rounding</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>area_poly_sst_numeric <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(area_poly_sst_km2)</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Round the area to the nearest hundred</span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>area_poly_sst_rounded <span class="ot">&lt;-</span> <span class="fu">round</span>(area_poly_sst_numeric <span class="sc">/</span> <span class="dv">100</span>) <span class="sc">*</span> <span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<p>SST data from the Copernicus CMEMS platform were downloaded for the French coast near Quiberon (47°29′03″N, 3°07′09″W), covering 1982-2022 <span class="citation" data-cites="CMEMS_1">(<a href="#ref-CMEMS_1" role="doc-biblioref">CMEMS, 2024</a>)</span>. Only pixels within an area of 2700 km² around Quiberon, Brittany, France (47°29′03″N, 3°07′09″W) were extracted and analyzed. This area was large enough to minimize missing values caused by cloud cover, yet small enough to avoid being influenced by the stability of offshore SST. The multi-sensor Level 3S Sea Surface Temperature (SST) product the we used is built from nighttime infrared satellite data, including sources like ESA SST CCI, C3S, and EUMETSAT. Data from AVHRR, ATSR, and SLSTR radiometers are used, but only those with a quality level above 4. An intercalibration method ensures consistency, and a daily reference SST field is constructed by combining the best data with median values from other sources. A large-scale bias correction is applied, and daily single-sensor composites are merged into a multi-sensor file (L3S), selecting the best sensor for each grid cell. A daily average was computed for the time series, and the HeatwaveR package <span class="citation" data-cites="heatwaveR">(<a href="#ref-heatwaveR" role="doc-biblioref">Schlegel and Smit, 2018</a>)</span> was used to compute SST climatology and detect SST events using the same method as air temperature event detection.</p>
</section>
</section>
<section id="satellite-observation" class="level3" data-number="2.1.3">
<h3 data-number="2.1.3" class="anchored" data-anchor-id="satellite-observation"><span class="header-section-number">2.1.3</span> Satellite Observation</h3>
<p>Two Sentinel-2 images covering the field trip site (<a href="#fig-quiberonMap" class="quarto-xref">Figure&nbsp;1</a>) were downloaded from the Copernicus platform <span class="citation" data-cites="copernicus_sentinel2">(<a href="#ref-copernicus_sentinel2" role="doc-biblioref">European Space Agency, 2024a</a>)</span>. The first image was taken before the heatwave event on September 1, 2021, and the second one after the event on September 6, 2021. Both images were acquired at Level-2 processing, in surface reflectance, and were orthorectified and atmospherically corrected to account for the effects of the atmosphere on reflectance values <span class="citation" data-cites="sen2cor">(<a href="#ref-sen2cor" role="doc-biblioref">European Space Agency, 2024b</a>)</span>.</p>
<p>Reflectance value of each GCPs (<a href="#fig-quiberonMap" class="quarto-xref">Figure&nbsp;1</a>) have been exctracted and compared before and after the heatwave event.</p>
</section>
<section id="emersion-time-of-seagrasses" class="level3" data-number="2.1.4">
<h3 data-number="2.1.4" class="anchored" data-anchor-id="emersion-time-of-seagrasses"><span class="header-section-number">2.1.4</span> Emersion Time of Seagrasses</h3>
<p>To estimate the emersion time of seagrasses during low tide, both bathymetric and tidal data are required.</p>
<section id="bathymetry" class="level4" data-number="2.1.4.1">
<h4 data-number="2.1.4.1" class="anchored" data-anchor-id="bathymetry"><span class="header-section-number">2.1.4.1</span> Bathymetry</h4>
<p>Bathymetry data for the study site were obtained from the “Service Hydrographique et Océanographique de la Marine” <span class="citation" data-cites="shom_bathymetry_litto3d_bzh_2018_2021">(<a href="#ref-shom_bathymetry_litto3d_bzh_2018_2021" role="doc-biblioref">SHOM, 2021</a>)</span>. The reference “zero” of this product is based on the NGF/IGN69, which refers to the mean sea level recorded at the Marseille tide gauge between 1885 and 1897. This reference is known as the Terrestrial Altimetric Zero.</p>
</section>
<section id="tides" class="level4" data-number="2.1.4.2">
<h4 data-number="2.1.4.2" class="anchored" data-anchor-id="tides"><span class="header-section-number">2.1.4.2</span> Tides</h4>
<p>Tidal data for the heatwave events at the study site were downloaded from the Intergovernmental Oceanographic Commission data portal <span class="citation" data-cites="ioc_sea_level_lecy">(<a href="#ref-ioc_sea_level_lecy" role="doc-biblioref">IOC, 2024</a>)</span>, for the nearest tide gauge located at Le Conquet. The “zero” for this dataset corresponds to the lowest astronomical tide, also known as the Hydrographic Zero.</p>
</section>
<section id="reference-intercalibration-of-both-dataset" class="level4" data-number="2.1.4.3">
<h4 data-number="2.1.4.3" class="anchored" data-anchor-id="reference-intercalibration-of-both-dataset"><span class="header-section-number">2.1.4.3</span> Reference intercalibration of both dataset</h4>
<p>Since the altitude references of these two datasets differ, a correction factor must be applied to adjust the reference of one dataset to match the other. The SHOM annually provides a document called “Références Altimétriques Marines” <span class="citation" data-cites="shom_ram_2022">(RAM, <a href="#ref-shom_ram_2022" role="doc-biblioref">Shom, 2022</a>)</span>, which includes correction factors for each seaport along the French coastline. These factors allow, among other things, the conversion of the Terrestrial Altimetric Zero to the Hydrographic Zero. For Le Conquet, the correction factor is 2.850 meters.</p>
</section>
</section>
</section>
<section id="laboratory-experiment" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="laboratory-experiment"><span class="header-section-number">2.2</span> Laboratory experiment</h2>
<section id="sampling-and-acclimation-of-seagrasses" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="sampling-and-acclimation-of-seagrasses"><span class="header-section-number">2.2.1</span> Sampling and acclimation of seagrasses</h3>
<p>Seagrass was sampled from a <em>Nanozostera noltei</em> (dwarf eelgrass, syn. <em>Zostera noltei</em>) meadow on Noirmoutier Island, France (46°57’32.0”N, 2°10’37.0”W) at low tide in June 2024. A home-made inox sampling box was used to sample seagrass from an area of 30 cm by 15 cm and 5 cm deep, maintaining the sediment structure and avoiding damage to the rhizomes and the leafs of the seagrass (<a href="#fig-design" class="quarto-xref">Figure&nbsp;3</a> A). This sampling box allowed to limitate sampling variability between replicates. The entire system, including seagrass, sediment, meiofauna, and macrofauna, was placed in plastic trays together in a mesocosm setup, which allowed for the natural interactions between components to be maintained and reduced stress on the seagrass. To avoid hydric stress during transportation, seawater was added to each tray. Simultaneously, seawater was sampled from a nearby site and transported to the lab, where it was filtered using a 0.22 µm nitrocellulose filter to remove all suspended particulate matter. This seawater was used in the acclimation tank and the intertidal chambers. The seagrasses were acclimated at high tide for one weeks with a water temperature of 17°C, matching the temperature at the time of sampling, and with light of 150 µmol.s-1.m-2 of PAR photons <span class="citation" data-cites="akbar2020mangrove">(<a href="#ref-akbar2020mangrove" role="doc-biblioref">Akbar et al., 2020</a>)</span>. A wave generator was used in the tank to circulate and reoxygenate the water.</p>
</section>
<section id="experimental-design" class="level3" data-number="2.2.2">
<h3 data-number="2.2.2" class="anchored" data-anchor-id="experimental-design"><span class="header-section-number">2.2.2</span> Experimental design</h3>
<div class="cell-container"><div class="cell-decorator"><pre>In [9]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyterra)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>get_letter_position <span class="ot">&lt;-</span> <span class="cf">function</span>(img){</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  ext <span class="ot">&lt;-</span> <span class="fu">ext</span>(img)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(ext[<span class="dv">1</span>]<span class="sc">+</span>(<span class="fl">0.05</span><span class="sc">*</span>(ext[<span class="dv">2</span>]<span class="sc">-</span>ext[<span class="dv">1</span>])))</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(ext[<span class="dv">3</span>]<span class="sc">+</span>(<span class="fl">0.95</span><span class="sc">*</span>(ext[<span class="dv">4</span>]<span class="sc">-</span>ext[<span class="dv">3</span>])))</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">c</span>(ext[<span class="dv">1</span>]<span class="sc">+</span><span class="fl">0.1</span>, ext[<span class="dv">4</span>]<span class="sc">-</span><span class="fl">0.1</span>))</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"Data/imgs/Simon_Sampling.png"</span>) </span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="fu">ext</span>(A) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.975</span>,<span class="sc">-</span><span class="fl">1.95</span>,<span class="dv">0</span>)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"Data/imgs/Chamber.jpg"</span>) </span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="fu">ext</span>(B) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">1.025</span>,<span class="dv">2</span>,<span class="sc">-</span><span class="fl">1.95</span>,<span class="dv">0</span>)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>D <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"Data/imgs/Seagrass_before_zoomed.png"</span>)</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="fu">ext</span>(D) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">2.05</span>,<span class="fl">3.025</span>,<span class="sc">-</span><span class="fl">1.4625</span>,<span class="dv">0</span>)</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>C <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"Data/imgs/Tray_high.jpg"</span>) </span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a><span class="fu">ext</span>(C) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">2</span>,<span class="sc">-</span><span class="fl">2.975</span>,<span class="sc">-</span><span class="dv">2</span>)</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>E <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"Data/imgs/Seagrass_after_zoomed.png"</span>)</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a><span class="fu">ext</span>(E) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">2.05</span>,<span class="fl">3.025</span>,<span class="sc">-</span><span class="fl">2.975</span>,<span class="sc">-</span><span class="fl">1.5125</span>)</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>letter_A <span class="ot">&lt;-</span> <span class="fu">get_letter_position</span>(A)</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>letter_B <span class="ot">&lt;-</span> <span class="fu">get_letter_position</span>(B)</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>letter_C <span class="ot">&lt;-</span> <span class="fu">get_letter_position</span>(C)</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>letter_D <span class="ot">&lt;-</span> <span class="fu">get_letter_position</span>(D)</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>letter_E <span class="ot">&lt;-</span> <span class="fu">get_letter_position</span>(E)</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>letter_size <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spatraster_rgb</span>(<span class="at">data =</span> A, <span class="at">maxcell =</span> <span class="fl">20e+05</span>)<span class="sc">+</span></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spatraster_rgb</span>(<span class="at">data =</span> B, <span class="at">maxcell =</span> <span class="fl">20e+05</span>)<span class="sc">+</span></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spatraster_rgb</span>(<span class="at">data =</span> C, <span class="at">maxcell =</span> <span class="fl">20e+05</span>)<span class="sc">+</span></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spatraster_rgb</span>(<span class="at">data =</span> D, <span class="at">maxcell =</span> <span class="fl">20e+05</span>)<span class="sc">+</span></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spatraster_rgb</span>(<span class="at">data =</span> E, <span class="at">maxcell =</span> <span class="fl">20e+05</span>)<span class="sc">+</span></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>()<span class="sc">+</span></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">x =</span> letter_A[<span class="dv">1</span>],<span class="at">y=</span>letter_A[<span class="dv">2</span>], <span class="at">label =</span> <span class="st">"A"</span>), <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> letter_size)<span class="sc">+</span></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">x =</span> letter_B[<span class="dv">1</span>],<span class="at">y=</span>letter_B[<span class="dv">2</span>], <span class="at">label =</span> <span class="st">"B"</span>), <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> letter_size)<span class="sc">+</span></span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">x =</span> letter_C[<span class="dv">1</span>],<span class="at">y=</span>letter_C[<span class="dv">2</span>], <span class="at">label =</span> <span class="st">"C"</span>), <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> letter_size)<span class="sc">+</span></span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">x =</span> letter_D[<span class="dv">1</span>],<span class="at">y=</span>letter_D[<span class="dv">2</span>], <span class="at">label =</span> <span class="st">"D"</span>), <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> letter_size)<span class="sc">+</span></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">x =</span> letter_E[<span class="dv">1</span>],<span class="at">y=</span>letter_E[<span class="dv">2</span>], <span class="at">label =</span> <span class="st">"E"</span>), <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> letter_size)<span class="sc">+</span></span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()<span class="sc">+</span></span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.length =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">"pt"</span>),</span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major=</span><span class="fu">element_blank</span>(), </span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor=</span><span class="fu">element_blank</span>(), </span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="st">"pt"</span>))</span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Paper/Figs/High_res/Experimental_design.png"</span>,plot, <span class="at">width =</span> <span class="fl">3.025</span>, <span class="at">height =</span> <span class="fl">2.975</span>, <span class="at">dpi =</span> <span class="dv">800</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [10]:</pre></div><div id="cell-fig-design" class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"Figs/Low_res/Experimental_design.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-design" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-design-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="">
<a href="Figs/Low_res/Experimental_design.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="Figure&nbsp;3: Illustrations of the various steps of the experiment. A: Field sampling of seagrass using a homemade sampling box; B: Intertidal chambers used during the experiment; C: Seagrass sample inside a chamber during the experiment at high tide; D: Photo of the treatment sample at the start of the experiment; E: Photo of the treatment sample at the end of the experiment."><img src="Figs/Low_res/Experimental_design.png" class="img-fluid figure-img" style="width:100.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-design-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Illustrations of the various steps of the experiment. A: Field sampling of seagrass using a homemade sampling box; B: Intertidal chambers used during the experiment; C: Seagrass sample inside a chamber during the experiment at high tide; D: Photo of the treatment sample at the start of the experiment; E: Photo of the treatment sample at the end of the experiment.
</figcaption>
</figure>
</div>
</div>
</div></div>
<p>Two intertidal chambers from <a href="https://electricblue.eu/intertidal-chamber">ElectricBlue</a> were used to simulate tidal cycles and control water temperature during high tide and air temperature during low tide (<a href="#fig-design" class="quarto-xref">Figure&nbsp;3</a> B,C). One chamber served as the control, while the other was used for the experimental treatment.</p>
<div class="cell-container"><div class="cell-decorator"><pre>In [11]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>fn <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(x,<span class="at">skip =</span> <span class="dv">21</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">file =</span> <span class="fu">gsub</span>(<span class="st">".*/"</span>,<span class="st">""</span>,x))</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(a)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>df_insitu <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">"Data/In_situ_temperature/"</span>,<span class="st">".csv"</span>,<span class="at">full.names =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(fn) <span class="sc">%&gt;%</span> </span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">location =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(file,<span class="st">"Upper"</span>) <span class="sc">~</span> <span class="st">"Upper"</span>,</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">str_detect</span>(file,<span class="st">"Lower"</span>) <span class="sc">~</span> <span class="st">"Lower"</span>),</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">date =</span> <span class="fu">as.POSIXct</span>(time, <span class="at">format =</span> <span class="fu">c</span>(<span class="st">"%Y-%m-%d %H:%M:%S"</span>), <span class="at">tz =</span> <span class="st">"UTC"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>      <span class="co"># dplyr::filter(date &gt;= as.POSIXct("2024-08-14 12:00:00") &amp; date &lt;= as.POSIXct("2024-08-16 00:00:00"),</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(location <span class="sc">==</span> <span class="st">"Upper"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">day =</span> <span class="fu">as.Date</span>(date),</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">tide =</span> <span class="cn">NA</span>)</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>df_insitu <span class="sc">%&gt;%</span> </span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> temp, <span class="at">color =</span> location))<span class="sc">+</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>daily_max <span class="ot">&lt;-</span> df_insitu <span class="sc">%&gt;%</span> </span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(day) <span class="sc">%&gt;%</span> </span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">daily_max_insitu =</span> <span class="fu">max</span>(temp))</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>AirTemperature_MF <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">"Data/MeteoFrance/RAW/"</span>,<span class="at">pattern =</span> <span class="st">"HOR_departement_85_*"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(read.delim,</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">sep =</span> <span class="st">";"</span>,</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">.progress =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list_rbind</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(NOM_USUEL, LAT,LON,,AAAAMMJJHH,<span class="st">`</span><span class="at">T</span><span class="st">`</span>, TN, TX, T10, T20, T50,T100) <span class="sc">%&gt;%</span> </span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="st">`</span><span class="at">T</span><span class="st">`</span>), </span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>                NOM_USUEL <span class="sc">==</span> <span class="st">"NOIRMOUTIER EN"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.POSIXct</span>(<span class="fu">as.character</span>(AAAAMMJJHH), <span class="at">format =</span> <span class="st">"%Y%m%d%H"</span>,<span class="at">tz =</span> <span class="st">"UTC"</span>),</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>         <span class="at">day =</span> <span class="fu">as.Date</span>(date))</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>AirTemperature_MF_daily_max <span class="ot">&lt;-</span> AirTemperature_MF <span class="sc">%&gt;%</span> </span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(day) <span class="sc">%&gt;%</span> </span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">daily_max_MF =</span> <span class="fu">max</span>(<span class="st">`</span><span class="at">T</span><span class="st">`</span>))</span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>df_Temp <span class="ot">&lt;-</span> daily_max <span class="sc">%&gt;%</span> </span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(AirTemperature_MF_daily_max, <span class="at">by =</span> <span class="st">"day"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>day, <span class="at">names_to =</span> <span class="st">"source"</span>, <span class="at">values_to =</span> <span class="st">"temp"</span>)</span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>coltabl <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"daily_max_insitu"</span> <span class="ot">=</span> <span class="st">"#1f77b4"</span>, <span class="st">"daily_max_MF"</span> <span class="ot">=</span> <span class="st">"#ff7f0e"</span>)</span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>plot_temp <span class="ot">&lt;-</span> df_Temp <span class="sc">%&gt;%</span> </span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> source, <span class="at">y =</span> temp, <span class="at">color =</span> source))<span class="sc">+</span></span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">show.legend =</span> F)<span class="sc">+</span></span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> coltabl)<span class="sc">+</span></span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels=</span><span class="fu">c</span>(<span class="st">"daily_max_insitu"</span> <span class="ot">=</span> <span class="fu">expression</span>(<span class="fu">italic</span>(<span class="st">"in situ"</span>)), <span class="st">"daily_max_MF"</span> <span class="ot">=</span> <span class="st">"Meteo France"</span>))<span class="sc">+</span></span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Daily maximum temperature (°C)"</span>)<span class="sc">+</span></span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_Bede</span>()<span class="sc">+</span></span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">30</span>),</span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">30</span>),</span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">35</span>))</span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Paper/Figs/High_res/Temperature_compare.png"</span>, plot_temp, <span class="at">height =</span> <span class="dv">10</span>, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a>meandiff <span class="ot">&lt;-</span> df_Temp <span class="sc">%&gt;%</span> </span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(source) <span class="sc">%&gt;%</span> </span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">mean =</span><span class="fu">mean</span>(temp, <span class="at">na.rm =</span> T), </span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a>          <span class="at">sd =</span> <span class="fu">sd</span>(temp, <span class="at">na.rm =</span> T))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [12]:</pre></div><div id="cell-fig-Temperature_Bourgneuf" class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"Figs/High_res/Temperature_compare.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-Temperature_Bourgneuf" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-Temperature_Bourgneuf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="">
<a href="Figs/High_res/Temperature_compare.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4" title="Figure&nbsp;4: Comparison of daily maximum temperatures in August measured using an in-situ sensor (blue) and retrieved from Meteo France (orange). The solid line in the middle of the boxplot represents the median, the two ends of the box represent the 25th and 75th percentiles, and the whiskers represent values that are no more than 1.5 times the interquartile range."><img src="Figs/High_res/Temperature_compare.png" class="img-fluid figure-img" style="width:30.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Temperature_Bourgneuf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Comparison of daily maximum temperatures in August measured using an in-situ sensor (blue) and retrieved from Meteo France (orange). The solid line in the middle of the boxplot represents the median, the two ends of the box represent the 25th and 75th percentiles, and the whiskers represent values that are no more than 1.5 times the interquartile range.
</figcaption>
</figure>
</div>
</div>
</div></div>
<p>To experimentally apply temperatures that closely mimic those experienced by seagrasses in the field, <em>in situ</em> temperature sensors were placed at the sampling site in Bourgneuf Bay during August 2024. The daily maximum temperatures recorded by the <em>in situ</em> sensors were compared to those measured by the nearest weather station operated by Meteo France (<a href="#fig-Temperature_Bourgneuf" class="quarto-xref">Figure&nbsp;4</a>). On average, <em>in situ</em> temperatures were 3 ± 3.2°C higher than those recorded by Meteo France. Additionally, Meteo France temperatures were more stable compared to those from the <em>in situ</em> sensor. This stability is explained by the fact that Meteo France temperatures are measured in a sheltered, shaded location . This offset was used to adjust heatwave temperatures measured by Meteo France to reflect the conditions experienced by the seagrasses.</p>
<p>The control chamber was maintained at temperatures representative of the typical seasonal conditions: water temperatures between 18°C and 19°C and air temperatures between 18°C and 23°C, following circadian temperature variability (<a href="#fig-Profile" class="quarto-xref">Figure&nbsp;5</a> left). For the experimental treatment, the air temperature was set to mimic an atmospheric heatwave that occurred over the seagrass meadow of Quiberon, France (47°35’40.0”N, 3°07’30.0”W) from September 2, 2021, to September 6, 2021. On the first day of the experiment, air temperatures in the experimental chamber were set to range from 23°C at night to 35°C during the day, with a daily increase of 1°C. The water temperature in the experimental chamber was similarly adjusted to reflect the heatwave conditions, starting from the normal seasonal range (18°C) and gradually increasing to simulate the rising temperatures experienced during the heatwave (+0.5°C daily). This setup aimed to replicate the thermal stress experienced by the seagrass meadow during the actual heatwave event (<a href="#fig-Profile" class="quarto-xref">Figure&nbsp;5</a> right). The experiment stops only when no changes in the reflectance of the treatment are observed for 2 consecutive days.</p>
<div class="cell-container"><div class="cell-decorator"><pre>In [13]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MapRs)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Utilities.Package)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>experimental_design <span class="ot">&lt;-</span> <span class="fu">Make_Chamber_Profile</span>(<span class="at">min_Air_Temp_control =</span> <span class="dv">19</span>,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">max_Air_Temp_control =</span> <span class="dv">23</span>,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">min_Air_Temp_test =</span> <span class="dv">23</span>,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">max_Air_Temp_test =</span> <span class="dv">35</span>,</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">min_Water_Temp_control=</span> <span class="dv">18</span>, </span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">max_Water_Temp_control =</span> <span class="dv">18</span>,</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">min_Water_Temp_test =</span> <span class="dv">18</span>,</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">max_Water_Temp_test =</span> <span class="dv">18</span>,</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">date_start =</span> <span class="st">"2024-07-22 21:00:00"</span>,</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">date_end =</span> <span class="st">"2024-07-26 23:00:00"</span>,</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">low_tide_time =</span> <span class="st">"2024-07-23 12:00:00"</span>,</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">High_Tide_Until =</span> <span class="st">"2024-07-24 09:00:00"</span>,</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">daily_increase_Air_Test =</span> <span class="dv">1</span>,</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">daily_increase_Water_Test =</span> <span class="fl">0.5</span>,</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">daily_increase_Air_Control =</span> <span class="dv">0</span>,</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">daily_increase_Water_Control =</span> <span class="dv">0</span>,</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">sunrise =</span> <span class="fl">6.25</span>,</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">sunset =</span> <span class="dv">22</span>,</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">max_light_intensity =</span> <span class="dv">120</span>,</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">export_profile =</span> F,</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">Tide =</span> <span class="st">"both"</span>,</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">night_tide =</span> T,</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">time_step =</span> <span class="dv">60</span>, </span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">Save_Experiment =</span> F, </span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">Experiment_Name =</span> <span class="st">"HW5_24072024_to_26072024"</span>)</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>df_control <span class="ot">&lt;-</span> experimental_design<span class="sc">$</span>Control_df <span class="sc">%&gt;%</span> </span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Time <span class="sc">&gt;</span> <span class="fu">as.POSIXct</span>(<span class="st">"2024-07-24 00:00:00"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d %H:%M"</span>, <span class="at">tz =</span> <span class="st">"UTC"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">scenario =</span> <span class="st">"Control"</span>)</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>df_test <span class="ot">&lt;-</span> experimental_design<span class="sc">$</span>Test_df <span class="sc">%&gt;%</span> </span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Time <span class="sc">&gt;</span> <span class="fu">as.POSIXct</span>(<span class="st">"2024-07-24 00:00:00"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d %H:%M"</span>, <span class="at">tz =</span> <span class="st">"UTC"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">scenario =</span> <span class="st">"Test"</span>)</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df_control <span class="sc">%&gt;%</span> </span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(df_test)</span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>polygon_table <span class="ot">&lt;-</span>   df <span class="sc">%&gt;%</span> </span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(tide_ID) <span class="sc">%&gt;%</span> </span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">Tide_Status =</span> <span class="fu">unique</span>(Tide_Status), </span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>          <span class="at">xmin =</span> <span class="fu">min</span>(Time),</span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>          <span class="at">xmax =</span> <span class="fu">max</span>(Time),</span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>          <span class="at">T_min =</span> <span class="fu">min</span>(Temp_Air,Temp_Water),</span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>          <span class="at">T_max =</span> <span class="fu">max</span>(Temp_Air,Temp_Water)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">ymin =</span> <span class="fu">min</span>(T_min),</span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>          <span class="at">ymax =</span> <span class="fu">max</span>(T_max)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Tide =</span> Tide_Status) <span class="sc">%&gt;%</span> </span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Tide =</span> <span class="fu">case_when</span>(Tide <span class="sc">==</span> <span class="st">"High_Tide"</span> <span class="sc">~</span> <span class="st">"High Tide"</span>,</span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Low Tide"</span>))</span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a><span class="do">#### Test</span></span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a>water_polyline_test <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(scenario <span class="sc">==</span> <span class="st">"Test"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Tide_Status <span class="sc">==</span> <span class="st">"High_Tide"</span>) </span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a>air_polyline_test <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(scenario <span class="sc">==</span> <span class="st">"Test"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Tide_Status <span class="sc">==</span> <span class="st">"Low_Tide"</span>)</span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true" tabindex="-1"></a>max_air_temp_test <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb15-66"><a href="#cb15-66" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(scenario <span class="sc">==</span> <span class="st">"Test"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-67"><a href="#cb15-67" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Tide_Status <span class="sc">==</span> <span class="st">"Low_Tide"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-68"><a href="#cb15-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(tide_ID) <span class="sc">%&gt;%</span> </span>
<span id="cb15-69"><a href="#cb15-69" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Temp <span class="sc">==</span> <span class="fu">max</span>(Temp)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-70"><a href="#cb15-70" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Temp <span class="sc">&gt;=</span><span class="dv">35</span>)</span>
<span id="cb15-71"><a href="#cb15-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-72"><a href="#cb15-72" aria-hidden="true" tabindex="-1"></a>  cols_fill <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"High Tide"</span> <span class="ot">=</span> <span class="st">"gray1"</span>, <span class="st">"Low Tide"</span> <span class="ot">=</span> <span class="st">"gray50"</span>)</span>
<span id="cb15-73"><a href="#cb15-73" aria-hidden="true" tabindex="-1"></a>  cols_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Air Temperature"</span> <span class="ot">=</span> <span class="st">"red4"</span>, <span class="st">"Water Temperature"</span> <span class="ot">=</span> <span class="st">"blue3"</span>)</span>
<span id="cb15-74"><a href="#cb15-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-75"><a href="#cb15-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-76"><a href="#cb15-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-77"><a href="#cb15-77" aria-hidden="true" tabindex="-1"></a>plot_treatment <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb15-78"><a href="#cb15-78" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(scenario <span class="sc">==</span> <span class="st">"Test"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-79"><a href="#cb15-79" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb15-80"><a href="#cb15-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> Time, <span class="at">y =</span> Temp))<span class="sc">+</span></span>
<span id="cb15-81"><a href="#cb15-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="at">data =</span> polygon_table , <span class="fu">aes</span>(<span class="at">ymin =</span> <span class="dv">18</span>, <span class="at">ymax =</span> <span class="dv">39</span>, <span class="at">xmin =</span> xmin, <span class="at">xmax =</span>xmax, <span class="at">fill =</span> Tide, <span class="at">group =</span> tide_ID),<span class="at">alpha =</span> <span class="fl">0.1</span>,<span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb15-82"><a href="#cb15-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df  <span class="sc">%&gt;%</span> </span>
<span id="cb15-83"><a href="#cb15-83" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(Time <span class="sc">&gt;</span> <span class="fu">as.POSIXct</span>(<span class="st">"2024-07-24 09:00:00"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d %H:%M"</span>, <span class="at">tz =</span> <span class="st">"UTC"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-84"><a href="#cb15-84" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(scenario <span class="sc">==</span> <span class="st">"Test"</span>),</span>
<span id="cb15-85"><a href="#cb15-85" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> Time, <span class="at">y =</span> Temp_Water, <span class="at">color =</span> <span class="st">"Water Temperature"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>,<span class="at">show.legend =</span> F)<span class="sc">+</span></span>
<span id="cb15-86"><a href="#cb15-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> water_polyline_test, <span class="fu">aes</span>(<span class="at">x =</span> Time, <span class="at">y =</span> Temp, <span class="at">group =</span> tide_ID, <span class="at">color =</span> <span class="st">"Water Temperature"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>,<span class="at">show.legend =</span> F)<span class="sc">+</span></span>
<span id="cb15-87"><a href="#cb15-87" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_datetime</span>(<span class="at">date_breaks =</span> <span class="st">"6 hour"</span>, <span class="at">date_labels =</span> <span class="st">"%H:%M"</span>) <span class="sc">+</span></span>
<span id="cb15-88"><a href="#cb15-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> Time, <span class="at">y =</span> Temp_Air, <span class="at">color =</span> <span class="st">"Air Temperature"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>,<span class="at">show.legend =</span> F)<span class="sc">+</span></span>
<span id="cb15-89"><a href="#cb15-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> air_polyline_test, <span class="fu">aes</span>(<span class="at">x =</span> Time, <span class="at">y =</span> Temp, <span class="at">group =</span> tide_ID, <span class="at">color =</span> <span class="st">"Air Temperature"</span>),, <span class="at">linewidth =</span> <span class="dv">1</span>,<span class="at">show.legend =</span> F)<span class="sc">+</span></span>
<span id="cb15-90"><a href="#cb15-90" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">as.POSIXct</span>(<span class="st">"2024-07-24 03:00:00"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d %H:%M"</span>, <span class="at">tz =</span> <span class="st">"UTC"</span>), <span class="at">y =</span> <span class="fl">38.5</span>, <span class="at">label =</span> <span class="st">"Treatment"</span>), <span class="fu">aes</span>( <span class="at">x =</span> x, <span class="at">y =</span>y , <span class="at">label =</span> label), <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">10</span>)<span class="sc">+</span></span>
<span id="cb15-91"><a href="#cb15-91" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">"legend"</span>,</span>
<span id="cb15-92"><a href="#cb15-92" aria-hidden="true" tabindex="-1"></a>                      <span class="at">values =</span> cols_fill) <span class="sc">+</span></span>
<span id="cb15-93"><a href="#cb15-93" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"legend"</span>,</span>
<span id="cb15-94"><a href="#cb15-94" aria-hidden="true" tabindex="-1"></a>                       <span class="at">values =</span> cols_col) <span class="sc">+</span></span>
<span id="cb15-95"><a href="#cb15-95" aria-hidden="true" tabindex="-1"></a>   ggforce<span class="sc">::</span><span class="fu">geom_mark_ellipse</span>(<span class="at">data=</span>max_air_temp_test,</span>
<span id="cb15-96"><a href="#cb15-96" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">aes</span>(<span class="at">x=</span>Time,</span>
<span id="cb15-97"><a href="#cb15-97" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y=</span>Temp,</span>
<span id="cb15-98"><a href="#cb15-98" aria-hidden="true" tabindex="-1"></a>                     <span class="at">x0 =</span> Time, </span>
<span id="cb15-99"><a href="#cb15-99" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y0 =</span> Temp <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb15-100"><a href="#cb15-100" aria-hidden="true" tabindex="-1"></a>                     <span class="at">label =</span> <span class="fu">paste0</span>(Temp, <span class="st">" °C"</span>),</span>
<span id="cb15-101"><a href="#cb15-101" aria-hidden="true" tabindex="-1"></a>                     <span class="at">group =</span> tide_ID),</span>
<span id="cb15-102"><a href="#cb15-102" aria-hidden="true" tabindex="-1"></a>                     <span class="co"># description=Description),</span></span>
<span id="cb15-103"><a href="#cb15-103" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size=</span><span class="fl">0.3</span>,</span>
<span id="cb15-104"><a href="#cb15-104" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="st">"goldenrod"</span>,</span>
<span id="cb15-105"><a href="#cb15-105" aria-hidden="true" tabindex="-1"></a>                 <span class="at">con.colour =</span> <span class="st">"goldenrod4"</span>,</span>
<span id="cb15-106"><a href="#cb15-106" aria-hidden="true" tabindex="-1"></a>                 <span class="at">show.legend=</span>F,</span>
<span id="cb15-107"><a href="#cb15-107" aria-hidden="true" tabindex="-1"></a>                 <span class="at">label.fontsize =</span> <span class="dv">25</span>,</span>
<span id="cb15-108"><a href="#cb15-108" aria-hidden="true" tabindex="-1"></a>                 <span class="at">label.hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb15-109"><a href="#cb15-109" aria-hidden="true" tabindex="-1"></a>                 <span class="at">con.size =</span> <span class="dv">2</span>,</span>
<span id="cb15-110"><a href="#cb15-110" aria-hidden="true" tabindex="-1"></a>                 <span class="at">alpha=</span><span class="fl">0.8</span>,</span>
<span id="cb15-111"><a href="#cb15-111" aria-hidden="true" tabindex="-1"></a>  <span class="at">expand =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"mm"</span>) , </span>
<span id="cb15-112"><a href="#cb15-112" aria-hidden="true" tabindex="-1"></a>  <span class="at">radius =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"mm"</span>) ,</span>
<span id="cb15-113"><a href="#cb15-113" aria-hidden="true" tabindex="-1"></a>  <span class="at">label.fill =</span> <span class="cn">NA</span>,</span>
<span id="cb15-114"><a href="#cb15-114" aria-hidden="true" tabindex="-1"></a>  <span class="at">label.buffer =</span> <span class="fu">unit</span>(<span class="dv">5</span>, <span class="st">"mm"</span>))<span class="sc">+</span></span>
<span id="cb15-115"><a href="#cb15-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Temperature (°C)"</span>)<span class="sc">+</span></span>
<span id="cb15-116"><a href="#cb15-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">18</span>,<span class="dv">39</span>))<span class="sc">+</span></span>
<span id="cb15-117"><a href="#cb15-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">position =</span> <span class="st">"right"</span>) <span class="sc">+</span></span>
<span id="cb15-118"><a href="#cb15-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_Bede</span>()<span class="sc">+</span></span>
<span id="cb15-119"><a href="#cb15-119" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">25</span>, <span class="at">angle =</span> <span class="dv">45</span>, <span class="at">vjust =</span> <span class="fl">0.6</span>),</span>
<span id="cb15-120"><a href="#cb15-120" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">25</span>),</span>
<span id="cb15-121"><a href="#cb15-121" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">30</span>),</span>
<span id="cb15-122"><a href="#cb15-122" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">30</span>))</span>
<span id="cb15-123"><a href="#cb15-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-124"><a href="#cb15-124" aria-hidden="true" tabindex="-1"></a><span class="do">### Control </span></span>
<span id="cb15-125"><a href="#cb15-125" aria-hidden="true" tabindex="-1"></a>water_polyline_control <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb15-126"><a href="#cb15-126" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(scenario <span class="sc">==</span> <span class="st">"Control"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-127"><a href="#cb15-127" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Tide_Status <span class="sc">==</span> <span class="st">"High_Tide"</span>) </span>
<span id="cb15-128"><a href="#cb15-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-129"><a href="#cb15-129" aria-hidden="true" tabindex="-1"></a>air_polylines_control <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb15-130"><a href="#cb15-130" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(scenario <span class="sc">==</span> <span class="st">"Control"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-131"><a href="#cb15-131" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Tide_Status <span class="sc">==</span> <span class="st">"Low_Tide"</span>)</span>
<span id="cb15-132"><a href="#cb15-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-133"><a href="#cb15-133" aria-hidden="true" tabindex="-1"></a>max_air_temp_control <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb15-134"><a href="#cb15-134" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(scenario <span class="sc">==</span> <span class="st">"Control"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-135"><a href="#cb15-135" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Tide_Status <span class="sc">==</span> <span class="st">"Low_Tide"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-136"><a href="#cb15-136" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(tide_ID) <span class="sc">%&gt;%</span> </span>
<span id="cb15-137"><a href="#cb15-137" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Temp <span class="sc">==</span> <span class="fu">max</span>(Temp)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-138"><a href="#cb15-138" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Temp <span class="sc">&gt;=</span><span class="dv">20</span>)</span>
<span id="cb15-139"><a href="#cb15-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-140"><a href="#cb15-140" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cols_fill &lt;- c("High Tide" = "gray30", "Low Tide" = "gray90")</span></span>
<span id="cb15-141"><a href="#cb15-141" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cols_col &lt;- c("Air Temperature" = "red4", "Water Temperature" = "blue3")</span></span>
<span id="cb15-142"><a href="#cb15-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-143"><a href="#cb15-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-144"><a href="#cb15-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-145"><a href="#cb15-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-146"><a href="#cb15-146" aria-hidden="true" tabindex="-1"></a>plot_control <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb15-147"><a href="#cb15-147" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(scenario <span class="sc">==</span> <span class="st">"Control"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-148"><a href="#cb15-148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb15-149"><a href="#cb15-149" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> Time, <span class="at">y =</span> Temp),<span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb15-150"><a href="#cb15-150" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_rect</span>(<span class="at">data =</span> polygon_table , <span class="fu">aes</span>(<span class="at">ymin =</span> <span class="dv">18</span>, <span class="at">ymax =</span> <span class="dv">39</span>, <span class="at">xmin =</span> xmin, <span class="at">xmax =</span>xmax, <span class="at">fill =</span> Tide, <span class="at">group =</span> tide_ID),<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb15-151"><a href="#cb15-151" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">data =</span> df  <span class="sc">%&gt;%</span> </span>
<span id="cb15-152"><a href="#cb15-152" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(Time <span class="sc">&gt;</span> <span class="fu">as.POSIXct</span>(<span class="st">"2024-07-24 09:00:00"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d %H:%M"</span>, <span class="at">tz =</span> <span class="st">"UTC"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-153"><a href="#cb15-153" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(scenario <span class="sc">==</span> <span class="st">"Control"</span>),</span>
<span id="cb15-154"><a href="#cb15-154" aria-hidden="true" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">x =</span> Time, <span class="at">y =</span> Temp_Water, <span class="at">color =</span> <span class="st">"Water Temperature"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>)<span class="sc">+</span></span>
<span id="cb15-155"><a href="#cb15-155" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">data =</span> water_polyline_control, <span class="fu">aes</span>(<span class="at">x =</span> Time, <span class="at">y =</span> Temp, <span class="at">group =</span> tide_ID, <span class="at">color =</span> <span class="st">"Water Temperature"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb15-156"><a href="#cb15-156" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_datetime</span>(<span class="at">date_breaks =</span> <span class="st">"6 hour"</span>, <span class="at">date_labels =</span> <span class="st">"%H:%M"</span>) <span class="sc">+</span></span>
<span id="cb15-157"><a href="#cb15-157" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> Time, <span class="at">y =</span> Temp_Air, <span class="at">color =</span> <span class="st">"Air Temperature"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>)<span class="sc">+</span></span>
<span id="cb15-158"><a href="#cb15-158" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">data =</span> air_polylines_control, <span class="fu">aes</span>(<span class="at">x =</span> Time, <span class="at">y =</span> Temp, <span class="at">group =</span> tide_ID, <span class="at">color =</span> <span class="st">"Air Temperature"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb15-159"><a href="#cb15-159" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">as.POSIXct</span>(<span class="st">"2024-07-24 03:00:00"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d %H:%M"</span>, <span class="at">tz =</span> <span class="st">"UTC"</span>), <span class="at">y =</span> <span class="fl">38.5</span>, <span class="at">label =</span> <span class="st">"Control"</span>), <span class="fu">aes</span>( <span class="at">x =</span> x, <span class="at">y =</span>y , <span class="at">label =</span> label), <span class="at">hjust =</span> <span class="dv">0</span>,<span class="at">size =</span> <span class="dv">10</span>)<span class="sc">+</span></span>
<span id="cb15-160"><a href="#cb15-160" aria-hidden="true" tabindex="-1"></a>    ggforce<span class="sc">::</span><span class="fu">geom_mark_ellipse</span>(<span class="at">data=</span>max_air_temp_control,</span>
<span id="cb15-161"><a href="#cb15-161" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">aes</span>(<span class="at">x=</span>Time,</span>
<span id="cb15-162"><a href="#cb15-162" aria-hidden="true" tabindex="-1"></a>                       <span class="at">y=</span><span class="fu">round</span>(Temp,<span class="dv">0</span>),</span>
<span id="cb15-163"><a href="#cb15-163" aria-hidden="true" tabindex="-1"></a>                       <span class="at">x0 =</span> Time, </span>
<span id="cb15-164"><a href="#cb15-164" aria-hidden="true" tabindex="-1"></a>                       <span class="at">y0 =</span> Temp <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb15-165"><a href="#cb15-165" aria-hidden="true" tabindex="-1"></a>                       <span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(Temp,<span class="dv">0</span>), <span class="st">" °C"</span>),</span>
<span id="cb15-166"><a href="#cb15-166" aria-hidden="true" tabindex="-1"></a>                       <span class="at">group =</span> tide_ID),</span>
<span id="cb15-167"><a href="#cb15-167" aria-hidden="true" tabindex="-1"></a>                       <span class="co"># description=Description),</span></span>
<span id="cb15-168"><a href="#cb15-168" aria-hidden="true" tabindex="-1"></a>                   <span class="at">size=</span><span class="fl">0.3</span>,</span>
<span id="cb15-169"><a href="#cb15-169" aria-hidden="true" tabindex="-1"></a>                   <span class="at">fill =</span> <span class="st">"goldenrod"</span>,</span>
<span id="cb15-170"><a href="#cb15-170" aria-hidden="true" tabindex="-1"></a>                   <span class="at">con.colour =</span> <span class="st">"goldenrod4"</span>,</span>
<span id="cb15-171"><a href="#cb15-171" aria-hidden="true" tabindex="-1"></a>                   <span class="at">show.legend=</span>F,</span>
<span id="cb15-172"><a href="#cb15-172" aria-hidden="true" tabindex="-1"></a>                   <span class="at">label.fontsize =</span> <span class="dv">25</span>,</span>
<span id="cb15-173"><a href="#cb15-173" aria-hidden="true" tabindex="-1"></a>                   <span class="at">label.hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb15-174"><a href="#cb15-174" aria-hidden="true" tabindex="-1"></a>                   <span class="at">con.size =</span> <span class="dv">2</span>,</span>
<span id="cb15-175"><a href="#cb15-175" aria-hidden="true" tabindex="-1"></a>                   <span class="at">alpha=</span><span class="fl">0.8</span>,</span>
<span id="cb15-176"><a href="#cb15-176" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"mm"</span>) , </span>
<span id="cb15-177"><a href="#cb15-177" aria-hidden="true" tabindex="-1"></a>    <span class="at">radius =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"mm"</span>) ,</span>
<span id="cb15-178"><a href="#cb15-178" aria-hidden="true" tabindex="-1"></a>    <span class="at">label.fill =</span> <span class="cn">NA</span>,</span>
<span id="cb15-179"><a href="#cb15-179" aria-hidden="true" tabindex="-1"></a>    <span class="at">label.buffer =</span> <span class="fu">unit</span>(<span class="dv">5</span>, <span class="st">"mm"</span>))<span class="sc">+</span></span>
<span id="cb15-180"><a href="#cb15-180" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">"legend"</span>,</span>
<span id="cb15-181"><a href="#cb15-181" aria-hidden="true" tabindex="-1"></a>                      <span class="at">values =</span> cols_fill) <span class="sc">+</span></span>
<span id="cb15-182"><a href="#cb15-182" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"legend"</span>,</span>
<span id="cb15-183"><a href="#cb15-183" aria-hidden="true" tabindex="-1"></a>                       <span class="at">values =</span> cols_col) <span class="sc">+</span></span>
<span id="cb15-184"><a href="#cb15-184" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Temperature (°C)"</span>)<span class="sc">+</span></span>
<span id="cb15-185"><a href="#cb15-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-186"><a href="#cb15-186" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">18</span>,<span class="dv">39</span>))<span class="sc">+</span></span>
<span id="cb15-187"><a href="#cb15-187" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_Bede</span>()<span class="sc">+</span></span>
<span id="cb15-188"><a href="#cb15-188" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.16</span>,.<span class="dv">8</span>),</span>
<span id="cb15-189"><a href="#cb15-189" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span>scales<span class="sc">::</span><span class="fu">alpha</span>(<span class="st">'white'</span>, <span class="fl">0.8</span>)),</span>
<span id="cb15-190"><a href="#cb15-190" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb15-191"><a href="#cb15-191" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb15-192"><a href="#cb15-192" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="fl">0.7</span>,<span class="st">"cm"</span>),</span>
<span id="cb15-193"><a href="#cb15-193" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.spacing =</span> <span class="fu">unit</span>(<span class="dv">0</span>,<span class="st">"mm"</span>),</span>
<span id="cb15-194"><a href="#cb15-194" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">25</span>,<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">vjust =</span> <span class="fl">0.6</span>),</span>
<span id="cb15-195"><a href="#cb15-195" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">25</span>),</span>
<span id="cb15-196"><a href="#cb15-196" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">30</span>),</span>
<span id="cb15-197"><a href="#cb15-197" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">30</span>))</span>
<span id="cb15-198"><a href="#cb15-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-199"><a href="#cb15-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-200"><a href="#cb15-200" aria-hidden="true" tabindex="-1"></a>plt <span class="ot">&lt;-</span> plot_control <span class="sc">+</span> plot_treatment</span>
<span id="cb15-201"><a href="#cb15-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-202"><a href="#cb15-202" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Paper/Figs/High_res/Chamber_Profils.png"</span>,plt, <span class="at">height =</span> <span class="dv">874</span><span class="sc">*</span><span class="dv">4</span>, <span class="at">width =</span> <span class="dv">1911</span><span class="sc">*</span><span class="dv">4</span>, <span class="at">unit=</span> <span class="st">"px"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [14]:</pre></div><div id="cell-fig-Profile" class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"Figs/Low_res/Chamber_Profils.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-Profile" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-Profile-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="">
<a href="Figs/Low_res/Chamber_Profils.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5" title="Figure&nbsp;5: Temperature profiles of both the control (left) and the treatment (right) followed during the heatwave experiment. The red line indicates air temperature, whereas the blue line indicates water temperature. Due to the tidal cycle followed during the experiment, the seagrasses only experience temperatures representade by solid lines."><img src="Figs/Low_res/Chamber_Profils.png" class="img-fluid figure-img" style="width:100.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Profile-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Temperature profiles of both the control (left) and the treatment (right) followed during the heatwave experiment. The red line indicates air temperature, whereas the blue line indicates water temperature. Due to the tidal cycle followed during the experiment, the seagrasses only experience temperatures representade by solid lines.
</figcaption>
</figure>
</div>
</div>
</div></div>
</section>
<section id="bio-optical-measurmenents-over-seagrass-leaves" class="level3" data-number="2.2.3">
<h3 data-number="2.2.3" class="anchored" data-anchor-id="bio-optical-measurmenents-over-seagrass-leaves"><span class="header-section-number">2.2.3</span> Bio-optical measurmenents over seagrass leaves</h3>
<section id="hyperspectral-measurements" class="level4" data-number="2.2.3.1">
<h4 data-number="2.2.3.1" class="anchored" data-anchor-id="hyperspectral-measurements"><span class="header-section-number">2.2.3.1</span> Hyperspectral measurements</h4>
<p>Throughout the experiment, hyperspectral signatures of both the control and treatment seagrasses were taken using an ASD HandHeld 2 equipped with a fiber optic, allowing measurements to be taken directly inside the chamber without opening it. Automatic spectra acquisition has been done using the <a href="https://www.malvernpanalytical.com/en/learn/knowledge-center/user-manuals/rs3-software-user-manual">RS3 softaware</a> developed by the intrument manufacturer. An average of five reflectance spectrum (<span class="math inline">\(R(\lambda)\)</span>), each with an integration time of 544 ms, was taken every minute. Every 10 minutes, the fiber optic was switched from one benthic chamber to the other, in order to measure reflectance in both treatment and control. Because light conditions were controlled inside of the chambers, reflectance calibration of the instrument was performed only each morning at the very first moment of low tide using a Spectralon white reference with 99% Lambertian reflectivity.</p>
<p>The second derivative of <span class="math inline">\(R\)</span> was calculated to retrieve absorption features and compare their variability over time. Two radiometric indices were also monitored throughout the experiment :</p>
<ul>
<li>The Normalized Difference Vegetation Index (NDVI, <span class="citation" data-cites="rouse1974monitoring">Rouse et al. (<a href="#ref-rouse1974monitoring" role="doc-biblioref">1974</a>)</span>), as a proxy of the concentration of chlorophyll-a (<a href="#eq-ndvi" class="quarto-xref">Equation&nbsp;1</a>)</li>
</ul>
<p><span id="eq-ndvi"><span class="math display">\[
NDVI = \frac{R(840)-R(668)}{R(840)+R(668)}
\tag{1}\]</span></span></p>
<p>where <span class="math inline">\(R(840)\)</span> and <span class="math inline">\(R(668)\)</span> are the reflectance at 840 nm and 668 nm respectively.</p>
<ul>
<li>The Seagrass Percent Covers, developed by <span class="citation" data-cites="zoffoli2020sentinel">Zoffoli et al. (<a href="#ref-zoffoli2020sentinel" role="doc-biblioref">2020</a>)</span>, used to assess proportion of seagrass inside of a pixel (<a href="#eq-spc" class="quarto-xref">Equation&nbsp;2</a>):</li>
</ul>
<p><span id="eq-spc"><span class="math display">\[
SPC = 172.06 \times NDVI - 22.18
\tag{2}\]</span></span></p>
<ul>
<li>The Green Leaf Index (GLI, <span class="citation" data-cites="louhaichi2001spatially">Louhaichi et al. (<a href="#ref-louhaichi2001spatially" role="doc-biblioref">2001</a>)</span>), as a measurement of the greenness of seagrass leafs (<a href="#eq-gli" class="quarto-xref">Equation&nbsp;3</a>)</li>
</ul>
<p><span id="eq-gli"><span class="math display">\[
GLI = \frac{[R(550)-R(668)]+[R(550)-R(450)]}{(2 \times R(550) )+ R(668) + R(450) }
\tag{3}\]</span></span></p>
<p>where <span class="math inline">\(R(550)\)</span> and <span class="math inline">\(R(450)\)</span> are the reflectance in green at 550 nm and in the blue at 450 nm, respectively.</p>
<ul>
<li>The Mid-Infrared Water Absorption Index (MIWAI), proposed here and designed to measure water absorption at 970 nm (<strong>REF</strong>), estimates the difference between the reflectance at 970 nm and a linear interpolation of the reflectance values at 950 and 990 nm. This interpolation represents the expected reflectance value in the absence of water.</li>
</ul>
<p><span id="eq-MIWAI"><span class="math display">\[
MIWAI = 0.5 \times [R(990)+R(950)]-R(970)
\tag{4}\]</span></span></p>
<p>where <span class="math inline">\(R(990)\)</span>, <span class="math inline">\(R(970)\)</span> and <span class="math inline">\(R(950)\)</span> are the reflectance in the infrared at 990, 970 and 950 nm, respectively.</p>
<blockquote class="blockquote">
<h4 id="multispectral-imagery-measurement" data-number="2.2.3.2" class="anchored"><span class="header-section-number">2.2.3.2</span> Multispectral imagery measurement</h4>
<p>Parallel to hyperspectral measurements, multispectral images were taken at the beginning and end of each diurnal low tide (09:00 am and 03:00 pm). A Micasense RedEdge-MX Dual multispectral camera, originally designed to be mounted on a drone, was modified for use without a drone. A 3D-printed mount was designed to attach the camera to the intertidal chamber and ensure that each picture was captured under the same conditions. At each time step (09:00 am and 03:00 pm), a first picture of the Spectralon was taken to allow for image correction in reflectance, followed by a second picture of the target. <a href="https://sigoiry.github.io/DISCOV-MicaSense/">DISCOV</a>, a Neural Network classification model previously developed to map intertidal vegetation using drone imagery, has been applied to each image taken inside the intertidal chambers. To understand the behavior of the model on seagrasses affected by heatwaves, classification images from before and after the heatwave have been compared.</p>
</blockquote>
</section>
<section id="pigment-concentration-measurements" class="level4" data-number="2.2.3.3">
<h4 data-number="2.2.3.3" class="anchored" data-anchor-id="pigment-concentration-measurements"><span class="header-section-number">2.2.3.3</span> Pigment concentration measurements</h4>
<p>At the beginning and the end of each diurnal low tide (09:00 am and 03:00 pm) leaves samples have been took in both the test and the control. leaves sampled have been stored under -80°C waiting for analysis. Before pigment extraction, each sample was lyophilized and its dry weight was measured. Pigment composition and biomass were analyzed using high-performance liquid chromatography (HPLC). The HPLC system (Alliance HPLC 248 System, Waters) was equipped with a reverse-phase C-18 separating column (SunFire C-18 Column, 100Å, 3.5 µm, 2.1 mm x 50 mm, Waters), preceded by a precolumn (VanGuard 3.9 mm x 5 mm, Waters). The system also included a photodiode array detector (2998 PDA) and a fluorimeter (Ex: 425 nm, Em: 655 nm; RF-20A, SH</p>
<p><strong>Au secours Philippe !!!</strong></p>
</section>
</section>
</section>
</section>
<section id="results" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Results</h1>
<section id="heatwaves-of-quiberon" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="heatwaves-of-quiberon"><span class="header-section-number">3.1</span> Heatwaves of Quiberon</h2>
<section id="spectral-inspection" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="spectral-inspection"><span class="header-section-number">3.1.1</span> Spectral inspection</h3>
<div class="cell-container"><div class="cell-decorator"><pre>In [15]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ncdf4)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(heatwaveR)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Utilities.Package)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="do">######### NC PLOTTING ################</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>file_path <span class="ot">&lt;-</span> <span class="st">"Data/SST/cmems_obs-sst_atl_phy_my_l3s_P1D-m_1729089512246.nc"</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>nc <span class="ot">&lt;-</span> <span class="fu">nc_open</span>(file_path)</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the temperature variable (adjust the variable name if different)</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>temp_var_name <span class="ot">&lt;-</span> <span class="st">"adjusted_sea_surface_temperature"</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>temperature_data <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc, temp_var_name)</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the longitude and latitude variables (adjust variable names if different)</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>lon <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc, <span class="st">"longitude"</span>)</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>lat <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc, <span class="st">"latitude"</span>)</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the mean SST over time at each grid point</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>mean_sst_map <span class="ot">&lt;-</span> <span class="fu">apply</span>(temperature_data, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), sd, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the 2D array to a data frame for plotting</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>mean_sst_df <span class="ot">&lt;-</span> <span class="fu">melt</span>(mean_sst_map, <span class="at">varnames =</span> <span class="fu">c</span>(<span class="st">"lon_idx"</span>, <span class="st">"lat_idx"</span>), <span class="at">value.name =</span> <span class="st">"mean_sst"</span>)</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>mean_sst_df<span class="sc">$</span>lon <span class="ot">&lt;-</span> lon[mean_sst_df<span class="sc">$</span>lon_idx]</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>mean_sst_df<span class="sc">$</span>lat <span class="ot">&lt;-</span> lat[mean_sst_df<span class="sc">$</span>lat_idx]</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert Kelvin to Celsius if necessary</span></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>mean_sst_df<span class="sc">$</span>mean_sst_celsius <span class="ot">&lt;-</span> mean_sst_df<span class="sc">$</span>mean_sst <span class="sc">-</span> <span class="fl">273.15</span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the mean SST map</span></span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">data =</span> mean_sst_df,  <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> lon, <span class="at">y =</span> lat, <span class="at">fill =</span> mean_sst_celsius)) <span class="sc">+</span></span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_polygon(data = poly, mapping = aes(x = x, y = y, group = id), alpha = 0.8)+</span></span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"inferno"</span>) <span class="sc">+</span></span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Mean Sea Surface Temperature"</span>, <span class="at">fill =</span> <span class="st">"Temperature (°C)"</span>) <span class="sc">+</span></span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a><span class="do">##### NC opening and processing ######</span></span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a>file_path <span class="ot">&lt;-</span> <span class="st">"Data/SST/cmems_obs-sst_atl_phy_my_l3s_P1D-m_1729089512246.nc"</span></span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Open the NetCDF file</span></span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>nc <span class="ot">&lt;-</span> <span class="fu">nc_open</span>(file_path)</span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the temperature variable (adjust the variable name if different)</span></span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a>temp_var_name <span class="ot">&lt;-</span> <span class="st">"adjusted_sea_surface_temperature"</span></span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a>temperature_data <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc, temp_var_name)</span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the time variable</span></span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a>time_data <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc, <span class="st">"time"</span>)  <span class="co"># Adjust "time" if the name is different</span></span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the longitude and latitude variables</span></span>
<span id="cb17-62"><a href="#cb17-62" aria-hidden="true" tabindex="-1"></a>lon <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc, <span class="st">"longitude"</span>)  <span class="co"># Adjust "longitude" if the name is different</span></span>
<span id="cb17-63"><a href="#cb17-63" aria-hidden="true" tabindex="-1"></a>lat <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc, <span class="st">"latitude"</span>)   <span class="co"># Adjust "latitude" if the name is different</span></span>
<span id="cb17-64"><a href="#cb17-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-65"><a href="#cb17-65" aria-hidden="true" tabindex="-1"></a>lon_min <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">3.5</span></span>
<span id="cb17-66"><a href="#cb17-66" aria-hidden="true" tabindex="-1"></a>lon_max <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">2.7</span></span>
<span id="cb17-67"><a href="#cb17-67" aria-hidden="true" tabindex="-1"></a>lat_min <span class="ot">&lt;-</span> <span class="fl">47.3</span></span>
<span id="cb17-68"><a href="#cb17-68" aria-hidden="true" tabindex="-1"></a>lat_max <span class="ot">&lt;-</span> <span class="fl">47.7</span></span>
<span id="cb17-69"><a href="#cb17-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust longitudes if they are in the range [0, 360]</span></span>
<span id="cb17-70"><a href="#cb17-70" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">max</span>(lon) <span class="sc">&gt;</span> <span class="dv">180</span>) {</span>
<span id="cb17-71"><a href="#cb17-71" aria-hidden="true" tabindex="-1"></a>  lon <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(lon <span class="sc">&gt;</span> <span class="dv">180</span>, lon <span class="sc">-</span> <span class="dv">360</span>, lon)</span>
<span id="cb17-72"><a href="#cb17-72" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-73"><a href="#cb17-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-74"><a href="#cb17-74" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the indices of lon and lat within the bounding box</span></span>
<span id="cb17-75"><a href="#cb17-75" aria-hidden="true" tabindex="-1"></a>lon_indices <span class="ot">&lt;-</span> <span class="fu">which</span>(lon <span class="sc">&gt;=</span> lon_min <span class="sc">&amp;</span> lon <span class="sc">&lt;=</span> lon_max)</span>
<span id="cb17-76"><a href="#cb17-76" aria-hidden="true" tabindex="-1"></a>lat_indices <span class="ot">&lt;-</span> <span class="fu">which</span>(lat <span class="sc">&gt;=</span> lat_min <span class="sc">&amp;</span> lat <span class="sc">&lt;=</span> lat_max)</span>
<span id="cb17-77"><a href="#cb17-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-78"><a href="#cb17-78" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset the temperature data</span></span>
<span id="cb17-79"><a href="#cb17-79" aria-hidden="true" tabindex="-1"></a>temperature_data_subset <span class="ot">&lt;-</span> temperature_data[lon_indices, lat_indices, ]</span>
<span id="cb17-80"><a href="#cb17-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-81"><a href="#cb17-81" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the mean temperature over the spatial dimensions for each time point</span></span>
<span id="cb17-82"><a href="#cb17-82" aria-hidden="true" tabindex="-1"></a>mean_temperature <span class="ot">&lt;-</span> <span class="fu">apply</span>(temperature_data_subset, <span class="dv">3</span>, mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-83"><a href="#cb17-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-84"><a href="#cb17-84" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert time data to POSIXct format (adjust the origin if necessary)</span></span>
<span id="cb17-85"><a href="#cb17-85" aria-hidden="true" tabindex="-1"></a>sst <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">time =</span> time_data, <span class="at">sst =</span> mean_temperature) <span class="sc">%&gt;%</span></span>
<span id="cb17-86"><a href="#cb17-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time =</span> <span class="fu">as.POSIXct</span>(time, <span class="at">origin =</span> <span class="st">"1970-01-01"</span>))</span>
<span id="cb17-87"><a href="#cb17-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-88"><a href="#cb17-88" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the SST over time</span></span>
<span id="cb17-89"><a href="#cb17-89" aria-hidden="true" tabindex="-1"></a>sst <span class="sc">%&gt;%</span></span>
<span id="cb17-90"><a href="#cb17-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(sst)) <span class="sc">%&gt;%</span></span>
<span id="cb17-91"><a href="#cb17-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> sst <span class="sc">-</span> <span class="fl">273.15</span>)) <span class="sc">+</span></span>
<span id="cb17-92"><a href="#cb17-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb17-93"><a href="#cb17-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"glm"</span>) <span class="sc">+</span></span>
<span id="cb17-94"><a href="#cb17-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Time"</span>, <span class="at">y =</span> <span class="st">"SST (°C)"</span>, <span class="at">title =</span> <span class="st">"Mean SST around Quiberon Over Time"</span>)</span>
<span id="cb17-95"><a href="#cb17-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-96"><a href="#cb17-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-97"><a href="#cb17-97" aria-hidden="true" tabindex="-1"></a><span class="do">#### HEATWAVE DETECTION ########</span></span>
<span id="cb17-98"><a href="#cb17-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-99"><a href="#cb17-99" aria-hidden="true" tabindex="-1"></a>df_heatwaveR <span class="ot">&lt;-</span> sst <span class="sc">%&gt;%</span> </span>
<span id="cb17-100"><a href="#cb17-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">t =</span> time,</span>
<span id="cb17-101"><a href="#cb17-101" aria-hidden="true" tabindex="-1"></a>         <span class="at">temp =</span> sst) <span class="sc">%&gt;%</span></span>
<span id="cb17-102"><a href="#cb17-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">t =</span> <span class="fu">as.Date</span>(t),</span>
<span id="cb17-103"><a href="#cb17-103" aria-hidden="true" tabindex="-1"></a>         <span class="at">temp =</span> temp <span class="sc">-</span> <span class="fl">273.15</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-104"><a href="#cb17-104" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(t,temp) </span>
<span id="cb17-105"><a href="#cb17-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-106"><a href="#cb17-106" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-107"><a href="#cb17-107" aria-hidden="true" tabindex="-1"></a>  df_heatwaveR[<span class="fu">which</span>(df_heatwaveR<span class="sc">$</span>t <span class="sc">==</span> <span class="fu">as.Date</span>(<span class="st">"2021-09-07"</span>)),]<span class="sc">$</span>temp <span class="ot">=</span> df_heatwaveR[<span class="fu">which</span>(df_heatwaveR<span class="sc">$</span>t <span class="sc">==</span> <span class="fu">as.Date</span>(<span class="st">"2021-09-07"</span>)),]<span class="sc">$</span>temp <span class="sc">+</span><span class="fl">0.8</span> </span>
<span id="cb17-108"><a href="#cb17-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-109"><a href="#cb17-109" aria-hidden="true" tabindex="-1"></a>  clim <span class="ot">&lt;-</span> <span class="fu">ts2clm</span>(df_heatwaveR, <span class="at">climatologyPeriod =</span> <span class="fu">c</span>(<span class="fu">min</span>(df_heatwaveR<span class="sc">$</span>t), <span class="fu">max</span>(df_heatwaveR<span class="sc">$</span>t)))</span>
<span id="cb17-110"><a href="#cb17-110" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-111"><a href="#cb17-111" aria-hidden="true" tabindex="-1"></a>  event <span class="ot">&lt;-</span> <span class="fu">detect_event</span>(clim,<span class="at">categories =</span> T,<span class="at">minDuration =</span> <span class="dv">3</span>)</span>
<span id="cb17-112"><a href="#cb17-112" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">detect_event</span>(clim, <span class="at">minDuration =</span> <span class="dv">3</span>)</span>
<span id="cb17-113"><a href="#cb17-113" aria-hidden="true" tabindex="-1"></a>  mhw <span class="ot">&lt;-</span> res<span class="sc">$</span>clim</span>
<span id="cb17-114"><a href="#cb17-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-115"><a href="#cb17-115" aria-hidden="true" tabindex="-1"></a>  mhw_filled <span class="ot">&lt;-</span> mhw <span class="sc">%&gt;%</span></span>
<span id="cb17-116"><a href="#cb17-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(t) <span class="sc">%&gt;%</span></span>
<span id="cb17-117"><a href="#cb17-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-118"><a href="#cb17-118" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Replace NaN with NA for compatibility</span></span>
<span id="cb17-119"><a href="#cb17-119" aria-hidden="true" tabindex="-1"></a>    <span class="at">temp =</span> <span class="fu">ifelse</span>(<span class="fu">is.nan</span>(temp), <span class="cn">NA</span>, temp),</span>
<span id="cb17-120"><a href="#cb17-120" aria-hidden="true" tabindex="-1"></a>    <span class="at">missing =</span> <span class="fu">case_when</span>(<span class="fu">is.na</span>(temp) <span class="sc">~</span> T,</span>
<span id="cb17-121"><a href="#cb17-121" aria-hidden="true" tabindex="-1"></a>                        T <span class="sc">~</span> F),</span>
<span id="cb17-122"><a href="#cb17-122" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert Date to numeric if it's not already</span></span>
<span id="cb17-123"><a href="#cb17-123" aria-hidden="true" tabindex="-1"></a>    <span class="at">Date_num =</span> <span class="fu">as.numeric</span>(t),</span>
<span id="cb17-124"><a href="#cb17-124" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Perform linear interpolation</span></span>
<span id="cb17-125"><a href="#cb17-125" aria-hidden="true" tabindex="-1"></a>    <span class="at">temp =</span> <span class="fu">approx</span>(</span>
<span id="cb17-126"><a href="#cb17-126" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> Date_num[<span class="sc">!</span><span class="fu">is.na</span>(temp)],</span>
<span id="cb17-127"><a href="#cb17-127" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> temp[<span class="sc">!</span><span class="fu">is.na</span>(temp)],</span>
<span id="cb17-128"><a href="#cb17-128" aria-hidden="true" tabindex="-1"></a>      <span class="at">xout =</span> Date_num,</span>
<span id="cb17-129"><a href="#cb17-129" aria-hidden="true" tabindex="-1"></a>      <span class="at">method =</span> <span class="st">"linear"</span>,</span>
<span id="cb17-130"><a href="#cb17-130" aria-hidden="true" tabindex="-1"></a>      <span class="at">rule =</span> <span class="dv">2</span></span>
<span id="cb17-131"><a href="#cb17-131" aria-hidden="true" tabindex="-1"></a>    )<span class="sc">$</span>y</span>
<span id="cb17-132"><a href="#cb17-132" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb17-133"><a href="#cb17-133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Date_num) </span>
<span id="cb17-134"><a href="#cb17-134" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-135"><a href="#cb17-135" aria-hidden="true" tabindex="-1"></a>  mhw_segments <span class="ot">&lt;-</span> mhw_filled <span class="sc">%&gt;%</span></span>
<span id="cb17-136"><a href="#cb17-136" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-137"><a href="#cb17-137" aria-hidden="true" tabindex="-1"></a>    <span class="at">t_lead =</span> <span class="fu">lead</span>(t),</span>
<span id="cb17-138"><a href="#cb17-138" aria-hidden="true" tabindex="-1"></a>    <span class="at">temp_lead =</span> <span class="fu">lead</span>(temp),</span>
<span id="cb17-139"><a href="#cb17-139" aria-hidden="true" tabindex="-1"></a>    <span class="at">missing_lead =</span> <span class="fu">lead</span>(missing)</span>
<span id="cb17-140"><a href="#cb17-140" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb17-141"><a href="#cb17-141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(t_lead)) <span class="sc">%&gt;%</span></span>
<span id="cb17-142"><a href="#cb17-142" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-143"><a href="#cb17-143" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Determine linetype based on missingness of adjacent points</span></span>
<span id="cb17-144"><a href="#cb17-144" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="fu">ifelse</span>(missing <span class="sc">&amp;</span> missing_lead, <span class="st">"solid"</span>, <span class="st">"dashed"</span>)</span>
<span id="cb17-145"><a href="#cb17-145" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [16]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">"Data/MeteoFrance/RAW/"</span>,<span class="at">pattern =</span> <span class="st">"HOR_departement_56_*"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(read.delim,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">sep =</span> <span class="st">";"</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">.progress =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list_rbind</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(NOM_USUEL, LAT,LON,,AAAAMMJJHH,<span class="st">`</span><span class="at">T</span><span class="st">`</span>, TN, TX, T10, T20, T50,T100) <span class="sc">%&gt;%</span> </span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="st">`</span><span class="at">T</span><span class="st">`</span>)) </span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>station <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(NOM_USUEL) <span class="sc">%&gt;%</span> </span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">Lat =</span> <span class="fu">unique</span>(LAT),</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">Lon =</span> <span class="fu">unique</span>(LON),</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>          <span class="at">n_obs =</span> <span class="fu">n</span>())</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>sovereignty10 <span class="ot">&lt;-</span> rnaturalearth<span class="sc">::</span><span class="fu">ne_countries</span>(<span class="at">scale =</span> <span class="dv">10</span>, <span class="at">returnclass =</span> <span class="st">"sf"</span>)</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>France_shp <span class="ot">&lt;-</span> sovereignty10 <span class="sc">%&gt;%</span> </span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(sovereignt<span class="sc">%in%</span><span class="fu">c</span>(<span class="st">"France"</span>)) </span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>bbox_france <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(<span class="fu">c</span>(<span class="at">xmin =</span> <span class="fu">min</span>(station<span class="sc">$</span>Lon),</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>                         <span class="at">ymin =</span> <span class="fu">min</span>(station<span class="sc">$</span>Lat),</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>                         <span class="at">xmax =</span> <span class="fu">max</span>(station<span class="sc">$</span>Lon),</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>                         <span class="at">ymax =</span> <span class="fu">max</span>(station<span class="sc">$</span>Lat)),</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>                       <span class="at">crs =</span> <span class="fu">st_crs</span>(France_shp)) </span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>France_map_cropped <span class="ot">&lt;-</span> France_shp <span class="sc">%&gt;%</span> </span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_crop</span>(bbox_france) <span class="sc">%&gt;%</span></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>()</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>station_shp <span class="ot">&lt;-</span> station <span class="sc">%&gt;%</span> </span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords=</span><span class="fu">c</span>(<span class="st">"Lon"</span>,<span class="st">"Lat"</span>) )  <span class="sc">%&gt;%</span> </span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_set_crs</span>(<span class="st">"EPSG:4326"</span>) </span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot() +</span></span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_sf(data = France_map_cropped,linewidth=0.5,alpha=0.93,</span></span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a><span class="co">#           fill="#CFCFCF",colour="grey30")+</span></span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggforce::geom_mark_ellipse(data=station,</span></span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a><span class="co">#                  aes(x=Lon,</span></span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a><span class="co">#                      y=Lat,</span></span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a><span class="co">#                      label = paste("n: ", n_obs),</span></span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a><span class="co">#                      description=NOM_USUEL) ,</span></span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a><span class="co">#                  linewidth=0.2,</span></span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a><span class="co">#                  fill="goldenrod",</span></span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a><span class="co">#                  show.legend=F,</span></span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a><span class="co">#                  label.hjust = 0.2,</span></span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a><span class="co">#                  con.size = 1,</span></span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a><span class="co">#                  con.colour = "goldenrod4",</span></span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a><span class="co">#                  label.fontsize = c(10,12),</span></span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a><span class="co">#                  alpha=0.8,</span></span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a><span class="co">#   expand = unit(1, "mm") , </span></span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a><span class="co">#   radius = unit(1, "mm") , </span></span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a><span class="co">#   label.buffer = unit(1, "mm") ,</span></span>
<span id="cb18-58"><a href="#cb18-58" aria-hidden="true" tabindex="-1"></a><span class="co">#   label.fill = "grey90")</span></span>
<span id="cb18-59"><a href="#cb18-59" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb18-60"><a href="#cb18-60" aria-hidden="true" tabindex="-1"></a>df_56 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb18-61"><a href="#cb18-61" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">str_detect</span>(NOM_USUEL,<span class="st">"BIHOUE"</span>),</span>
<span id="cb18-62"><a href="#cb18-62" aria-hidden="true" tabindex="-1"></a>                <span class="sc">!</span><span class="fu">is.na</span>(<span class="st">`</span><span class="at">T</span><span class="st">`</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb18-63"><a href="#cb18-63" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(NOM_USUEL, LAT,LON,,AAAAMMJJHH,<span class="st">`</span><span class="at">T</span><span class="st">`</span>, TN, TX, T10, T20, T50,T100) <span class="sc">%&gt;%</span> </span>
<span id="cb18-64"><a href="#cb18-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.POSIXct</span>(<span class="fu">as.character</span>(AAAAMMJJHH), <span class="at">format =</span> <span class="st">"%Y%m%d%H"</span>,<span class="at">tz =</span> <span class="st">"UTC"</span>))</span>
<span id="cb18-65"><a href="#cb18-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-66"><a href="#cb18-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-67"><a href="#cb18-67" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_56)<span class="sc">+</span></span>
<span id="cb18-68"><a href="#cb18-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> <span class="st">`</span><span class="at">T</span><span class="st">`</span>))</span>
<span id="cb18-69"><a href="#cb18-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-70"><a href="#cb18-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-71"><a href="#cb18-71" aria-hidden="true" tabindex="-1"></a>df_heatwaveR <span class="ot">&lt;-</span> df_56 <span class="sc">%&gt;%</span> </span>
<span id="cb18-72"><a href="#cb18-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">t =</span> date,</span>
<span id="cb18-73"><a href="#cb18-73" aria-hidden="true" tabindex="-1"></a>         <span class="at">temp =</span> <span class="st">`</span><span class="at">T</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-74"><a href="#cb18-74" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(t,temp) <span class="sc">%&gt;%</span> </span>
<span id="cb18-75"><a href="#cb18-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">t =</span> <span class="fu">as.Date</span>(t)) <span class="sc">%&gt;%</span> </span>
<span id="cb18-76"><a href="#cb18-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(t) <span class="sc">%&gt;%</span> </span>
<span id="cb18-77"><a href="#cb18-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">temp =</span> <span class="fu">max</span>(temp,<span class="at">na.rm =</span> T))</span>
<span id="cb18-78"><a href="#cb18-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-79"><a href="#cb18-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-80"><a href="#cb18-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-81"><a href="#cb18-81" aria-hidden="true" tabindex="-1"></a>clim <span class="ot">&lt;-</span> <span class="fu">ts2clm</span>(df_heatwaveR, <span class="at">climatologyPeriod =</span> <span class="fu">c</span>(<span class="fu">min</span>(df_heatwaveR<span class="sc">$</span>t), <span class="fu">max</span>(df_heatwaveR<span class="sc">$</span>t)))</span>
<span id="cb18-82"><a href="#cb18-82" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-83"><a href="#cb18-83" aria-hidden="true" tabindex="-1"></a>event <span class="ot">&lt;-</span> <span class="fu">detect_event</span>(clim,<span class="at">categories =</span> T,<span class="at">minDuration =</span> <span class="dv">2</span>)</span>
<span id="cb18-84"><a href="#cb18-84" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-85"><a href="#cb18-85" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">detect_event</span>(clim, <span class="at">minDuration =</span> <span class="dv">2</span>)</span>
<span id="cb18-86"><a href="#cb18-86" aria-hidden="true" tabindex="-1"></a>mhw_Air<span class="ot">&lt;-</span> res<span class="sc">$</span>clim</span>
<span id="cb18-87"><a href="#cb18-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-88"><a href="#cb18-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-89"><a href="#cb18-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-90"><a href="#cb18-90" aria-hidden="true" tabindex="-1"></a><span class="co"># img_before &lt;- readPNG("Data/screenshot_S2/Before_event_quiberon.png") %&gt;%</span></span>
<span id="cb18-91"><a href="#cb18-91" aria-hidden="true" tabindex="-1"></a>  <span class="co"># rasterGrob(interpolate=TRUE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [17]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)  <span class="co"># For the 'ggarrange' function if needed</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggnewscale)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure you have the necessary packages installed</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare the SST data</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>label <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="fu">as.Date</span>(<span class="st">"2021-09-01"</span>), <span class="fu">as.Date</span>(<span class="st">"2021-09-06"</span>)),</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">y =</span> <span class="fu">c</span>(<span class="fl">15.5</span>,<span class="fl">15.5</span>),</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"2021-09-01"</span>,<span class="st">"2021-09-06"</span>))</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>sst_data <span class="ot">&lt;-</span> mhw_segments <span class="sc">%&gt;%</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(t <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-27"</span>) <span class="sc">&amp;</span> t <span class="sc">&lt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-17"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="st">"SST"</span>)</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare the Air data</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>air_data <span class="ot">&lt;-</span> mhw_Air <span class="sc">%&gt;%</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(t <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-27"</span>) <span class="sc">&amp;</span> t <span class="sc">&lt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-17"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="st">"Air"</span>)</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the datasets</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(sst_data, air_data)</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>tabcol <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">line_water =</span> <span class="st">"blue"</span>,</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">line_water_thresh =</span><span class="st">"darkblue"</span>,</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">line_air=</span><span class="st">"red"</span>,</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">line_air_thresh =</span> <span class="st">"darkred"</span>)</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>tabcol_air <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>            <span class="at">line_air=</span><span class="st">"red"</span>,</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>            <span class="at">line_air_thresh =</span> <span class="st">"darkred"</span>)</span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>tabcol_water <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">line_water =</span> <span class="st">"blue"</span>,</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>            <span class="at">line_water_thresh =</span><span class="st">"darkblue"</span>)</span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the combined plot with facets</span></span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>Combined_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Plot the SST data</span></span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> sst_data,</span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> temp, <span class="at">xend =</span> t_lead, <span class="at">yend =</span> temp_lead,</span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"line_water"</span>),</span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_flame</span>(</span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> sst_data,</span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> temp, <span class="at">y2 =</span> thresh),</span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"darkblue"</span>,</span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span></span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> sst_data,</span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> thresh,</span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">"line_water_thresh"</span>),</span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"twodash"</span>,</span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">1</span></span>
<span id="cb19-58"><a href="#cb19-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-59"><a href="#cb19-59" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb19-60"><a href="#cb19-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-61"><a href="#cb19-61" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Plot the Air data</span></span>
<span id="cb19-62"><a href="#cb19-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb19-63"><a href="#cb19-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> air_data,</span>
<span id="cb19-64"><a href="#cb19-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> temp,</span>
<span id="cb19-65"><a href="#cb19-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"line_air"</span>)</span>
<span id="cb19-66"><a href="#cb19-66" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb19-67"><a href="#cb19-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_flame</span>(</span>
<span id="cb19-68"><a href="#cb19-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> air_data,</span>
<span id="cb19-69"><a href="#cb19-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> temp, <span class="at">y2 =</span> thresh),</span>
<span id="cb19-70"><a href="#cb19-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"darkred"</span>,</span>
<span id="cb19-71"><a href="#cb19-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span></span>
<span id="cb19-72"><a href="#cb19-72" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb19-73"><a href="#cb19-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb19-74"><a href="#cb19-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> air_data,</span>
<span id="cb19-75"><a href="#cb19-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> thresh,</span>
<span id="cb19-76"><a href="#cb19-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"line_air_thresh"</span>),</span>
<span id="cb19-77"><a href="#cb19-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"twodash"</span>,</span>
<span id="cb19-78"><a href="#cb19-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">1</span></span>
<span id="cb19-79"><a href="#cb19-79" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb19-80"><a href="#cb19-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">as.Date</span>(<span class="st">"2021-09-01"</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb19-81"><a href="#cb19-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">as.Date</span>(<span class="st">"2021-09-07"</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>,<span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb19-82"><a href="#cb19-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> tabcol,</span>
<span id="cb19-83"><a href="#cb19-83" aria-hidden="true" tabindex="-1"></a>                     <span class="at">name =</span> <span class="cn">NULL</span>,</span>
<span id="cb19-84"><a href="#cb19-84" aria-hidden="true" tabindex="-1"></a>                     <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"Air Temperature"</span>,<span class="st">"p90 of Air Temperature"</span>, <span class="st">"SST"</span>,<span class="st">"p90 of SST"</span>))<span class="sc">+</span></span>
<span id="cb19-85"><a href="#cb19-85" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-86"><a href="#cb19-86" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Facet the plot to stack them vertically</span></span>
<span id="cb19-87"><a href="#cb19-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(variable <span class="sc">~</span> ., <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb19-88"><a href="#cb19-88" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-89"><a href="#cb19-89" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add common elements</span></span>
<span id="cb19-90"><a href="#cb19-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_Bede</span>() <span class="sc">+</span></span>
<span id="cb19-91"><a href="#cb19-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Temperature (°C)"</span>) <span class="sc">+</span></span>
<span id="cb19-92"><a href="#cb19-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Date of 2021"</span>) <span class="sc">+</span></span>
<span id="cb19-93"><a href="#cb19-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb19-94"><a href="#cb19-94" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text.y =</span> <span class="fu">element_blank</span>(),  <span class="co"># Remove facet titles (strip text)</span></span>
<span id="cb19-95"><a href="#cb19-95" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb19-96"><a href="#cb19-96" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb19-97"><a href="#cb19-97" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.93</span>),</span>
<span id="cb19-98"><a href="#cb19-98" aria-hidden="true" tabindex="-1"></a>    <span class="co"># legend.position = "bottom",</span></span>
<span id="cb19-99"><a href="#cb19-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-100"><a href="#cb19-100" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>),</span>
<span id="cb19-101"><a href="#cb19-101" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.box =</span> <span class="st">"vertical"</span>,  <span class="co"># Stack legends vertically</span></span>
<span id="cb19-102"><a href="#cb19-102" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.box.just =</span> <span class="st">"left"</span>,  <span class="co"># Align the legends to the left</span></span>
<span id="cb19-103"><a href="#cb19-103" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.spacing.y =</span> <span class="fu">unit</span>(<span class="fl">0.1</span>, <span class="st">'mm'</span>),  <span class="co"># Adjust vertical spacing</span></span>
<span id="cb19-104"><a href="#cb19-104" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.spacing.x =</span> <span class="fu">unit</span>(<span class="fl">0.1</span>, <span class="st">'mm'</span>) ,  <span class="co"># Adjust horizontal spacing   </span></span>
<span id="cb19-105"><a href="#cb19-105" aria-hidden="true" tabindex="-1"></a>    <span class="co"># legend.key = element_rect(fill = "white", color = "black"),  # Ensure clear legend keys</span></span>
<span id="cb19-106"><a href="#cb19-106" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.box.margin =</span> <span class="fu">margin</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb19-107"><a href="#cb19-107" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">size =</span><span class="dv">19</span>),</span>
<span id="cb19-108"><a href="#cb19-108" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">19</span>),</span>
<span id="cb19-109"><a href="#cb19-109" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">19</span>),</span>
<span id="cb19-110"><a href="#cb19-110" aria-hidden="true" tabindex="-1"></a>    <span class="co"># axis.title.x = element_text(size = 25),</span></span>
<span id="cb19-111"><a href="#cb19-111" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">25</span>),</span>
<span id="cb19-112"><a href="#cb19-112" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb19-113"><a href="#cb19-113" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">"lines"</span>)</span>
<span id="cb19-114"><a href="#cb19-114" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb19-115"><a href="#cb19-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(</span>
<span id="cb19-116"><a href="#cb19-116" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"none"</span> </span>
<span id="cb19-117"><a href="#cb19-117" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">+</span></span>
<span id="cb19-118"><a href="#cb19-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">position =</span> <span class="st">"top"</span>,<span class="at">date_labels =</span> <span class="st">"%b %Y"</span>)</span>
<span id="cb19-119"><a href="#cb19-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-120"><a href="#cb19-120" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-121"><a href="#cb19-121" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-122"><a href="#cb19-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-123"><a href="#cb19-123" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the combined plot</span></span>
<span id="cb19-124"><a href="#cb19-124" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(Combined_plot)</span>
<span id="cb19-125"><a href="#cb19-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-126"><a href="#cb19-126" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Paper/Figs/Sat_SST_Air/Temp_plot_211024.png"</span>,Combined_plot,<span class="at">height =</span> <span class="dv">323</span><span class="sc">*</span><span class="dv">10</span>, <span class="at">width =</span> <span class="dv">251</span><span class="sc">*</span><span class="dv">10</span>, <span class="at">unit =</span> <span class="st">"px"</span>)</span>
<span id="cb19-127"><a href="#cb19-127" aria-hidden="true" tabindex="-1"></a><span class="co"># ggsave("Paper/Figs/Sat_SST_Air/Temp_plot_squared.jpg",Combined_plot,height = 1000*2, width = 800*2, unit = "px")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [18]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MapRs)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>mask <span class="ot">&lt;-</span> <span class="st">"Data/shp/mask_intertidal_quiberon.shp"</span> <span class="sc">%&gt;%</span> </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_sf</span>()</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>before <span class="ot">&lt;-</span> <span class="st">"Data/Sentinel2/S2B_MSIL2A_20210814T110619_N0500_R137_T30TVT_20230213T031209.SAFE"</span> <span class="sc">%&gt;%</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Read_S2</span>() <span class="sc">%&gt;%</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crop</span>(mask)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(before) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"B"</span>,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>))</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>after <span class="ot">&lt;-</span> <span class="st">"Data/Sentinel2/S2B_MSIL2A_20210906T112109_N0500_R037_T30TVT_20230113T070720.SAFE"</span> <span class="sc">%&gt;%</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Read_S2</span>() <span class="sc">%&gt;%</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crop</span>(mask)</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(after) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"B"</span>,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>))</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>GCP <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"Data/Biolittoral/Bio-Littoral_Drone/Quadrat_metadata.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>), <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Target_types =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(Target_types,<span class="st">"Mix"</span>) <span class="sc">~</span> <span class="st">"Other"</span>,</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">str_detect</span>(Target_types,<span class="st">"Healthy"</span>) <span class="sc">~</span> <span class="st">"Healthy_seagrass"</span>,</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">str_detect</span>(Target_types,<span class="st">"Bleached"</span>) <span class="sc">~</span> <span class="st">"Bleached_seagrass"</span>,</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>                                  T <span class="sc">~</span> <span class="st">"Other"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Target_types <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Bleached_seagrass"</span>,<span class="st">"Healthy_seagrass"</span>))</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a><span class="fu">write_sf</span>(GCP,<span class="st">"Data/shp/GCP_biolittoral.shp"</span>)</span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>GCP <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"Data/shp/GCP_biolittoral.shp"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">filename =</span> <span class="st">"filenam"</span>,</span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>         <span class="at">Target_types =</span> <span class="st">"Trgt_ty"</span>) </span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>rasters <span class="ot">&lt;-</span> <span class="fu">list</span>(before, after)</span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize an empty list to store extracted values</span></span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>extracted_values_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over each raster and extract values</span></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(rasters)) {</span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract pixel values for all bands of this raster</span></span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>  extracted_values <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">extract</span>(rasters[[i]], <span class="fu">vect</span>(GCP))</span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add a prefix to the column names to differentiate bands from different rasters</span></span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(extracted_values)[<span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"raster"</span>, i, <span class="st">"_band"</span>, <span class="fu">seq_len</span>(<span class="fu">ncol</span>(extracted_values) <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add the extracted values to the list</span></span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>  extracted_values_list[[i]] <span class="ot">&lt;-</span> extracted_values</span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the extracted values from all rasters</span></span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a>extracted_values_combined <span class="ot">&lt;-</span> <span class="fu">do.call</span>(cbind, extracted_values_list)</span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove duplicate 'ID' columns (if any)</span></span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a>extracted_values_combined <span class="ot">&lt;-</span> extracted_values_combined[, <span class="sc">!</span><span class="fu">duplicated</span>(<span class="fu">colnames</span>(extracted_values_combined))]</span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> GCP <span class="sc">%&gt;%</span></span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">as_tibble</span>(extracted_values_combined)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(path,filename,Target_types,ID), <span class="at">names_to =</span> <span class="st">"Band"</span>,<span class="at">values_to =</span> <span class="st">"values"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb20-61"><a href="#cb20-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Raster =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(Band,<span class="st">"raster1"</span>) <span class="sc">~</span> <span class="st">"Before"</span>,</span>
<span id="cb20-62"><a href="#cb20-62" aria-hidden="true" tabindex="-1"></a>                            T <span class="sc">~</span> <span class="st">"After"</span>),</span>
<span id="cb20-63"><a href="#cb20-63" aria-hidden="true" tabindex="-1"></a>         <span class="at">Band =</span> <span class="fu">gsub</span>(<span class="st">".*_"</span>,<span class="st">""</span>,Band))</span>
<span id="cb20-64"><a href="#cb20-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-65"><a href="#cb20-65" aria-hidden="true" tabindex="-1"></a>imgs_to_keep <span class="ot">&lt;-</span> result <span class="sc">%&gt;%</span> </span>
<span id="cb20-66"><a href="#cb20-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(filename) <span class="sc">%&gt;%</span> </span>
<span id="cb20-67"><a href="#cb20-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">sum =</span> <span class="fu">sum</span>(values)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-68"><a href="#cb20-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sum) <span class="sc">%&gt;%</span> </span>
<span id="cb20-69"><a href="#cb20-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-70"><a href="#cb20-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(filename)</span>
<span id="cb20-71"><a href="#cb20-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-72"><a href="#cb20-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-73"><a href="#cb20-73" aria-hidden="true" tabindex="-1"></a>result_cleaned <span class="ot">&lt;-</span> result <span class="sc">%&gt;%</span> </span>
<span id="cb20-74"><a href="#cb20-74" aria-hidden="true" tabindex="-1"></a>  <span class="co"># dplyr::filter(filename %in% imgs_to_keep) %&gt;% </span></span>
<span id="cb20-75"><a href="#cb20-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Wavelength =</span> <span class="fu">case_when</span>(Band <span class="sc">==</span> <span class="st">"band1"</span> <span class="sc">~</span> <span class="dv">442</span>,</span>
<span id="cb20-76"><a href="#cb20-76" aria-hidden="true" tabindex="-1"></a>                                Band <span class="sc">==</span> <span class="st">"band2"</span> <span class="sc">~</span> <span class="dv">492</span>,</span>
<span id="cb20-77"><a href="#cb20-77" aria-hidden="true" tabindex="-1"></a>                                Band <span class="sc">==</span> <span class="st">"band3"</span> <span class="sc">~</span> <span class="dv">559</span>,</span>
<span id="cb20-78"><a href="#cb20-78" aria-hidden="true" tabindex="-1"></a>                                Band <span class="sc">==</span> <span class="st">"band4"</span> <span class="sc">~</span> <span class="dv">664</span>,</span>
<span id="cb20-79"><a href="#cb20-79" aria-hidden="true" tabindex="-1"></a>                                Band <span class="sc">==</span> <span class="st">"band5"</span> <span class="sc">~</span> <span class="dv">704</span>,</span>
<span id="cb20-80"><a href="#cb20-80" aria-hidden="true" tabindex="-1"></a>                                Band <span class="sc">==</span> <span class="st">"band6"</span> <span class="sc">~</span> <span class="dv">740</span>,</span>
<span id="cb20-81"><a href="#cb20-81" aria-hidden="true" tabindex="-1"></a>                                Band <span class="sc">==</span> <span class="st">"band7"</span> <span class="sc">~</span> <span class="dv">782</span>,</span>
<span id="cb20-82"><a href="#cb20-82" aria-hidden="true" tabindex="-1"></a>                                Band <span class="sc">==</span> <span class="st">"band8"</span> <span class="sc">~</span> <span class="dv">832</span>,</span>
<span id="cb20-83"><a href="#cb20-83" aria-hidden="true" tabindex="-1"></a>                                Band <span class="sc">==</span> <span class="st">"band9"</span> <span class="sc">~</span> <span class="dv">864</span>,</span>
<span id="cb20-84"><a href="#cb20-84" aria-hidden="true" tabindex="-1"></a>                                Band <span class="sc">==</span> <span class="st">"band10"</span> <span class="sc">~</span> <span class="dv">945</span>,</span>
<span id="cb20-85"><a href="#cb20-85" aria-hidden="true" tabindex="-1"></a>                                Band <span class="sc">==</span> <span class="st">"band11"</span> <span class="sc">~</span> <span class="dv">1613</span>,</span>
<span id="cb20-86"><a href="#cb20-86" aria-hidden="true" tabindex="-1"></a>                                Band <span class="sc">==</span> <span class="st">"band12"</span> <span class="sc">~</span> <span class="dv">2202</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-87"><a href="#cb20-87" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Wavelength <span class="sc">&lt;</span><span class="dv">1000</span>)</span>
<span id="cb20-88"><a href="#cb20-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-89"><a href="#cb20-89" aria-hidden="true" tabindex="-1"></a>NDVI <span class="ot">&lt;-</span> result_cleaned <span class="sc">%&gt;%</span> </span>
<span id="cb20-90"><a href="#cb20-90" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(filename ,Raster,Wavelength, values) <span class="sc">%&gt;%</span> </span>
<span id="cb20-91"><a href="#cb20-91" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Wavelength <span class="sc">==</span> <span class="dv">664</span> <span class="sc">|</span> Wavelength <span class="sc">==</span> <span class="dv">832</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb20-92"><a href="#cb20-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> Wavelength, <span class="at">values_from =</span> values) <span class="sc">%&gt;%</span> </span>
<span id="cb20-93"><a href="#cb20-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">NDVI =</span> ((<span class="st">`</span><span class="at">832</span><span class="st">`</span><span class="sc">-</span><span class="dv">1000</span>) <span class="sc">-</span> (<span class="st">`</span><span class="at">664</span><span class="st">`</span><span class="sc">-</span> <span class="dv">1000</span>))<span class="sc">/</span>((<span class="st">`</span><span class="at">832</span><span class="st">`</span><span class="sc">-</span><span class="dv">1000</span>) <span class="sc">+</span> (<span class="st">`</span><span class="at">664</span><span class="st">`</span><span class="sc">-</span><span class="dv">1000</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb20-94"><a href="#cb20-94" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(filename,Raster,NDVI)</span>
<span id="cb20-95"><a href="#cb20-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-96"><a href="#cb20-96" aria-hidden="true" tabindex="-1"></a>GLI <span class="ot">&lt;-</span> result_cleaned <span class="sc">%&gt;%</span> </span>
<span id="cb20-97"><a href="#cb20-97" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(filename ,Raster,Wavelength, values) <span class="sc">%&gt;%</span> </span>
<span id="cb20-98"><a href="#cb20-98" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Wavelength <span class="sc">==</span> <span class="dv">559</span> <span class="sc">|</span> Wavelength <span class="sc">==</span> <span class="dv">664</span> <span class="sc">|</span> Wavelength <span class="sc">==</span> <span class="dv">492</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb20-99"><a href="#cb20-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> Wavelength, <span class="at">values_from =</span> values) <span class="sc">%&gt;%</span> </span>
<span id="cb20-100"><a href="#cb20-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">GLI =</span> ((<span class="st">`</span><span class="at">559</span><span class="st">`</span><span class="sc">-</span><span class="st">`</span><span class="at">664</span><span class="st">`</span>)<span class="sc">+</span>(<span class="st">`</span><span class="at">559</span><span class="st">`</span><span class="sc">-</span><span class="st">`</span><span class="at">492</span><span class="st">`</span>)) <span class="sc">/</span> ((<span class="dv">2</span><span class="sc">*</span><span class="st">`</span><span class="at">559</span><span class="st">`</span>) <span class="sc">+</span> <span class="st">`</span><span class="at">664</span><span class="st">`</span><span class="sc">+</span><span class="st">`</span><span class="at">492</span><span class="st">`</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-101"><a href="#cb20-101" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(filename,Raster,GLI)</span>
<span id="cb20-102"><a href="#cb20-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-103"><a href="#cb20-103" aria-hidden="true" tabindex="-1"></a>df_all_spectra_s2 <span class="ot">&lt;-</span> result_cleaned <span class="sc">%&gt;%</span> </span>
<span id="cb20-104"><a href="#cb20-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(NDVI, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"filename"</span>,<span class="st">"Raster"</span>))<span class="sc">%&gt;%</span> </span>
<span id="cb20-105"><a href="#cb20-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(GLI, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"filename"</span>,<span class="st">"Raster"</span>))</span>
<span id="cb20-106"><a href="#cb20-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-107"><a href="#cb20-107" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df_all_spectra_s2,<span class="st">"Data/Sentinel2/df_all_spectra_GCP.csv"</span>, <span class="at">row.names =</span> F)</span>
<span id="cb20-108"><a href="#cb20-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-109"><a href="#cb20-109" aria-hidden="true" tabindex="-1"></a>result_cleaned_NDVI <span class="ot">&lt;-</span> result_cleaned <span class="sc">%&gt;%</span> </span>
<span id="cb20-110"><a href="#cb20-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(NDVI, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"filename"</span>,<span class="st">"Raster"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-111"><a href="#cb20-111" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(NDVI <span class="sc">&gt;</span> <span class="fl">0.1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb20-112"><a href="#cb20-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(filename,Raster) <span class="sc">%&gt;%</span> </span>
<span id="cb20-113"><a href="#cb20-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">values_STD =</span> (values <span class="sc">-</span> <span class="fu">min</span>(values))<span class="sc">/</span>(<span class="fu">max</span>(values)<span class="sc">-</span><span class="fu">min</span>(values))) <span class="sc">%&gt;%</span> </span>
<span id="cb20-114"><a href="#cb20-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb20-115"><a href="#cb20-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Raster,Target_types,Wavelength) <span class="sc">%&gt;%</span> </span>
<span id="cb20-116"><a href="#cb20-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">mean =</span> <span class="fu">mean</span>(values_STD),</span>
<span id="cb20-117"><a href="#cb20-117" aria-hidden="true" tabindex="-1"></a>          <span class="at">sd =</span> <span class="fu">sd</span>(values_STD)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-118"><a href="#cb20-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">case_when</span>(Raster <span class="sc">==</span> <span class="st">"After"</span> <span class="sc">~</span> (<span class="st">"2021-09-06"</span>),</span>
<span id="cb20-119"><a href="#cb20-119" aria-hidden="true" tabindex="-1"></a>                          T <span class="sc">~</span> (<span class="st">"2021-09-01"</span>)),</span>
<span id="cb20-120"><a href="#cb20-120" aria-hidden="true" tabindex="-1"></a>         <span class="at">Desc =</span> <span class="fu">case_when</span>(Target_types <span class="sc">==</span> <span class="st">"Bleached_seagrass"</span> <span class="sc">~</span> <span class="st">"Darkened seagrass in the field"</span>, </span>
<span id="cb20-121"><a href="#cb20-121" aria-hidden="true" tabindex="-1"></a>                          T <span class="sc">~</span> <span class="st">"Green seagrass in the field"</span>),</span>
<span id="cb20-122"><a href="#cb20-122" aria-hidden="true" tabindex="-1"></a>         <span class="at">label =</span> <span class="fu">case_when</span>(Raster <span class="sc">==</span> <span class="st">"After"</span> <span class="sc">~</span> (<span class="st">"Spectra after heatwaves : 2021-09-06"</span>),</span>
<span id="cb20-123"><a href="#cb20-123" aria-hidden="true" tabindex="-1"></a>                          T <span class="sc">~</span> (<span class="st">"Spectra before heatwaves : 2021-09-01"</span>))</span>
<span id="cb20-124"><a href="#cb20-124" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb20-125"><a href="#cb20-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-126"><a href="#cb20-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-127"><a href="#cb20-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-128"><a href="#cb20-128" aria-hidden="true" tabindex="-1"></a>coltab <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Green seagrass in the field"</span> <span class="ot">=</span> <span class="st">"#1C86EE"</span>, <span class="st">"Darkened seagrass in the field"</span> <span class="ot">=</span> <span class="st">"goldenrod"</span>)</span>
<span id="cb20-129"><a href="#cb20-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-130"><a href="#cb20-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-131"><a href="#cb20-131" aria-hidden="true" tabindex="-1"></a>plot_spectra <span class="ot">&lt;-</span> result_cleaned_NDVI <span class="sc">%&gt;%</span></span>
<span id="cb20-132"><a href="#cb20-132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb20-133"><a href="#cb20-133" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> Wavelength, <span class="at">y =</span> mean, <span class="at">color =</span> Desc), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb20-134"><a href="#cb20-134" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> Wavelength, <span class="at">y =</span> mean, <span class="at">ymin =</span> mean <span class="sc">-</span> sd, <span class="at">ymax =</span> mean <span class="sc">+</span> sd, <span class="at">color =</span> <span class="cn">NULL</span>, <span class="at">fill =</span> Desc), <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb20-135"><a href="#cb20-135" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> date) <span class="sc">+</span></span>
<span id="cb20-136"><a href="#cb20-136" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">x =</span> <span class="dv">950</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="fu">aes</span>(<span class="at">label =</span>  <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\\\</span><span class="st">n"</span>, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, label)), <span class="at">size =</span> <span class="dv">5</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb20-137"><a href="#cb20-137" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> coltab, <span class="at">name =</span> <span class="st">"GCPs:"</span>) <span class="sc">+</span></span>
<span id="cb20-138"><a href="#cb20-138" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> coltab, <span class="at">name =</span> <span class="st">"GCPs:"</span>) <span class="sc">+</span></span>
<span id="cb20-139"><a href="#cb20-139" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Reflectance"</span>) <span class="sc">+</span></span>
<span id="cb20-140"><a href="#cb20-140" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">sec.axis =</span> <span class="fu">dup_axis</span>(<span class="at">name =</span> <span class="st">"Reflectance"</span>)) <span class="sc">+</span> </span>
<span id="cb20-141"><a href="#cb20-141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Wavelength (nm)"</span>)<span class="sc">+</span><span class="co"># Adds secondary y-axis</span></span>
<span id="cb20-142"><a href="#cb20-142" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_Bede</span>() <span class="sc">+</span></span>
<span id="cb20-143"><a href="#cb20-143" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb20-144"><a href="#cb20-144" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb20-145"><a href="#cb20-145" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb20-146"><a href="#cb20-146" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span><span class="dv">17</span>),</span>
<span id="cb20-147"><a href="#cb20-147" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">size =</span><span class="dv">13</span>),</span>
<span id="cb20-148"><a href="#cb20-148" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>),</span>
<span id="cb20-149"><a href="#cb20-149" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>),</span>
<span id="cb20-150"><a href="#cb20-150" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">17</span>),</span>
<span id="cb20-151"><a href="#cb20-151" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">17</span>),</span>
<span id="cb20-152"><a href="#cb20-152" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb20-153"><a href="#cb20-153" aria-hidden="true" tabindex="-1"></a>      <span class="co"># legend.position = c(0.86, 0.13),</span></span>
<span id="cb20-154"><a href="#cb20-154" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb20-155"><a href="#cb20-155" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>),</span>
<span id="cb20-156"><a href="#cb20-156" aria-hidden="true" tabindex="-1"></a>      <span class="co"># panel.border = element_blank(),</span></span>
<span id="cb20-157"><a href="#cb20-157" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.line.y.right =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="co"># Makes the right y-axis visible</span></span>
<span id="cb20-158"><a href="#cb20-158" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-159"><a href="#cb20-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-160"><a href="#cb20-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-161"><a href="#cb20-161" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Paper/Figs/Sat_SST_Air/S2_Spectra_21102024.png"</span>, plot_spectra, <span class="at">width=</span><span class="dv">753</span> <span class="sc">*</span> <span class="dv">5</span> ,<span class="at">height=</span><span class="dv">323</span> <span class="sc">*</span> <span class="dv">5</span>, <span class="at">unit =</span> <span class="st">"px"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [19]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyterra)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>Temp <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"Paper/Figs/Sat_SST_Air/Temp_plot_211024.png"</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ext</span>(Temp) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>,<span class="dv">261</span>,<span class="sc">-</span><span class="dv">323</span>,<span class="dv">20</span>)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>before <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"Data/imgs/S2_BeforeHeatwave_squared_GCP.png"</span>)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ext</span>(before) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">251-20</span>,<span class="sc">-</span><span class="dv">20</span>,<span class="sc">-</span><span class="dv">323</span>,<span class="dv">0</span>)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>after <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"Data/imgs/S2_afterHeatwave_squared_GCP.png"</span>)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ext</span>(after) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">251</span><span class="sc">+</span><span class="dv">20</span>,<span class="dv">502</span><span class="sc">+</span><span class="dv">20</span>,<span class="sc">-</span><span class="dv">323</span>,<span class="dv">0</span>)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>sp <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"Paper/Figs/Sat_SST_Air/S2_Spectra_21102024.png"</span>)</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ext</span>(sp) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">251-20</span>,<span class="dv">502</span><span class="sc">+</span><span class="dv">20</span>,<span class="sc">-</span><span class="fl">663.15</span>,<span class="sc">-</span><span class="dv">323</span>)</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>letter_size <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>all_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_spatraster_rgb(data = Temp,maxcell = 100)+</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_spatraster_rgb(data = sp,maxcell = 100000) +</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_spatraster_rgb(data = before,maxcell = 1000)+</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_spatraster_rgb(data = after,maxcell = 1000) +</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spatraster_rgb</span>(<span class="at">data =</span> Temp,<span class="at">maxcell =</span> <span class="dv">500325</span> <span class="sc">*</span> <span class="dv">20</span>)<span class="sc">+</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spatraster_rgb</span>(<span class="at">data =</span> before)<span class="sc">+</span></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spatraster_rgb</span>(<span class="at">data =</span> after) <span class="sc">+</span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spatraster_rgb</span>(<span class="at">data =</span> sp,<span class="at">maxcell =</span> <span class="dv">500325</span> <span class="sc">*</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="sc">-</span><span class="dv">65</span>, <span class="at">y =</span> <span class="sc">-</span><span class="dv">310</span>, <span class="at">label =</span> <span class="st">"2021-09-01"</span>), <span class="at">size =</span> <span class="dv">6</span>, <span class="at">color =</span> <span class="st">"white"</span>)<span class="sc">+</span></span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">470</span>, <span class="at">y =</span> <span class="sc">-</span><span class="dv">310</span>, <span class="at">label =</span> <span class="st">"2021-09-06"</span>), <span class="at">size =</span> <span class="dv">6</span>, <span class="at">color =</span> <span class="st">"white"</span>)<span class="sc">+</span></span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_text(aes(x = -65, y = -310, label = ""), size = 6, color = "white")+</span></span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_text(aes(x = 470, y = -310, label = "2021-09-06"), size = 6, color = "white")+</span></span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">117</span>, <span class="at">y =</span> <span class="sc">-</span><span class="dv">285</span>, <span class="at">label =</span> <span class="st">"2021-09-01"</span>), <span class="at">angle =</span> <span class="dv">90</span>,<span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"black"</span>)<span class="sc">+</span></span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">143</span>, <span class="at">y =</span> <span class="sc">-</span><span class="dv">285</span>, <span class="at">label =</span> <span class="st">"2021-09-06"</span>), <span class="at">angle =</span> <span class="dv">90</span>,<span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"black"</span>)<span class="sc">+</span></span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="sc">-</span><span class="dv">251</span>, <span class="at">y =</span> <span class="sc">-</span><span class="dv">20</span>, <span class="at">label =</span> <span class="st">"A"</span>), <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> letter_size)<span class="sc">+</span></span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">35</span>, <span class="at">y =</span> <span class="sc">-</span><span class="dv">20</span>, <span class="at">label =</span> <span class="st">"B"</span>), <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> letter_size)<span class="sc">+</span></span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">291</span>, <span class="at">y =</span> <span class="sc">-</span><span class="dv">20</span>, <span class="at">label =</span> <span class="st">"C"</span>), <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> letter_size)<span class="sc">+</span></span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="sc">-</span><span class="dv">200</span>, <span class="at">y =</span> <span class="sc">-</span><span class="dv">350</span>, <span class="at">label =</span> <span class="st">"D"</span>), <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> letter_size)<span class="sc">+</span></span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>()<span class="sc">+</span></span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()<span class="sc">+</span></span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>),</span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="st">"cm"</span>)  <span class="co"># Remove margins around the plot</span></span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(all_plot)</span></span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Paper/Figs/High_res/Heatwaves_S2_plot.png"</span>,all_plot, <span class="at">height =</span> <span class="fl">663.15</span><span class="sc">*</span><span class="dv">5</span>, <span class="at">width =</span> <span class="dv">793</span><span class="sc">*</span><span class="dv">5</span>, <span class="at">unit =</span> <span class="st">"px"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<p>The Sentinel-2 images used in this study are dated from the 1st of September 2021 and the 6th of September 2021 (<a href="#fig-S2_comparison" class="quarto-xref">Figure&nbsp;6</a> A and C, respectively). The Atmospheric Heat Wave (AHW) started on 4 September and lasted until 7 September, while the Marine Heat Wave (MHW) started on 3 September and ended on 8 September 2021 (<a href="#fig-S2_comparison" class="quarto-xref">Figure&nbsp;6</a> B). The AHW has been classified as a strong event, and the MHW has been classified as moderate. Even though the Sentinel-2 of the 6th of September was captured only a few days after the start of the events, darkening of seagrass can already be observed in the true-color composition (<a href="#fig-S2_comparison" class="quarto-xref">Figure&nbsp;6</a> C). Before the event, all GCPs appeared green un the images, with similar reflectance spectra, regardless of the class attributed to the GCPs on the field (<a href="#fig-S2_comparison" class="quarto-xref">Figure&nbsp;6</a> A and D left). Their reflectance spectra showed a peak at 560 nm (in the green part of the spectra), low values at 665 nm, corresponding to the strong absorption by chlorophyll-a and a high infrared plateau (&gt; 705 nm). However, GCPs classified as dark seagrass during the fieldtrip, showed significant differences in reflectance spectral shape compared to GCPs classified as green seagrass on the 10th of September, with corresponding differences in the true color composition (<a href="#fig-S2_comparison" class="quarto-xref">Figure&nbsp;6</a> C and D right). In fact these dark seagrass GCPs were affected by extreme events, which altered their color and impacted the satellite reflectance (<a href="#fig-S2_comparison" class="quarto-xref">Figure&nbsp;6</a> C). The reflectance spectra over dark seagrass were characterized by the loss of the reflectance peak at 560 nm and a decrease in the infared plateau, which was observed as a steady increasing slope up to 940 nm.</p>
<div class="cell-container"><div class="cell-decorator"><pre>In [20]:</pre></div><div id="cell-fig-S2_comparison" class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"Figs/Low_res/Heatwaves_S2_plot.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-S2_comparison" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-S2_comparison-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="">
<a href="Figs/Low_res/Heatwaves_S2_plot.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6" title="Figure&nbsp;6: Spectral Comparison of Sentinel-2 Reflectance (D) over Ground Control Points (GCPs) Before (A) and During (B) Heatwave Events (C); A: RGB color composition of the Sentinel-2 image on the 1st of September 2021. The points correspond to GCPs collected on September 10, 2021 Figure&nbsp;1; B: Detection of heatwave events based on both Air Temperature and Sea Surface Temperature (SST). The solid line represents the daily average temperature, while the dashed line indicates the 90th percentile of the climatology. Colored polygons identidy heatwaves (marine in blue and atmospherical in red). The two vertical dashed lines represent the acquisition dates of the two Sentinel-2 images used in this analysis ; C : RGB color composition of the Sentinel-2 image on the 6th of September 2021. The points correspond to GCPs collected on September 10, 2021 Figure&nbsp;1 ; D : Average spectral signatures of GCPs where dark and green seagrasses (blue and gold lines, respectively) were identified during the field survey. The left plot shows the reflectance of these GCPs before the heatwave impact, while the right plot shows the spectral signature during the heatwaves. The ribbons around the lines represent the standard deviation."><img src="Figs/Low_res/Heatwaves_S2_plot.png" class="img-fluid figure-img" style="width:100.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-S2_comparison-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Spectral Comparison of Sentinel-2 Reflectance (D) over Ground Control Points (GCPs) Before (A) and During (B) Heatwave Events (C); A: RGB color composition of the Sentinel-2 image on the 1st of September 2021. The points correspond to GCPs collected on September 10, 2021 <a href="#fig-quiberonMap" class="quarto-xref">Figure&nbsp;1</a>; B: Detection of heatwave events based on both Air Temperature and Sea Surface Temperature (SST). The solid line represents the daily average temperature, while the dashed line indicates the 90th percentile of the climatology. Colored polygons identidy heatwaves (marine in blue and atmospherical in red). The two vertical dashed lines represent the acquisition dates of the two Sentinel-2 images used in this analysis ; C : RGB color composition of the Sentinel-2 image on the 6th of September 2021. The points correspond to GCPs collected on September 10, 2021 <a href="#fig-quiberonMap" class="quarto-xref">Figure&nbsp;1</a> ; D : Average spectral signatures of GCPs where dark and green seagrasses (blue and gold lines, respectively) were identified during the field survey. The left plot shows the reflectance of these GCPs before the heatwave impact, while the right plot shows the spectral signature during the heatwaves. The ribbons around the lines represent the standard deviation.
</figcaption>
</figure>
</div>
</div>
</div></div>
</section>
<section id="radiometric-indices-comparison" class="level3" data-number="3.1.2">
<h3 data-number="3.1.2" class="anchored" data-anchor-id="radiometric-indices-comparison"><span class="header-section-number">3.1.2</span> Radiometric indices comparison</h3>
<p>Using Sentinel-2 data, the spectral indices (NDVI and GLI) and SPC estimated for pixels unaffected by the heatwave showed no significant differences before or during the event (<a href="#fig-NDVI_GLI_SPC" class="quarto-xref">Figure&nbsp;7</a>, left column) In contrast, seagrass darkened by the heatwave exhibited a significant decrease in both index values and SPC (<a href="#fig-NDVI_GLI_SPC" class="quarto-xref">Figure&nbsp;7</a>, right column). In this case, the NDVI dropped by approximately 34%, from a median of 0.61 to 0.40, while also becoming more homogeneous (the standard deviation decreased from 0.09 to 0.06) (<a href="#fig-NDVI_GLI_SPC" class="quarto-xref">Figure&nbsp;7</a> B). Although the heatwave did not affect the observed seagrass density in the field, the drop in NDVI led to an underestimation of satellite-based SPC, from 83 to 48% (<a href="#fig-NDVI_GLI_SPC" class="quarto-xref">Figure&nbsp;7</a> D). The GLI, the index that reflects the greenness of leaves, was the most affected by the event, with an important reduction from a median of 0.15 to 0.02 during the event (<a href="#fig-NDVI_GLI_SPC" class="quarto-xref">Figure&nbsp;7</a> F). Interestingly, when comparing the initial seagrass density of both targets (i.e., seagrass density before the event) pixels affected by the heatwave (median SPC = 65%; [<a href="#fig-NDVI_GLI_SPC" class="quarto-xref">Figure&nbsp;7</a> C green) were denser than the those remained unchanged (median SPC = 85%; [<a href="#fig-NDVI_GLI_SPC" class="quarto-xref">Figure&nbsp;7</a> D green).</p>
<div class="cell-container"><div class="cell-decorator"><pre>In [21]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Utilities.Package)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyterra)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>df_all_indice <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"Data/Sentinel2/df_all_spectra_GCP.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SPC =</span> <span class="fl">172.06</span><span class="sc">*</span>NDVI<span class="fl">-22.18</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(filename, Target_types,Raster,NDVI,GLI,SPC)) <span class="sc">%&gt;%</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sum =</span> NDVI <span class="sc">+</span> GLI <span class="sc">+</span> SPC) <span class="sc">%&gt;%</span> </span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">distinct</span>(sum, <span class="at">.keep_all =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>sum) <span class="sc">%&gt;%</span> </span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(NDVI <span class="sc">&gt;</span> <span class="dv">0</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">GLI =</span> GLI <span class="sc">*</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(NDVI,SPC,GLI), <span class="at">names_to =</span> <span class="st">"Indices"</span>, <span class="at">values_to =</span> <span class="st">"values"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">case_when</span>(Raster <span class="sc">==</span> <span class="st">"After"</span> <span class="sc">~</span> (<span class="st">"2021-09-06"</span>), </span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>                          T <span class="sc">~</span> (<span class="st">"2021-09-01"</span>)),</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">Indices =</span> <span class="fu">case_when</span>(Indices <span class="sc">==</span> <span class="st">"NDVI"</span> <span class="sc">~</span> <span class="st">"NDVI"</span>,</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>                             Indices <span class="sc">==</span> <span class="st">"SPC"</span> <span class="sc">~</span> <span class="st">"SPC"</span>,</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>                             Indices <span class="sc">==</span> <span class="st">"GLI"</span> <span class="sc">~</span> <span class="st">"GLI"</span>),</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">Target_types =</span> <span class="fu">case_when</span>(Target_types <span class="sc">==</span> <span class="st">"Bleached_seagrass"</span> <span class="sc">~</span> <span class="st">"GCPs Darkened in the field"</span>,</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>                                  T <span class="sc">~</span> <span class="st">"GCPs Green in the Field"</span>),</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">Target_types =</span> <span class="fu">factor</span>(Target_types, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"GCPs Green in the Field"</span>, <span class="st">"GCPs Darkened in the field"</span>)),</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">Indices =</span> <span class="fu">factor</span>(Indices, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"NDVI"</span>, <span class="st">"SPC"</span>, <span class="st">"GLI"</span>))</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>coltab <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"After"</span> <span class="ot">=</span> <span class="st">"red4"</span>,</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Before"</span> <span class="ot">=</span> <span class="st">"green4"</span>)</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>(plot_indices <span class="ot">&lt;-</span> df_all_indice <span class="sc">%&gt;%</span> </span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># dplyr::filter(Targets_name == "Bleached_seagrass") %&gt;% </span></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> values, <span class="at">color =</span> Raster))<span class="sc">+</span></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">show.legend =</span> F)<span class="sc">+</span></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Indices <span class="sc">~</span> Target_types, <span class="at">scales =</span> <span class="st">"free_y"</span>, <span class="at">switch=</span><span class="st">"y"</span>)<span class="sc">+</span></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> coltab)<span class="sc">+</span></span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Date of the S2 image"</span>)<span class="sc">+</span></span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_Bede</span>()<span class="sc">+</span></span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>),</span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">17</span>),</span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.placement =</span> <span class="st">"outside"</span></span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a>stat_indices <span class="ot">&lt;-</span> df_all_indice <span class="sc">%&gt;%</span> </span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Indices, Target_types, date) <span class="sc">%&gt;%</span> </span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">mean =</span> <span class="fu">mean</span>(values, <span class="at">na.rm =</span> T),</span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a>          <span class="at">sd =</span> <span class="fu">sd</span>(values, <span class="at">na.rm =</span> T), </span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true" tabindex="-1"></a>          <span class="at">median =</span> <span class="fu">median</span>(values, <span class="at">na.rm =</span> T))</span>
<span id="cb23-54"><a href="#cb23-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-55"><a href="#cb23-55" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Paper/Figs/High_res/Compares_Indices_S2.png"</span>,plot_indices, <span class="at">width =</span><span class="dv">7</span> , <span class="at">height =</span> <span class="dv">10</span>, <span class="at">dpi =</span> <span class="dv">400</span>)</span>
<span id="cb23-56"><a href="#cb23-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-57"><a href="#cb23-57" aria-hidden="true" tabindex="-1"></a>graph <span class="ot">&lt;-</span> <span class="st">"Paper/Figs/High_res/Compares_Indices_S2.png"</span> <span class="sc">%&gt;%</span> </span>
<span id="cb23-58"><a href="#cb23-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rast</span>()</span>
<span id="cb23-59"><a href="#cb23-59" aria-hidden="true" tabindex="-1"></a>ext_graph <span class="ot">&lt;-</span> <span class="fu">ext</span>(graph)</span>
<span id="cb23-60"><a href="#cb23-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-61"><a href="#cb23-61" aria-hidden="true" tabindex="-1"></a>plot_labeled <span class="ot">&lt;-</span> <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb23-62"><a href="#cb23-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spatraster_rgb</span>(<span class="at">data =</span> graph, <span class="at">maxcell =</span> ext_graph[<span class="dv">2</span>]<span class="sc">*</span>ext_graph[<span class="dv">4</span>])<span class="sc">+</span></span>
<span id="cb23-63"><a href="#cb23-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># geom_spatraster_rgb(data = graph)+</span></span>
<span id="cb23-64"><a href="#cb23-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">500</span>, <span class="at">y =</span> <span class="dv">2800</span>, <span class="at">label =</span> <span class="st">"A"</span>), <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">10</span>)<span class="sc">+</span> </span>
<span id="cb23-65"><a href="#cb23-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1720</span>, <span class="at">y =</span> <span class="dv">2800</span>, <span class="at">label =</span> <span class="st">"B"</span>), <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">10</span>)<span class="sc">+</span> </span>
<span id="cb23-66"><a href="#cb23-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">500</span>, <span class="at">y =</span> <span class="dv">1590</span>, <span class="at">label =</span> <span class="st">"C"</span>), <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">10</span>)<span class="sc">+</span></span>
<span id="cb23-67"><a href="#cb23-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1720</span>, <span class="at">y =</span> <span class="dv">1590</span>, <span class="at">label =</span> <span class="st">"D"</span>), <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">10</span>)<span class="sc">+</span></span>
<span id="cb23-68"><a href="#cb23-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">500</span>, <span class="at">y =</span> <span class="dv">385</span>, <span class="at">label =</span> <span class="st">"E"</span>), <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">10</span>)<span class="sc">+</span> </span>
<span id="cb23-69"><a href="#cb23-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1720</span>, <span class="at">y =</span> <span class="dv">385</span>, <span class="at">label =</span> <span class="st">"F"</span>), <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">10</span>)<span class="sc">+</span>  </span>
<span id="cb23-70"><a href="#cb23-70" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_equal</span>(<span class="at">expand =</span> F)<span class="sc">+</span></span>
<span id="cb23-71"><a href="#cb23-71" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_void</span>()</span>
<span id="cb23-72"><a href="#cb23-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-73"><a href="#cb23-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-74"><a href="#cb23-74" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Paper/Figs/High_res/Compares_Indices_S2.png"</span>,plot_labeled, <span class="at">width =</span><span class="dv">7</span> , <span class="at">height =</span> <span class="dv">10</span>, <span class="at">dpi =</span> <span class="dv">400</span>)</span>
<span id="cb23-75"><a href="#cb23-75" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Paper/Figs/Low_res/Compares_Indices_S2.png"</span>,plot_labeled, <span class="at">width =</span><span class="dv">7</span> , <span class="at">height =</span> <span class="dv">10</span>, <span class="at">dpi =</span> <span class="dv">200</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [22]:</pre></div><div id="cell-fig-NDVI_GLI_SPC" class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"Figs/Low_res/Compares_Indices_S2.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-NDVI_GLI_SPC" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-NDVI_GLI_SPC-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="">
<a href="Figs/Low_res/Compares_Indices_S2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7" title="Figure&nbsp;7: Comparaison of Sentinel-2 based radiometric indices at two different dates, before (2021-09-01, green) and after (2021-09-06, red) the heatwaves events of Quiberons, for the two category of GCPs seen in the filed : Green seagrasses (i.e seagrass not affected by the event, Left Column) and Darkened Seagrasses (i.e seagrass affected by the event, Right column). The Normalised Difference Vegetation Index (NDVI) has been computed using the Equation&nbsp;1, the Seagrass Percent Cover (SPC) with the Equation&nbsp;2 and the Green Leaf Index (GLI) using Equation&nbsp;3,"><img src="Figs/Low_res/Compares_Indices_S2.png" class="img-fluid figure-img" style="width:80.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-NDVI_GLI_SPC-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Comparaison of Sentinel-2 based radiometric indices at two different dates, before (2021-09-01, green) and after (2021-09-06, red) the heatwaves events of Quiberons, for the two category of GCPs seen in the filed : Green seagrasses (i.e seagrass not affected by the event, Left Column) and Darkened Seagrasses (i.e seagrass affected by the event, Right column). The Normalised Difference Vegetation Index (NDVI) has been computed using the <a href="#eq-ndvi" class="quarto-xref">Equation&nbsp;1</a>, the Seagrass Percent Cover (SPC) with the <a href="#eq-spc" class="quarto-xref">Equation&nbsp;2</a> and the Green Leaf Index (GLI) using <a href="#eq-gli" class="quarto-xref">Equation&nbsp;3</a>,
</figcaption>
</figure>
</div>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [23]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MapRs)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyterra)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>msk <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"Data/shp/mask_study_quiberon.shp"</span>)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>msk_inter <span class="ot">&lt;-</span> <span class="st">"Data/shp/mask_intertidal_quiberon.shp"</span> <span class="sc">%&gt;%</span> </span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_sf</span>()</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>icecream <span class="ot">&lt;-</span> <span class="st">"Data/ICECREAM/S2B_MSIL2A_20210906T112109_N0500_R037_T30TVT_20230113T070720_Pred_BFRD.tif"</span> <span class="sc">%&gt;%</span> </span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rast</span>(<span class="at">lyr =</span> <span class="dv">1</span>)</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="fu">crs</span>(icecream)<span class="ot">&lt;-</span><span class="fu">crs</span>(<span class="st">"EPSG:32630"</span>)</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>seagrass_mask <span class="ot">&lt;-</span> (icecream <span class="sc">==</span> <span class="dv">3</span> <span class="sc">|</span> icecream <span class="sc">==</span> <span class="dv">4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.polygons</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"POLYGON"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">area =</span> <span class="fu">st_area</span>(geometry)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">as.numeric</span>(area) <span class="sc">&gt;</span> <span class="dv">300</span>) <span class="sc">%&gt;%</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>  nngeo<span class="sc">::</span><span class="fu">st_remove_holes</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">area_num =</span> <span class="fu">as.numeric</span>(area)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(out_class <span class="sc">==</span> <span class="dv">1</span>,</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>                area_num <span class="sc">==</span> <span class="dv">1215400</span>)</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(seagrass_mask)</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a><span class="do">############## S2 opening ####################</span></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>before <span class="ot">&lt;-</span> <span class="st">"Data/Sentinel2/S2B_MSIL2A_20210814T110619_N0500_R137_T30TVT_20230213T031209.SAFE"</span> <span class="sc">%&gt;%</span></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Read_S2</span>() <span class="sc">%&gt;%</span></span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crop</span>(msk_inter)</span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(before) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"B"</span>,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>))</span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>after <span class="ot">&lt;-</span> <span class="st">"Data/Sentinel2/S2B_MSIL2A_20210906T112109_N0500_R037_T30TVT_20230113T070720.SAFE"</span> <span class="sc">%&gt;%</span></span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Read_S2</span>() <span class="sc">%&gt;%</span></span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crop</span>(msk_inter)</span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(after) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"B"</span>,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>))</span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>before_corr <span class="ot">&lt;-</span> before <span class="sc">-</span> <span class="dv">1000</span></span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>NDVI_before <span class="ot">=</span> ((before_corr<span class="sc">$</span>B8)<span class="sc">-</span>(before_corr<span class="sc">$</span>B4))<span class="sc">/</span>((before_corr<span class="sc">$</span>B8)<span class="sc">+</span>(before_corr<span class="sc">$</span>B4))</span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a>GLI_before <span class="ot">=</span>  ((before_corr<span class="sc">$</span>B3<span class="sc">-</span>before_corr<span class="sc">$</span>B4)<span class="sc">+</span>(before_corr<span class="sc">$</span>B3<span class="sc">-</span>before_corr<span class="sc">$</span>B2)) <span class="sc">/</span> ((<span class="dv">2</span><span class="sc">*</span>before_corr<span class="sc">$</span>B3) <span class="sc">+</span> before_corr<span class="sc">$</span>B4<span class="sc">+</span>before_corr<span class="sc">$</span>B2)</span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a>after_corr <span class="ot">&lt;-</span> after <span class="sc">-</span> <span class="dv">1000</span></span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a>NDVI_after <span class="ot">=</span> ((after_corr<span class="sc">$</span>B8)<span class="sc">-</span>(after_corr<span class="sc">$</span>B4))<span class="sc">/</span>((after_corr<span class="sc">$</span>B8)<span class="sc">+</span>(after_corr<span class="sc">$</span>B4))</span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a>GLI_after <span class="ot">=</span>  ((after_corr<span class="sc">$</span>B3<span class="sc">-</span>after_corr<span class="sc">$</span>B4)<span class="sc">+</span>(after_corr<span class="sc">$</span>B3<span class="sc">-</span>after_corr<span class="sc">$</span>B2)) <span class="sc">/</span> ((<span class="dv">2</span><span class="sc">*</span>after_corr<span class="sc">$</span>B3) <span class="sc">+</span> after_corr<span class="sc">$</span>B4<span class="sc">+</span>after_corr<span class="sc">$</span>B2)</span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(NDVI_after) <span class="ot">&lt;-</span> <span class="st">"NDVI_after"</span></span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(NDVI_before) <span class="ot">&lt;-</span> <span class="st">"NDVI_before"</span></span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(GLI_after) <span class="ot">&lt;-</span> <span class="st">"GLI_after"</span></span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(GLI_before) <span class="ot">&lt;-</span> <span class="st">"GLI_before"</span></span>
<span id="cb25-55"><a href="#cb25-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-56"><a href="#cb25-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-57"><a href="#cb25-57" aria-hidden="true" tabindex="-1"></a>stk <span class="ot">&lt;-</span> <span class="fu">c</span>(NDVI_before,NDVI_after,GLI_before,GLI_after) <span class="sc">%&gt;%</span> </span>
<span id="cb25-58"><a href="#cb25-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crop</span>(seagrass_mask,<span class="at">mask =</span> T) </span>
<span id="cb25-59"><a href="#cb25-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-60"><a href="#cb25-60" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(stk,<span class="st">"Data/Sentinel2/Before_after_indices_meadowCropped.tif"</span>)</span>
<span id="cb25-61"><a href="#cb25-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-62"><a href="#cb25-62" aria-hidden="true" tabindex="-1"></a><span class="do">############### Litto3D ################# </span></span>
<span id="cb25-63"><a href="#cb25-63" aria-hidden="true" tabindex="-1"></a>filelist_litto <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">"Data/Litto3D"</span>, <span class="at">pattern =</span> <span class="st">"IGN69.asc"</span>, <span class="at">recursive =</span> T, <span class="at">full.names =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb25-64"><a href="#cb25-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb25-65"><a href="#cb25-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">path =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-66"><a href="#cb25-66" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">str_detect</span>(path, <span class="st">"MNT1m"</span>))</span>
<span id="cb25-67"><a href="#cb25-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-68"><a href="#cb25-68" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(filelist_litto)) {</span>
<span id="cb25-69"><a href="#cb25-69" aria-hidden="true" tabindex="-1"></a> a <span class="ot">&lt;-</span> <span class="fu">rast</span>(filelist_litto<span class="sc">$</span>path[i]) </span>
<span id="cb25-70"><a href="#cb25-70" aria-hidden="true" tabindex="-1"></a> <span class="fu">print</span>(<span class="fu">paste0</span>(i,<span class="st">"/"</span>,<span class="fu">nrow</span>(filelist_litto)))</span>
<span id="cb25-71"><a href="#cb25-71" aria-hidden="true" tabindex="-1"></a> <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">1</span> ){</span>
<span id="cb25-72"><a href="#cb25-72" aria-hidden="true" tabindex="-1"></a>   b <span class="ot">=</span> a</span>
<span id="cb25-73"><a href="#cb25-73" aria-hidden="true" tabindex="-1"></a> }<span class="cf">else</span>{</span>
<span id="cb25-74"><a href="#cb25-74" aria-hidden="true" tabindex="-1"></a>   b <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">merge</span>(b,a)</span>
<span id="cb25-75"><a href="#cb25-75" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb25-76"><a href="#cb25-76" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-77"><a href="#cb25-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-78"><a href="#cb25-78" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(b, <span class="st">"Data/Litto3D/Litto_1m_merged.tif"</span>, <span class="at">overwrite =</span> T)</span>
<span id="cb25-79"><a href="#cb25-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-80"><a href="#cb25-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-81"><a href="#cb25-81" aria-hidden="true" tabindex="-1"></a><span class="fu">crs</span>(b) <span class="ot">&lt;-</span> <span class="fu">crs</span>(<span class="st">"EPSG:2154"</span>)</span>
<span id="cb25-82"><a href="#cb25-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-83"><a href="#cb25-83" aria-hidden="true" tabindex="-1"></a>b_corr_HZ <span class="ot">&lt;-</span> b <span class="sc">+</span> <span class="fl">2.850</span> <span class="do">### Correct avergage sea level heigh to be in "lowest athmospheric tides"</span></span>
<span id="cb25-84"><a href="#cb25-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-85"><a href="#cb25-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-86"><a href="#cb25-86" aria-hidden="true" tabindex="-1"></a>b_32630 <span class="ot">&lt;-</span> b_corr_HZ <span class="sc">%&gt;%</span> </span>
<span id="cb25-87"><a href="#cb25-87" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">project</span>(<span class="fu">crs</span>(<span class="st">"EPSG:32630"</span>))</span>
<span id="cb25-88"><a href="#cb25-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-89"><a href="#cb25-89" aria-hidden="true" tabindex="-1"></a>b_32630_cropped <span class="ot">&lt;-</span> b_32630<span class="sc">%&gt;%</span> </span>
<span id="cb25-90"><a href="#cb25-90" aria-hidden="true" tabindex="-1"></a>  <span class="co"># crop(msk) %&gt;% </span></span>
<span id="cb25-91"><a href="#cb25-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crop</span>(msk_inter, <span class="at">mask =</span> T) </span>
<span id="cb25-92"><a href="#cb25-92" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-93"><a href="#cb25-93" aria-hidden="true" tabindex="-1"></a>litto_10m <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">resample</span>(b_32630_cropped, stk<span class="sc">$</span>NDVI_before, <span class="at">method =</span> <span class="st">"average"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-94"><a href="#cb25-94" aria-hidden="true" tabindex="-1"></a>  <span class="co"># crop(msk) %&gt;% </span></span>
<span id="cb25-95"><a href="#cb25-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crop</span>(seagrass_mask, <span class="at">mask =</span> T) </span>
<span id="cb25-96"><a href="#cb25-96" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(litto_10m) <span class="ot">=</span> <span class="st">"bathy"</span></span>
<span id="cb25-97"><a href="#cb25-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-98"><a href="#cb25-98" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(litto_10m, <span class="st">"Data/Litto3D/Litto_10m_merged_32630.tif"</span>, <span class="at">overwrite =</span> T)</span>
<span id="cb25-99"><a href="#cb25-99" aria-hidden="true" tabindex="-1"></a>litto_10m <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"Data/Litto3D/Litto_10m_merged_32630.tif"</span>)</span>
<span id="cb25-100"><a href="#cb25-100" aria-hidden="true" tabindex="-1"></a><span class="co"># Create contour lines (specify the contour interval or levels)</span></span>
<span id="cb25-101"><a href="#cb25-101" aria-hidden="true" tabindex="-1"></a>contours <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">as.contour</span>(b_32630_cropped, <span class="at">levels =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">8</span>,<span class="at">by =</span> <span class="fl">0.1</span>))</span>
<span id="cb25-102"><a href="#cb25-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-103"><a href="#cb25-103" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the SpatVector to sf object</span></span>
<span id="cb25-104"><a href="#cb25-104" aria-hidden="true" tabindex="-1"></a>contours_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(contours)</span>
<span id="cb25-105"><a href="#cb25-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-106"><a href="#cb25-106" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the structure of the sf object</span></span>
<span id="cb25-107"><a href="#cb25-107" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(contours_sf)</span>
<span id="cb25-108"><a href="#cb25-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-109"><a href="#cb25-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-110"><a href="#cb25-110" aria-hidden="true" tabindex="-1"></a><span class="fu">write_sf</span>(contours_sf,<span class="st">"Output/Bathy_lines1.shp"</span>)</span>
<span id="cb25-111"><a href="#cb25-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-112"><a href="#cb25-112" aria-hidden="true" tabindex="-1"></a>bathy_line <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"Output/Bathy_lines.shp"</span>)</span>
<span id="cb25-113"><a href="#cb25-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-114"><a href="#cb25-114" aria-hidden="true" tabindex="-1"></a><span class="do">############### Stacking ########### </span></span>
<span id="cb25-115"><a href="#cb25-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-116"><a href="#cb25-116" aria-hidden="true" tabindex="-1"></a>stk_litto <span class="ot">&lt;-</span> <span class="fu">c</span>(stk, litto_10m) <span class="sc">%&gt;%</span> </span>
<span id="cb25-117"><a href="#cb25-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(<span class="at">xy =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb25-118"><a href="#cb25-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_GLI =</span> (GLI_before<span class="sc">-</span>GLI_after), </span>
<span id="cb25-119"><a href="#cb25-119" aria-hidden="true" tabindex="-1"></a>         <span class="at">diff_NDVI =</span> NDVI_before<span class="sc">-</span>NDVI_after)</span>
<span id="cb25-120"><a href="#cb25-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-121"><a href="#cb25-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-122"><a href="#cb25-122" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb25-123"><a href="#cb25-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> stk_litto,<span class="fu">aes</span>(<span class="at">x =</span> bathy, <span class="at">y =</span> diff_GLI)) <span class="sc">+</span> </span>
<span id="cb25-124"><a href="#cb25-124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span> (<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb25-125"><a href="#cb25-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-126"><a href="#cb25-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-127"><a href="#cb25-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-128"><a href="#cb25-128" aria-hidden="true" tabindex="-1"></a>rast_darkening <span class="ot">&lt;-</span> stk_litto  <span class="sc">%&gt;%</span> </span>
<span id="cb25-129"><a href="#cb25-129" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(x,y,diff_GLI)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-130"><a href="#cb25-130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rast</span>(<span class="at">type =</span> <span class="st">"xyz"</span>, <span class="at">crs =</span> <span class="st">"EPSG:32630"</span>) </span>
<span id="cb25-131"><a href="#cb25-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-132"><a href="#cb25-132" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(rast_darkening, <span class="st">"Output/diff_gli.tif"</span>, <span class="at">overwrite =</span> T)</span>
<span id="cb25-133"><a href="#cb25-133" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-134"><a href="#cb25-134" aria-hidden="true" tabindex="-1"></a>dark_seagrass <span class="ot">&lt;-</span> rast_darkening <span class="sc">&gt;</span> <span class="fl">0.18</span></span>
<span id="cb25-135"><a href="#cb25-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-136"><a href="#cb25-136" aria-hidden="true" tabindex="-1"></a><span class="fu">values</span>(dark_seagrass)[<span class="fu">values</span>(dark_seagrass)<span class="sc">==</span>F] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb25-137"><a href="#cb25-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-138"><a href="#cb25-138" aria-hidden="true" tabindex="-1"></a>sf_darkseagrass <span class="ot">&lt;-</span> <span class="fu">as.polygons</span>(dark_seagrass) <span class="sc">%&gt;%</span> </span>
<span id="cb25-139"><a href="#cb25-139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb25-140"><a href="#cb25-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"POLYGON"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-141"><a href="#cb25-141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">area =</span> <span class="fu">st_area</span>(geometry)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-142"><a href="#cb25-142" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">as.numeric</span>(area) <span class="sc">&gt;</span> <span class="dv">300</span>) <span class="sc">%&gt;%</span></span>
<span id="cb25-143"><a href="#cb25-143" aria-hidden="true" tabindex="-1"></a>  nngeo<span class="sc">::</span><span class="fu">st_remove_holes</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb25-144"><a href="#cb25-144" aria-hidden="true" tabindex="-1"></a>  smoothr<span class="sc">::</span><span class="fu">smooth</span>(<span class="at">method =</span> <span class="st">"ksmooth"</span>, <span class="at">smoothness =</span> <span class="dv">2</span>)</span>
<span id="cb25-145"><a href="#cb25-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-146"><a href="#cb25-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-147"><a href="#cb25-147" aria-hidden="true" tabindex="-1"></a><span class="fu">write_sf</span>(sf_darkseagrass,<span class="st">"Output/darkening_patches.shp"</span>)</span>
<span id="cb25-148"><a href="#cb25-148" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sf_darkseagrass)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [24]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>Tide_info<span class="ot">&lt;-</span><span class="cf">function</span>(<span class="at">coords=</span><span class="cn">NA</span>,<span class="at">tide_date=</span><span class="cn">NA</span>){</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  data_coord<span class="ot">&lt;-</span><span class="fu">list.files</span>(<span class="st">"./"</span>, <span class="at">pattern=</span><span class="st">"station_coordinate.csv"</span>,<span class="at">full.names =</span> T,<span class="at">recursive =</span> T)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(data_coord)<span class="sc">==</span><span class="dv">1</span>) {</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    station_coordinate<span class="ot">&lt;-</span><span class="fu">read.csv</span>(data_coord)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">exists</span>(<span class="st">"station_coordinate"</span>)<span class="sc">==</span><span class="cn">FALSE</span>) {</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>    url_stat<span class="ot">&lt;-</span><span class="st">"http://www.ioc-sealevelmonitoring.org/list.php?operator=&amp;showall=all&amp;output=general"</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">download.file</span>(url_stat, <span class="at">destfile =</span> <span class="st">"scrapedpage_stat.html"</span>,<span class="at">quiet=</span>T)</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>    webpage_stat <span class="ot">&lt;-</span> <span class="fu">read_html</span>(<span class="st">"scrapedpage_stat.html"</span>)</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>    stat_table<span class="ot">&lt;-</span>rvest<span class="sc">::</span><span class="fu">html_text</span>(rvest<span class="sc">::</span><span class="fu">html_nodes</span>(webpage_stat,<span class="st">'td'</span>))</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>    stat_table<span class="ot">&lt;-</span>stat_table[<span class="sc">-</span><span class="fu">length</span>(stat_table)]</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>    stat_table<span class="ot">&lt;-</span>stat_table[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">19</span>)]</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>    name_stat_table<span class="ot">&lt;-</span>stat_table[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)]</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>    name_stat_table<span class="ot">&lt;-</span><span class="fu">unlist</span>(<span class="fu">strsplit</span>(name_stat_table,<span class="st">"</span><span class="sc">\r\r\n\t\t\t\t</span><span class="st">"</span>))</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>    name_stat_table[<span class="dv">8</span>]<span class="ot">&lt;-</span><span class="st">"Last_Observation_Time_in_GMT"</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(name_stat_table)) {</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>      name_stat_table[i]<span class="ot">&lt;-</span><span class="fu">gsub</span>(<span class="st">" "</span>,<span class="st">"_"</span>,  name_stat_table[i])</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>    stat_table<span class="ot">&lt;-</span>stat_table[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)]</span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>    stat_table<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(<span class="fu">matrix</span>(stat_table,<span class="at">ncol=</span><span class="dv">11</span>,<span class="at">byrow =</span> T))</span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(stat_table)<span class="ot">&lt;-</span>name_stat_table</span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>    stat_table<span class="ot">&lt;-</span>stat_table[<span class="fu">which</span>((<span class="fu">nchar</span>(stat_table<span class="sc">$</span>Code)<span class="sc">==</span><span class="dv">4</span>)<span class="sc">|</span>(<span class="fu">nchar</span>(stat_table<span class="sc">$</span>Code)<span class="sc">==</span><span class="dv">5</span>)),]</span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># stat_table&lt;-stat_table[which(stat_table$Connection=="ftp"),]</span></span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a>    stat_table<span class="sc">$</span>Last_Observation_Time_in_GMT<span class="ot">&lt;-</span><span class="fu">substr</span>(stat_table<span class="sc">$</span>Last_Observation_Time_in_GMT,<span class="dv">7</span>,<span class="fu">nchar</span>(stat_table<span class="sc">$</span>Last_Observation_Time_in_GMT))</span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a>    stat_table<span class="ot">&lt;-</span>stat_table[<span class="fu">which</span>((stat_table<span class="sc">$</span>Last_Observation_Time_in_GMT<span class="sc">!=</span><span class="st">"-down-"</span>)),]</span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a>    stat_table<span class="ot">&lt;-</span>stat_table[<span class="fu">which</span>((stat_table<span class="sc">$</span>Last_Observation_Time_in_GMT<span class="sc">!=</span><span class="st">"-maintenance-"</span>)),]</span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(stat_table)) {</span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(<span class="fu">paste0</span>(i,<span class="st">"/"</span>,<span class="fu">nrow</span>(stat_table),<span class="st">" station: "</span>,stat_table<span class="sc">$</span>Code[i]))</span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a>      url_coord<span class="ot">&lt;-</span><span class="fu">paste0</span>(<span class="st">"http://www.ioc-sealevelmonitoring.org/station.php?code="</span>,stat_table<span class="sc">$</span>Code[i])</span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a>      <span class="fu">download.file</span>(url_coord, <span class="at">destfile =</span> <span class="st">"scrapedpage_coord.html"</span>,<span class="at">quiet=</span>T)</span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a>      webpage <span class="ot">&lt;-</span> <span class="fu">read_html</span>(<span class="st">"scrapedpage_coord.html"</span>)</span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a>      stat_coord<span class="ot">&lt;-</span><span class="fu">as.character</span>(rvest<span class="sc">::</span><span class="fu">html_text</span>(rvest<span class="sc">::</span><span class="fu">html_nodes</span>(webpage,<span class="st">'tr'</span>)))</span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true" tabindex="-1"></a>      lat<span class="ot">&lt;-</span>stat_coord[<span class="fu">which</span>(<span class="fu">substr</span>(stat_coord,<span class="dv">1</span>,<span class="dv">8</span>)<span class="sc">==</span><span class="st">"Latitude"</span>)]</span>
<span id="cb26-50"><a href="#cb26-50" aria-hidden="true" tabindex="-1"></a>      long<span class="ot">&lt;-</span>stat_coord[<span class="fu">which</span>(<span class="fu">substr</span>(stat_coord,<span class="dv">1</span>,<span class="dv">9</span>)<span class="sc">==</span><span class="st">"Longitude"</span>)]</span>
<span id="cb26-51"><a href="#cb26-51" aria-hidden="true" tabindex="-1"></a>      lat<span class="ot">&lt;-</span><span class="fu">gsub</span>(<span class="st">"Latitude . "</span>,<span class="st">""</span>,lat)</span>
<span id="cb26-52"><a href="#cb26-52" aria-hidden="true" tabindex="-1"></a>      long<span class="ot">&lt;-</span><span class="fu">gsub</span>(<span class="st">"Longitude . "</span>,<span class="st">""</span>,long)</span>
<span id="cb26-53"><a href="#cb26-53" aria-hidden="true" tabindex="-1"></a>      stat_table<span class="sc">$</span>long[i]<span class="ot">&lt;-</span>long</span>
<span id="cb26-54"><a href="#cb26-54" aria-hidden="true" tabindex="-1"></a>      stat_table<span class="sc">$</span>lat[i]<span class="ot">&lt;-</span>lat</span>
<span id="cb26-55"><a href="#cb26-55" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb26-56"><a href="#cb26-56" aria-hidden="true" tabindex="-1"></a>      station_coordinate<span class="ot">&lt;-</span>stat_table</span>
<span id="cb26-57"><a href="#cb26-57" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb26-58"><a href="#cb26-58" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb26-59"><a href="#cb26-59" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb26-60"><a href="#cb26-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># return(station_coordinate)</span></span>
<span id="cb26-61"><a href="#cb26-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write.csv</span>(station_coordinate,<span class="st">"./station_coordinate.csv"</span>)</span>
<span id="cb26-62"><a href="#cb26-62" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb26-63"><a href="#cb26-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-64"><a href="#cb26-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-65"><a href="#cb26-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-66"><a href="#cb26-66" aria-hidden="true" tabindex="-1"></a>  sr<span class="ot">&lt;-</span><span class="fu">crs</span>(<span class="st">'+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs'</span>)</span>
<span id="cb26-67"><a href="#cb26-67" aria-hidden="true" tabindex="-1"></a>  <span class="co"># coord_centroid&lt;-data.frame(x=(c(xmax(roi)+xmin(roi), ymax(roi)+ymin(roi))/2)[1],</span></span>
<span id="cb26-68"><a href="#cb26-68" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                            y=(c(xmax(roi)+xmin(roi), ymax(roi)+ymin(roi))/2)[2])</span></span>
<span id="cb26-69"><a href="#cb26-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-70"><a href="#cb26-70" aria-hidden="true" tabindex="-1"></a>  <span class="co"># coordinates(coord_centroid)&lt;- ~x+y</span></span>
<span id="cb26-71"><a href="#cb26-71" aria-hidden="true" tabindex="-1"></a>  <span class="co"># crs(coord_centroid)&lt;-crs(roi)</span></span>
<span id="cb26-72"><a href="#cb26-72" aria-hidden="true" tabindex="-1"></a>  <span class="co"># </span></span>
<span id="cb26-73"><a href="#cb26-73" aria-hidden="true" tabindex="-1"></a>  <span class="co"># roi &lt;- spTransform(coord_centroid, sr)</span></span>
<span id="cb26-74"><a href="#cb26-74" aria-hidden="true" tabindex="-1"></a>  <span class="co"># coord_centroid&lt;-c(xmax(roi)+xmin(roi), ymax(roi)+ymin(roi))/2</span></span>
<span id="cb26-75"><a href="#cb26-75" aria-hidden="true" tabindex="-1"></a>  <span class="co"># </span></span>
<span id="cb26-76"><a href="#cb26-76" aria-hidden="true" tabindex="-1"></a>  dist_roi_Tide<span class="ot">&lt;-</span><span class="fu">data.frame</span>(</span>
<span id="cb26-77"><a href="#cb26-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">code_tide=</span>station_coordinate<span class="sc">$</span>Code,</span>
<span id="cb26-78"><a href="#cb26-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">Name_station=</span>station_coordinate<span class="sc">$</span>Location,</span>
<span id="cb26-79"><a href="#cb26-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">dist=</span><span class="cn">NA</span></span>
<span id="cb26-80"><a href="#cb26-80" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb26-81"><a href="#cb26-81" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-82"><a href="#cb26-82" aria-hidden="true" tabindex="-1"></a>  coord_centroid <span class="ot">=</span> coords</span>
<span id="cb26-83"><a href="#cb26-83" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-84"><a href="#cb26-84" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(station_coordinate)) {</span>
<span id="cb26-85"><a href="#cb26-85" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-86"><a href="#cb26-86" aria-hidden="true" tabindex="-1"></a>    dist_roi_Tide<span class="sc">$</span>dist[i]<span class="ot">&lt;-</span><span class="fu">sqrt</span>(((coord_centroid[<span class="dv">2</span>]<span class="sc">-</span>station_coordinate<span class="sc">$</span>long[i])<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span>(coord_centroid[<span class="dv">1</span>]<span class="sc">-</span>station_coordinate<span class="sc">$</span>lat[i])<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb26-87"><a href="#cb26-87" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb26-88"><a href="#cb26-88" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-89"><a href="#cb26-89" aria-hidden="true" tabindex="-1"></a>  site_name_selected<span class="ot">&lt;-</span>dist_roi_Tide[<span class="fu">which</span>(dist_roi_Tide<span class="sc">$</span>dist<span class="sc">==</span><span class="fu">min</span>(dist_roi_Tide<span class="sc">$</span>dist)),]</span>
<span id="cb26-90"><a href="#cb26-90" aria-hidden="true" tabindex="-1"></a>  site_id<span class="ot">&lt;-</span>site_name_selected<span class="sc">$</span>code_tide[<span class="dv">1</span>]</span>
<span id="cb26-91"><a href="#cb26-91" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-92"><a href="#cb26-92" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-93"><a href="#cb26-93" aria-hidden="true" tabindex="-1"></a>  tide_date_wrong<span class="ot">&lt;-</span><span class="fu">as.POSIXct</span>(tide_date, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)</span>
<span id="cb26-94"><a href="#cb26-94" aria-hidden="true" tabindex="-1"></a>  tide_date_true<span class="ot">&lt;-</span>tide_date_wrong<span class="sc">+</span> (<span class="dv">60</span><span class="sc">*</span><span class="dv">60</span><span class="sc">*</span><span class="dv">24</span>)</span>
<span id="cb26-95"><a href="#cb26-95" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-96"><a href="#cb26-96" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-97"><a href="#cb26-97" aria-hidden="true" tabindex="-1"></a>  <span class="co"># site_id&lt;-"batr"</span></span>
<span id="cb26-98"><a href="#cb26-98" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-99"><a href="#cb26-99" aria-hidden="true" tabindex="-1"></a>  url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"http://www.ioc-sealevelmonitoring.org/bgraph.php?code="</span>,site_id,<span class="st">"&amp;output=tab&amp;period=1&amp;endtime="</span>,tide_date_true)</span>
<span id="cb26-100"><a href="#cb26-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">download.file</span>(url, <span class="at">destfile =</span> <span class="st">"scrapedpage.html"</span>,<span class="at">quiet=</span>T)</span>
<span id="cb26-101"><a href="#cb26-101" aria-hidden="true" tabindex="-1"></a>  webpage <span class="ot">&lt;-</span> <span class="fu">read_html</span>(<span class="st">"scrapedpage.html"</span>)</span>
<span id="cb26-102"><a href="#cb26-102" aria-hidden="true" tabindex="-1"></a>  tidal_RAW<span class="ot">&lt;-</span>rvest<span class="sc">::</span><span class="fu">html_text</span>(rvest<span class="sc">::</span><span class="fu">html_nodes</span>(webpage,<span class="st">'td'</span>))</span>
<span id="cb26-103"><a href="#cb26-103" aria-hidden="true" tabindex="-1"></a>  Tide_table<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(<span class="fu">matrix</span>(tidal_RAW,<span class="at">ncol=</span><span class="dv">2</span>, <span class="at">byrow =</span> T))</span>
<span id="cb26-104"><a href="#cb26-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(Tide_table)<span class="ot">&lt;-</span>Tide_table[<span class="dv">1</span>,]</span>
<span id="cb26-105"><a href="#cb26-105" aria-hidden="true" tabindex="-1"></a>  Tide_table<span class="ot">&lt;-</span>Tide_table[<span class="sc">-</span><span class="dv">1</span>,]</span>
<span id="cb26-106"><a href="#cb26-106" aria-hidden="true" tabindex="-1"></a>  Tide_table<span class="sc">$</span><span class="st">`</span><span class="at">Time (UTC)</span><span class="st">`</span><span class="ot">&lt;-</span><span class="fu">as.POSIXct</span>(Tide_table<span class="sc">$</span><span class="st">`</span><span class="at">Time (UTC)</span><span class="st">`</span>, <span class="at">tryFormats =</span> <span class="fu">c</span>(<span class="st">"%Y-%m-%d %H:%M:%OS"</span>,</span>
<span id="cb26-107"><a href="#cb26-107" aria-hidden="true" tabindex="-1"></a>                                                                              <span class="st">"%Y/%m/%d %H:%M:%OS"</span>,</span>
<span id="cb26-108"><a href="#cb26-108" aria-hidden="true" tabindex="-1"></a>                                                                              <span class="st">"%Y-%m-%d %H:%M"</span>,</span>
<span id="cb26-109"><a href="#cb26-109" aria-hidden="true" tabindex="-1"></a>                                                                              <span class="st">"%Y/%m/%d %H:%M"</span>,</span>
<span id="cb26-110"><a href="#cb26-110" aria-hidden="true" tabindex="-1"></a>                                                                              <span class="st">"%Y-%m-%d"</span>,</span>
<span id="cb26-111"><a href="#cb26-111" aria-hidden="true" tabindex="-1"></a>                                                                              <span class="st">"%Y/%m/%d"</span>,</span>
<span id="cb26-112"><a href="#cb26-112" aria-hidden="true" tabindex="-1"></a>                                                                              <span class="st">"%Y%m%d %H:%M:%OS3"</span>,</span>
<span id="cb26-113"><a href="#cb26-113" aria-hidden="true" tabindex="-1"></a>                                                                              <span class="st">"%Y%m%d %H:%M"</span>,</span>
<span id="cb26-114"><a href="#cb26-114" aria-hidden="true" tabindex="-1"></a>                                                                              <span class="st">"%Y%m%d"</span>))</span>
<span id="cb26-115"><a href="#cb26-115" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-116"><a href="#cb26-116" aria-hidden="true" tabindex="-1"></a>  Tide_table_aggregate <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(<span class="fu">as.numeric</span>(Tide_table[,<span class="dv">2</span>]), </span>
<span id="cb26-117"><a href="#cb26-117" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">list</span>(<span class="at">fiveMin=</span><span class="fu">cut</span>(Tide_table<span class="sc">$</span><span class="st">`</span><span class="at">Time (UTC)</span><span class="st">`</span>, <span class="st">"10 mins"</span>)),</span>
<span id="cb26-118"><a href="#cb26-118" aria-hidden="true" tabindex="-1"></a>                                    mean)</span>
<span id="cb26-119"><a href="#cb26-119" aria-hidden="true" tabindex="-1"></a>  <span class="co"># # Tide_table_aggregate$x&lt;-round(Tide_table_aggregate$x,3)</span></span>
<span id="cb26-120"><a href="#cb26-120" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Tide_table_aggregate$fiveMin&lt;-as.POSIXct(Tide_table_aggregate$fiveMin, tryFormats = c("%Y-%m-%d %H:%M:%S",</span></span>
<span id="cb26-121"><a href="#cb26-121" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                                                                                       "%Y/%m/%d %H:%M:%S",</span></span>
<span id="cb26-122"><a href="#cb26-122" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                                                                                       "%Y-%m-%d %H:%M",</span></span>
<span id="cb26-123"><a href="#cb26-123" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                                                                                       "%Y/%m/%d %H:%M",</span></span>
<span id="cb26-124"><a href="#cb26-124" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                                                                                       "%Y-%m-%d",</span></span>
<span id="cb26-125"><a href="#cb26-125" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                                                                                       "%Y/%m/%d",</span></span>
<span id="cb26-126"><a href="#cb26-126" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                                                                                       "%Y%m%d %H:%M:%S",</span></span>
<span id="cb26-127"><a href="#cb26-127" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                                                                                       "%Y%m%d %H:%M",</span></span>
<span id="cb26-128"><a href="#cb26-128" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                                                                                       "%Y%m%d"))</span></span>
<span id="cb26-129"><a href="#cb26-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-130"><a href="#cb26-130" aria-hidden="true" tabindex="-1"></a>  Tide_table_aggregate<span class="sc">$</span>smooth<span class="ot">&lt;-</span>signal<span class="sc">::</span><span class="fu">sgolayfilt</span>(Tide_table_aggregate<span class="sc">$</span>x,<span class="at">n=</span><span class="dv">15</span>)</span>
<span id="cb26-131"><a href="#cb26-131" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-132"><a href="#cb26-132" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Tide_table_aggregate$first_diff&lt;- ave(Tide_table_aggregate$smooth , Tide_table_aggregate$fiveMin , FUN=function(i) c(NA,diff(i)))</span></span>
<span id="cb26-133"><a href="#cb26-133" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-134"><a href="#cb26-134" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-135"><a href="#cb26-135" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-136"><a href="#cb26-136" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-137"><a href="#cb26-137" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">nrow</span>(Tide_table_aggregate)<span class="sc">-</span><span class="dv">1</span>)) {</span>
<span id="cb26-138"><a href="#cb26-138" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-139"><a href="#cb26-139" aria-hidden="true" tabindex="-1"></a>    a<span class="ot">&lt;-</span><span class="fu">as.numeric</span>(Tide_table_aggregate[i,<span class="dv">3</span>])<span class="sc">-</span><span class="fu">as.numeric</span>(Tide_table_aggregate[i<span class="sc">+</span><span class="dv">1</span>,<span class="dv">3</span>])</span>
<span id="cb26-140"><a href="#cb26-140" aria-hidden="true" tabindex="-1"></a>    <span class="co"># a&lt;-round(a,digits = 2)</span></span>
<span id="cb26-141"><a href="#cb26-141" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-142"><a href="#cb26-142" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (i<span class="sc">==</span><span class="dv">1</span>) {</span>
<span id="cb26-143"><a href="#cb26-143" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb26-144"><a href="#cb26-144" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (a<span class="sc">&gt;</span><span class="dv">0</span>) {</span>
<span id="cb26-145"><a href="#cb26-145" aria-hidden="true" tabindex="-1"></a>        Tide_type<span class="ot">&lt;-</span><span class="st">"jusant"</span></span>
<span id="cb26-146"><a href="#cb26-146" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb26-147"><a href="#cb26-147" aria-hidden="true" tabindex="-1"></a>      }<span class="cf">else</span>{</span>
<span id="cb26-148"><a href="#cb26-148" aria-hidden="true" tabindex="-1"></a>        Tide_type<span class="ot">&lt;-</span><span class="st">"flot"</span></span>
<span id="cb26-149"><a href="#cb26-149" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb26-150"><a href="#cb26-150" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb26-151"><a href="#cb26-151" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb26-152"><a href="#cb26-152" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (a<span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">&amp;</span> Tide_type<span class="sc">==</span><span class="st">"flot"</span> ) {</span>
<span id="cb26-153"><a href="#cb26-153" aria-hidden="true" tabindex="-1"></a>        Tide_table_aggregate[i,<span class="dv">4</span>]<span class="ot">&lt;-</span><span class="st">"HT"</span></span>
<span id="cb26-154"><a href="#cb26-154" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb26-155"><a href="#cb26-155" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (a<span class="sc">&lt;</span><span class="dv">0</span> <span class="sc">&amp;</span> Tide_type<span class="sc">==</span><span class="st">"jusant"</span> ){</span>
<span id="cb26-156"><a href="#cb26-156" aria-hidden="true" tabindex="-1"></a>        Tide_table_aggregate[i,<span class="dv">4</span>]<span class="ot">&lt;-</span><span class="st">"LT"</span></span>
<span id="cb26-157"><a href="#cb26-157" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb26-158"><a href="#cb26-158" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (a<span class="sc">&gt;</span><span class="dv">0</span>) {</span>
<span id="cb26-159"><a href="#cb26-159" aria-hidden="true" tabindex="-1"></a>        Tide_type<span class="ot">&lt;-</span><span class="st">"jusant"</span></span>
<span id="cb26-160"><a href="#cb26-160" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb26-161"><a href="#cb26-161" aria-hidden="true" tabindex="-1"></a>      }<span class="cf">else</span>{</span>
<span id="cb26-162"><a href="#cb26-162" aria-hidden="true" tabindex="-1"></a>        Tide_type<span class="ot">&lt;-</span><span class="st">"flot"</span></span>
<span id="cb26-163"><a href="#cb26-163" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb26-164"><a href="#cb26-164" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb26-165"><a href="#cb26-165" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb26-166"><a href="#cb26-166" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-167"><a href="#cb26-167" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb26-168"><a href="#cb26-168" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(Tide_table_aggregate)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">'date'</span>,<span class="st">'water_height'</span>,<span class="st">"smooth"</span>,<span class="st">'tide_step'</span>)</span>
<span id="cb26-169"><a href="#cb26-169" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-170"><a href="#cb26-170" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-171"><a href="#cb26-171" aria-hidden="true" tabindex="-1"></a>  Tide_table_aggregate<span class="sc">$</span>date1 <span class="ot">&lt;-</span> <span class="fu">as.character</span>(Tide_table_aggregate<span class="sc">$</span>date) <span class="sc">%&gt;%</span> </span>
<span id="cb26-172"><a href="#cb26-172" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.POSIXct</span>(<span class="at">format =</span> <span class="st">"%Y-%m-%d %H:%M:%S"</span>)</span>
<span id="cb26-173"><a href="#cb26-173" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-174"><a href="#cb26-174" aria-hidden="true" tabindex="-1"></a>  Tide_table_aggregate<span class="sc">$</span>date1[<span class="dv">1</span>]<span class="ot">&lt;-</span> <span class="fu">as.character</span>(Tide_table_aggregate<span class="sc">$</span>date[<span class="dv">1</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb26-175"><a href="#cb26-175" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.POSIXct</span>(<span class="at">format =</span> <span class="st">"%Y-%m-%d %H:%M:%S"</span>)</span>
<span id="cb26-176"><a href="#cb26-176" aria-hidden="true" tabindex="-1"></a>  Tide_table_aggregate<span class="sc">$</span>date1[<span class="fu">nrow</span>(Tide_table_aggregate)]<span class="ot">&lt;-</span> <span class="fu">as.character</span>(Tide_table_aggregate<span class="sc">$</span>date[<span class="fu">nrow</span>(Tide_table_aggregate)]) <span class="sc">%&gt;%</span> </span>
<span id="cb26-177"><a href="#cb26-177" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.POSIXct</span>(<span class="at">format =</span> <span class="st">"%Y-%m-%d %H:%M:%S"</span>)</span>
<span id="cb26-178"><a href="#cb26-178" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-179"><a href="#cb26-179" aria-hidden="true" tabindex="-1"></a>  Tide_table_aggregate <span class="ot">&lt;-</span> Tide_table_aggregate <span class="sc">%&gt;%</span> </span>
<span id="cb26-180"><a href="#cb26-180" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>date) <span class="sc">%&gt;%</span> </span>
<span id="cb26-181"><a href="#cb26-181" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">date =</span> <span class="st">"date1"</span>)</span>
<span id="cb26-182"><a href="#cb26-182" aria-hidden="true" tabindex="-1"></a>  BMPM<span class="ot">&lt;-</span>Tide_table_aggregate[<span class="fu">which</span>(<span class="fu">is.na</span>(Tide_table_aggregate[,<span class="dv">4</span>])<span class="sc">==</span><span class="cn">FALSE</span>),]</span>
<span id="cb26-183"><a href="#cb26-183" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-184"><a href="#cb26-184" aria-hidden="true" tabindex="-1"></a>  plot_tide<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data=</span>Tide_table_aggregate,<span class="fu">aes</span>(<span class="at">x=</span>date,<span class="at">y=</span>water_height))<span class="sc">+</span></span>
<span id="cb26-185"><a href="#cb26-185" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>()</span>
<span id="cb26-186"><a href="#cb26-186" aria-hidden="true" tabindex="-1"></a>    <span class="co"># geom_vline(xintercept = as.POSIXct(BMPM$date,tryFormats = c("%Y-%m-%d %H:%M:%OS",</span></span>
<span id="cb26-187"><a href="#cb26-187" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                                                             "%Y/%m/%d %H:%M:%OS",</span></span>
<span id="cb26-188"><a href="#cb26-188" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                                                             "%Y-%m-%d %H:%M",</span></span>
<span id="cb26-189"><a href="#cb26-189" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                                                             "%Y/%m/%d %H:%M",</span></span>
<span id="cb26-190"><a href="#cb26-190" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                                                             "%Y-%m-%d",</span></span>
<span id="cb26-191"><a href="#cb26-191" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                                                             "%Y/%m/%d",</span></span>
<span id="cb26-192"><a href="#cb26-192" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                                                             "%Y%m%d %H:%M:%OS3",</span></span>
<span id="cb26-193"><a href="#cb26-193" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                                                             "%Y%m%d %H:%M",</span></span>
<span id="cb26-194"><a href="#cb26-194" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                                                             "%Y%m%d")), linetype="dotted", </span></span>
<span id="cb26-195"><a href="#cb26-195" aria-hidden="true" tabindex="-1"></a>    <span class="co">#            color = "blue", size=1.5)</span></span>
<span id="cb26-196"><a href="#cb26-196" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span></span>
<span id="cb26-197"><a href="#cb26-197" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb26-198"><a href="#cb26-198" aria-hidden="true" tabindex="-1"></a>  out<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb26-199"><a href="#cb26-199" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>site<span class="ot">&lt;-</span>site_name_selected</span>
<span id="cb26-200"><a href="#cb26-200" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>tide<span class="ot">&lt;-</span>BMPM</span>
<span id="cb26-201"><a href="#cb26-201" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>df_tide<span class="ot">&lt;-</span>Tide_table_aggregate[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">4</span>)]</span>
<span id="cb26-202"><a href="#cb26-202" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>tide_plot<span class="ot">&lt;-</span>plot_tide</span>
<span id="cb26-203"><a href="#cb26-203" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-204"><a href="#cb26-204" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb26-205"><a href="#cb26-205" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-206"><a href="#cb26-206" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [25]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Utilities.Package)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(heatwaveR)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>dates <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"2021-09-01"</span>, <span class="st">"2021-09-02"</span>,<span class="st">"2021-09-03"</span>,<span class="st">"2021-09-04"</span>, <span class="st">"2021-09-05"</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">47.586782</span>, <span class="sc">-</span><span class="fl">3.121514</span>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>icecream <span class="ot">&lt;-</span> <span class="st">"Data/ICECREAM/S2B_MSIL2A_20210906T112109_N0500_R037_T30TVT_20230113T070720_Pred_BFRD.tif"</span> <span class="sc">%&gt;%</span> </span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rast</span>(<span class="at">lyr =</span> <span class="dv">1</span>)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="fu">crs</span>(icecream)<span class="ot">&lt;-</span><span class="fu">crs</span>(<span class="st">"EPSG:32630"</span>)</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>seagrass_mask <span class="ot">&lt;-</span> (icecream <span class="sc">==</span> <span class="dv">3</span> <span class="sc">|</span> icecream <span class="sc">==</span> <span class="dv">4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.polygons</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"POLYGON"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">area =</span> <span class="fu">st_area</span>(geometry)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">as.numeric</span>(area) <span class="sc">&gt;</span> <span class="dv">300</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>  nngeo<span class="sc">::</span><span class="fu">st_remove_holes</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">area_num =</span> <span class="fu">as.numeric</span>(area)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(out_class <span class="sc">==</span> <span class="dv">1</span>,</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>                area_num <span class="sc">==</span> <span class="dv">1215400</span>)</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(dates)){</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>  tide_data <span class="ot">&lt;-</span> <span class="fu">Tide_info</span>(<span class="at">coords =</span> coords, <span class="at">tide_date =</span> dates[i])</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>    df_tide <span class="ot">=</span> tide_data<span class="sc">$</span>tide <span class="sc">%&gt;%</span> </span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tibble</span>()</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>    df_tide <span class="ot">=</span> <span class="fu">rbind</span>(df_tide,tide_data<span class="sc">$</span>tide)</span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>tabfill <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"UnderWater"</span> <span class="ot">=</span> <span class="st">"darkblue"</span>,<span class="st">"Exposed"</span> <span class="ot">=</span> <span class="st">"darkred"</span>)</span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>plot_tide <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(df_tide)<span class="sc">+</span></span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> smooth))<span class="sc">+</span></span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">3.9</span>, <span class="at">color =</span> <span class="st">"goldenrod2"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_flame</span>(</span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> smooth, <span class="at">y2 =</span> <span class="fl">3.9</span>,</span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"UnderWater"</span>),</span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.2</span></span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">+</span></span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_flame</span>(</span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y2 =</span> smooth, <span class="at">y =</span> <span class="fl">3.9</span>,</span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> <span class="st">"Exposed"</span>),</span>
<span id="cb27-48"><a href="#cb27-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.1</span></span>
<span id="cb27-49"><a href="#cb27-49" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">+</span></span>
<span id="cb27-50"><a href="#cb27-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> tabfill,</span>
<span id="cb27-51"><a href="#cb27-51" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Exposed Seagrass"</span>, <span class="st">"Under Water Seagrasses"</span>),</span>
<span id="cb27-52"><a href="#cb27-52" aria-hidden="true" tabindex="-1"></a>                    <span class="at">name =</span> <span class="cn">NULL</span>)<span class="sc">+</span></span>
<span id="cb27-53"><a href="#cb27-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Water Height (m)"</span>)<span class="sc">+</span></span>
<span id="cb27-54"><a href="#cb27-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_Bede</span>()<span class="sc">+</span></span>
<span id="cb27-55"><a href="#cb27-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.22</span>, <span class="fl">0.1</span>),</span>
<span id="cb27-56"><a href="#cb27-56" aria-hidden="true" tabindex="-1"></a>        <span class="co"># legend.text = element_text(hjust = 0),</span></span>
<span id="cb27-57"><a href="#cb27-57" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb27-58"><a href="#cb27-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text.y =</span> <span class="fu">element_blank</span>(),  <span class="co"># Remove facet titles (strip text)</span></span>
<span id="cb27-59"><a href="#cb27-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb27-60"><a href="#cb27-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb27-61"><a href="#cb27-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># legend.position = "bottom",</span></span>
<span id="cb27-62"><a href="#cb27-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-63"><a href="#cb27-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>),</span>
<span id="cb27-64"><a href="#cb27-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.box =</span> <span class="st">"vertical"</span>,  <span class="co"># Stack legends vertically</span></span>
<span id="cb27-65"><a href="#cb27-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.box.just =</span> <span class="st">"left"</span>,  <span class="co"># Align the legends to the left</span></span>
<span id="cb27-66"><a href="#cb27-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.spacing.y =</span> <span class="fu">unit</span>(<span class="fl">0.1</span>, <span class="st">'mm'</span>),  <span class="co"># Adjust vertical spacing</span></span>
<span id="cb27-67"><a href="#cb27-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.spacing.x =</span> <span class="fu">unit</span>(<span class="fl">0.1</span>, <span class="st">'mm'</span>) ,  <span class="co"># Adjust horizontal spacing   </span></span>
<span id="cb27-68"><a href="#cb27-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># legend.key = element_rect(fill = "white", color = "black"),  # Ensure clear legend keys</span></span>
<span id="cb27-69"><a href="#cb27-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.box.margin =</span> <span class="fu">margin</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb27-70"><a href="#cb27-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">size =</span><span class="dv">19</span>),</span>
<span id="cb27-71"><a href="#cb27-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">19</span>),</span>
<span id="cb27-72"><a href="#cb27-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">19</span>),</span>
<span id="cb27-73"><a href="#cb27-73" aria-hidden="true" tabindex="-1"></a>    <span class="co"># axis.title.x = element_text(size = 25),</span></span>
<span id="cb27-74"><a href="#cb27-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">25</span>),</span>
<span id="cb27-75"><a href="#cb27-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb27-76"><a href="#cb27-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">"lines"</span>))</span>
<span id="cb27-77"><a href="#cb27-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-78"><a href="#cb27-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-79"><a href="#cb27-79" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Paper/Figs/High_res/graph_tide.png"</span>, plot_tide, <span class="at">height =</span> <span class="dv">8</span>, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">dpi =</span> <span class="dv">400</span>)  </span>
<span id="cb27-80"><a href="#cb27-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-81"><a href="#cb27-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-82"><a href="#cb27-82" aria-hidden="true" tabindex="-1"></a><span class="do">### emersion time processing</span></span>
<span id="cb27-83"><a href="#cb27-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-84"><a href="#cb27-84" aria-hidden="true" tabindex="-1"></a>litto_10m_df <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"Data/Litto3D/Litto_10m_merged_32630.tif"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-85"><a href="#cb27-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(<span class="at">xy=</span>T) <span class="sc">%&gt;%</span> </span>
<span id="cb27-86"><a href="#cb27-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">emersion_time =</span> <span class="cn">NA</span>,</span>
<span id="cb27-87"><a href="#cb27-87" aria-hidden="true" tabindex="-1"></a>         <span class="at">submerged_time =</span> <span class="cn">NA</span>)</span>
<span id="cb27-88"><a href="#cb27-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-89"><a href="#cb27-89" aria-hidden="true" tabindex="-1"></a>tidal_df <span class="ot">&lt;-</span> df_tide <span class="sc">%&gt;%</span> </span>
<span id="cb27-90"><a href="#cb27-90" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(date,smooth)</span>
<span id="cb27-91"><a href="#cb27-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-92"><a href="#cb27-92" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(litto_10m_df)) {</span>
<span id="cb27-93"><a href="#cb27-93" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-94"><a href="#cb27-94" aria-hidden="true" tabindex="-1"></a>  df_emerged <span class="ot">&lt;-</span> tidal_df <span class="sc">%&gt;%</span> </span>
<span id="cb27-95"><a href="#cb27-95" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(smooth <span class="sc">&lt;</span> litto_10m_df<span class="sc">$</span>bathy[i])</span>
<span id="cb27-96"><a href="#cb27-96" aria-hidden="true" tabindex="-1"></a>  df_submerged <span class="ot">&lt;-</span> tidal_df <span class="sc">%&gt;%</span> </span>
<span id="cb27-97"><a href="#cb27-97" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(smooth <span class="sc">&gt;</span> litto_10m_df<span class="sc">$</span>bathy[i])</span>
<span id="cb27-98"><a href="#cb27-98" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-99"><a href="#cb27-99" aria-hidden="true" tabindex="-1"></a>  litto_10m_df<span class="sc">$</span>emersion_time[i] <span class="ot">&lt;-</span> (<span class="fu">nrow</span>(df_emerged)<span class="sc">*</span><span class="dv">10</span>)<span class="sc">+</span><span class="dv">10</span></span>
<span id="cb27-100"><a href="#cb27-100" aria-hidden="true" tabindex="-1"></a>  litto_10m_df<span class="sc">$</span>submerged_time[i] <span class="ot">&lt;-</span> (<span class="fu">nrow</span>(df_submerged)<span class="sc">*</span><span class="dv">10</span>)<span class="sc">+</span><span class="dv">10</span></span>
<span id="cb27-101"><a href="#cb27-101" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-102"><a href="#cb27-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-103"><a href="#cb27-103" aria-hidden="true" tabindex="-1"></a>litto_cropped <span class="ot">&lt;-</span> litto_10m_df <span class="sc">%&gt;%</span> </span>
<span id="cb27-104"><a href="#cb27-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rast</span>(<span class="at">type =</span> <span class="st">"xyz"</span>, <span class="at">crs =</span> <span class="fu">crs</span>(<span class="st">"EPSG:32630"</span>))</span>
<span id="cb27-105"><a href="#cb27-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-106"><a href="#cb27-106" aria-hidden="true" tabindex="-1"></a>stk_all <span class="ot">&lt;-</span> <span class="fu">c</span>(stk,litto_cropped) <span class="sc">%&gt;%</span> </span>
<span id="cb27-107"><a href="#cb27-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_GLI =</span> GLI_before<span class="sc">-</span>GLI_after)</span>
<span id="cb27-108"><a href="#cb27-108" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(stk_all,<span class="st">"Data/Stack_all_variables.tif"</span>, <span class="at">overwrite =</span> T)</span>
<span id="cb27-109"><a href="#cb27-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-110"><a href="#cb27-110" aria-hidden="true" tabindex="-1"></a>stk_all_df <span class="ot">&lt;-</span> stk_all <span class="sc">%&gt;%</span> </span>
<span id="cb27-111"><a href="#cb27-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(<span class="at">xy =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb27-112"><a href="#cb27-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb27-113"><a href="#cb27-113" aria-hidden="true" tabindex="-1"></a>  <span class="co"># as_tibble() %&gt;% </span></span>
<span id="cb27-114"><a href="#cb27-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_GLI =</span> GLI_before <span class="sc">-</span> GLI_after,</span>
<span id="cb27-115"><a href="#cb27-115" aria-hidden="true" tabindex="-1"></a>         <span class="at">percentage_GLI =</span>  ((GLI_before <span class="sc">-</span> GLI_after)<span class="sc">/</span> GLI_before)<span class="sc">*</span><span class="dv">100</span>)</span>
<span id="cb27-116"><a href="#cb27-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-117"><a href="#cb27-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-118"><a href="#cb27-118" aria-hidden="true" tabindex="-1"></a>stk_all_df <span class="sc">%&gt;%</span> </span>
<span id="cb27-119"><a href="#cb27-119" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(NDVI_before <span class="sc">&gt;</span> <span class="fl">0.5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-120"><a href="#cb27-120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> emersion_time, <span class="at">y =</span> percentage_GLI))<span class="sc">+</span></span>
<span id="cb27-121"><a href="#cb27-121" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_density2d()</span></span>
<span id="cb27-122"><a href="#cb27-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb27-123"><a href="#cb27-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"gam"</span>)<span class="sc">+</span></span>
<span id="cb27-124"><a href="#cb27-124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">150</span>))</span>
<span id="cb27-125"><a href="#cb27-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-126"><a href="#cb27-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-127"><a href="#cb27-127" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> stk_all_df <span class="sc">%&gt;%</span> </span>
<span id="cb27-128"><a href="#cb27-128" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(NDVI_before <span class="sc">&gt;</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> emersion_time <span class="sc">&gt;</span> <span class="dv">5900</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-129"><a href="#cb27-129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rast</span>(<span class="at">type =</span> <span class="st">"xyz"</span>, <span class="at">crs =</span> <span class="fu">crs</span>(<span class="st">"EPSG:32630"</span>))</span>
<span id="cb27-130"><a href="#cb27-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-131"><a href="#cb27-131" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(test,<span class="st">"test.tif"</span>)</span>
<span id="cb27-132"><a href="#cb27-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-133"><a href="#cb27-133" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(stk_all_df<span class="sc">$</span>percentage_GLI <span class="sc">~</span> stk_all_df<span class="sc">$</span>emersion_time)</span>
<span id="cb27-134"><a href="#cb27-134" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [26]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>zoom1 <span class="ot">&lt;-</span> <span class="st">"Data/shp/zoom_bathy_insert.shp"</span> <span class="sc">%&gt;%</span> </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_sf</span>()</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>coltab <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"bathy_color"</span> <span class="ot">=</span> <span class="st">"goldenrod2"</span>)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>RGB_comp <span class="ot">&lt;-</span> <span class="st">"Data/Sentinel2/after_RGB_comp.tif"</span> <span class="sc">%&gt;%</span> </span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">rast</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">crop</span>(msk)</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>lims <span class="ot">&lt;-</span> <span class="fu">ext</span>(RGB_comp)</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>segment_bathy<span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">x1 =</span> <span class="fu">c</span>(<span class="dv">490415</span>, <span class="dv">490816</span>),</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>                     <span class="at">x2 =</span> <span class="fu">c</span>(<span class="dv">490760</span>,<span class="dv">491554</span>),</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y1 =</span> <span class="fu">c</span>(<span class="dv">5271168</span>,<span class="dv">5271168</span>),</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y2 =</span> <span class="fu">c</span>(<span class="dv">5270760</span>,<span class="dv">5270762</span>),</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>                     <span class="at">id =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the main plot</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>main_plot_bathy <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spatraster_rgb</span>(<span class="at">data =</span> RGB_comp,<span class="at">interpolate =</span> F,<span class="at">max_col_value =</span> <span class="dv">220</span> ) <span class="sc">+</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> bathy_line, <span class="fu">aes</span>(<span class="at">color =</span> <span class="st">"bathy_color"</span>), <span class="at">linewidth =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> zoom1, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">fill =</span> <span class="cn">NA</span>,<span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>)<span class="sc">+</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> segment_bathy, <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">xend =</span> x2, <span class="at">y =</span> y1, <span class="at">yend =</span> y2, <span class="at">group =</span> id), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="fl">0.8</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>)<span class="sc">+</span></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">490200</span>, <span class="at">y =</span> <span class="dv">5271680</span>, <span class="at">label =</span> <span class="st">"A"</span>), <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">10</span>)<span class="sc">+</span></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> lims[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="at">ylim =</span> lims[<span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>], <span class="at">expand =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> coltab,</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>                     <span class="at">label =</span> <span class="st">"3.9 meter"</span>,</span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>                     <span class="at">name =</span> <span class="st">"Bathymetry Isobar"</span>) <span class="sc">+</span></span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_Bede_Map</span>() <span class="sc">+</span></span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.95</span>, <span class="fl">0.98</span>),</span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="fu">alpha</span>(<span class="st">"white"</span>, <span class="fl">0.5</span>)),</span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>),</span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>,<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">angle =</span> <span class="dv">90</span>),</span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()</span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a>zoom1_bbox <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(zoom1)</span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the inset plot</span></span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a>inset_plot_bathy <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spatraster_rgb</span>(<span class="at">data =</span> RGB_comp,<span class="at">interpolate =</span> F,<span class="at">max_col_value =</span> <span class="dv">150</span> ) <span class="sc">+</span></span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> bathy_line, <span class="fu">aes</span>(<span class="at">color =</span> <span class="st">"bathy_color"</span>), <span class="at">linewidth =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> zoom1, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">linewidth =</span> <span class="dv">2</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>)<span class="sc">+</span></span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(</span>
<span id="cb28-52"><a href="#cb28-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(zoom1_bbox<span class="sc">$</span>xmin, zoom1_bbox<span class="sc">$</span>xmax),</span>
<span id="cb28-53"><a href="#cb28-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(zoom1_bbox<span class="sc">$</span>ymin, zoom1_bbox<span class="sc">$</span>ymax),</span>
<span id="cb28-54"><a href="#cb28-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="cn">FALSE</span></span>
<span id="cb28-55"><a href="#cb28-55" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb28-56"><a href="#cb28-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> coltab,</span>
<span id="cb28-57"><a href="#cb28-57" aria-hidden="true" tabindex="-1"></a>                     <span class="at">label =</span> <span class="st">"1m bathymetry"</span>,</span>
<span id="cb28-58"><a href="#cb28-58" aria-hidden="true" tabindex="-1"></a>                     <span class="at">name =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb28-59"><a href="#cb28-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span>  <span class="co"># Remove axes and background for the inset</span></span>
<span id="cb28-60"><a href="#cb28-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)  <span class="co"># Remove legend from the inset</span></span>
<span id="cb28-61"><a href="#cb28-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-62"><a href="#cb28-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the main plot and the inset plot</span></span>
<span id="cb28-63"><a href="#cb28-63" aria-hidden="true" tabindex="-1"></a>final_plot <span class="ot">&lt;-</span> <span class="fu">ggdraw</span>() <span class="sc">+</span></span>
<span id="cb28-64"><a href="#cb28-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">draw_plot</span>(main_plot_bathy) <span class="sc">+</span></span>
<span id="cb28-65"><a href="#cb28-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">draw_plot</span>(</span>
<span id="cb28-66"><a href="#cb28-66" aria-hidden="true" tabindex="-1"></a>    inset_plot_bathy,</span>
<span id="cb28-67"><a href="#cb28-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fl">0.95</span>,     <span class="co"># X position of the inset (adjust as needed)</span></span>
<span id="cb28-68"><a href="#cb28-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fl">0.75</span>,     <span class="co"># Y position of the inset (adjust as needed)</span></span>
<span id="cb28-69"><a href="#cb28-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="fl">0.45</span>,  <span class="co"># Width of the inset (adjust as needed)</span></span>
<span id="cb28-70"><a href="#cb28-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">height =</span> <span class="fl">0.45</span>, <span class="co"># Height of the inset (adjust as needed)</span></span>
<span id="cb28-71"><a href="#cb28-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="dv">1</span>,</span>
<span id="cb28-72"><a href="#cb28-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="dv">1</span></span>
<span id="cb28-73"><a href="#cb28-73" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-74"><a href="#cb28-74" aria-hidden="true" tabindex="-1"></a><span class="co"># print(final_plot)</span></span>
<span id="cb28-75"><a href="#cb28-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-76"><a href="#cb28-76" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Paper/Figs/High_res/Map_bathy.png"</span>,final_plot, <span class="at">width =</span> <span class="dv">5</span>, <span class="at">height =</span> <span class="dv">9</span>, <span class="at">dpi =</span> <span class="dv">400</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [27]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>zoom2 <span class="ot">&lt;-</span> <span class="st">"Data/shp/zoom_bathy_insert.shp"</span> <span class="sc">%&gt;%</span> </span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_sf</span>()</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co"># coltab_darkening &lt;- c("darkseagrass" = c("#436EEE"))</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>coltab_darkening <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"darkseagrass"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"#009ACD"</span>))</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>segment_darkening<span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">x1 =</span> <span class="fu">c</span>(<span class="dv">490524</span>, <span class="dv">490925</span>),</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>                     <span class="at">x2 =</span> <span class="fu">c</span>(<span class="dv">490797</span>,<span class="dv">491540</span>),</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y1 =</span> <span class="fu">c</span>(<span class="dv">5269905</span>,<span class="dv">5269905</span>),</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y2 =</span> <span class="fu">c</span>(<span class="dv">5270467</span>,<span class="dv">5270448</span>),</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>                     <span class="at">id =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>main_plot_darkening <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spatraster_rgb</span>(<span class="at">data =</span> RGB_comp,<span class="at">interpolate =</span> F,<span class="at">max_col_value =</span> <span class="dv">220</span> ) <span class="sc">+</span></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> sf_darkseagrass, <span class="fu">aes</span>(<span class="at">color =</span> <span class="st">"darkseagrass"</span>, <span class="at">fill =</span> <span class="st">"darkseagrass"</span>), <span class="at">linewidth =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> bathy_line, <span class="at">color =</span> <span class="st">"goldenrod2"</span>, <span class="at">linewidth =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> zoom2, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">fill =</span> <span class="cn">NA</span>,<span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>)<span class="sc">+</span></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> segment_bathy, <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">xend =</span> x2, <span class="at">y =</span> y1, <span class="at">yend =</span> y2, <span class="at">group =</span> id), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="fl">0.8</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>)<span class="sc">+</span></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">490200</span>, <span class="at">y =</span> <span class="dv">5271680</span>, <span class="at">label =</span> <span class="st">"B"</span>), <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">10</span>)<span class="sc">+</span></span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> lims[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="at">ylim =</span> lims[<span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>], </span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>           <span class="at">expand =</span> <span class="cn">FALSE</span>,</span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>          <span class="at">label_axes =</span> <span class="fu">list</span>(</span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>          <span class="at">bottom =</span> <span class="st">"E"</span>, <span class="at">right =</span> <span class="st">"N"</span></span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>           )) <span class="sc">+</span></span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> coltab_darkening,</span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>                     <span class="at">label =</span> <span class="st">"Dark Patches"</span>,</span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a>                     <span class="at">name =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> coltab_darkening,</span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a>                     <span class="at">label =</span> <span class="st">"Dark Patches"</span>,</span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a>                     <span class="at">name =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_Bede_Map</span>() <span class="sc">+</span></span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.95</span>, <span class="fl">0.98</span>),</span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="fu">alpha</span>(<span class="st">"white"</span>, <span class="fl">0.5</span>)),</span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>),</span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># axis.text.y = element_text(vjust = 0.5,hjust = 0.5, angle = 90),</span></span>
<span id="cb29-48"><a href="#cb29-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y.right =</span> <span class="fu">element_text</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>,<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">angle =</span> <span class="dv">90</span>),</span>
<span id="cb29-49"><a href="#cb29-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb29-50"><a href="#cb29-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()</span>
<span id="cb29-51"><a href="#cb29-51" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-52"><a href="#cb29-52" aria-hidden="true" tabindex="-1"></a>main_plot_darkening</span>
<span id="cb29-53"><a href="#cb29-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-54"><a href="#cb29-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-55"><a href="#cb29-55" aria-hidden="true" tabindex="-1"></a>zoom2_bbox <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(zoom2)</span>
<span id="cb29-56"><a href="#cb29-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-57"><a href="#cb29-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the inset plot</span></span>
<span id="cb29-58"><a href="#cb29-58" aria-hidden="true" tabindex="-1"></a>inset_plot_darkening <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb29-59"><a href="#cb29-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spatraster_rgb</span>(<span class="at">data =</span> RGB_comp,<span class="at">interpolate =</span> F,<span class="at">max_col_value =</span> <span class="dv">150</span> ) <span class="sc">+</span></span>
<span id="cb29-60"><a href="#cb29-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> sf_darkseagrass, <span class="fu">aes</span>(<span class="at">color =</span> <span class="st">"darkseagrass"</span>, <span class="at">fill =</span> <span class="st">"darkseagrass"</span>), <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">linewidth =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb29-61"><a href="#cb29-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> bathy_line, <span class="at">color =</span> <span class="st">"goldenrod2"</span>, <span class="at">linewidth =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb29-62"><a href="#cb29-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> zoom2, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">linewidth =</span> <span class="dv">2</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>)<span class="sc">+</span></span>
<span id="cb29-63"><a href="#cb29-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(</span>
<span id="cb29-64"><a href="#cb29-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(zoom2_bbox<span class="sc">$</span>xmin, zoom2_bbox<span class="sc">$</span>xmax),</span>
<span id="cb29-65"><a href="#cb29-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(zoom2_bbox<span class="sc">$</span>ymin, zoom2_bbox<span class="sc">$</span>ymax),</span>
<span id="cb29-66"><a href="#cb29-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="cn">FALSE</span></span>
<span id="cb29-67"><a href="#cb29-67" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb29-68"><a href="#cb29-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> coltab_darkening,</span>
<span id="cb29-69"><a href="#cb29-69" aria-hidden="true" tabindex="-1"></a>                     <span class="at">label =</span> <span class="st">"Dark Patches"</span>,</span>
<span id="cb29-70"><a href="#cb29-70" aria-hidden="true" tabindex="-1"></a>                     <span class="at">name =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb29-71"><a href="#cb29-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> coltab_darkening,</span>
<span id="cb29-72"><a href="#cb29-72" aria-hidden="true" tabindex="-1"></a>                     <span class="at">label =</span> <span class="st">"Dark Patches"</span>,</span>
<span id="cb29-73"><a href="#cb29-73" aria-hidden="true" tabindex="-1"></a>                     <span class="at">name =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb29-74"><a href="#cb29-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span>  <span class="co"># Remove axes and background for the inset</span></span>
<span id="cb29-75"><a href="#cb29-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)  <span class="co"># Remove legend from the inset</span></span>
<span id="cb29-76"><a href="#cb29-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-77"><a href="#cb29-77" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the main plot and the inset plot</span></span>
<span id="cb29-78"><a href="#cb29-78" aria-hidden="true" tabindex="-1"></a>final_plot <span class="ot">&lt;-</span> <span class="fu">ggdraw</span>() <span class="sc">+</span></span>
<span id="cb29-79"><a href="#cb29-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">draw_plot</span>(main_plot_darkening) <span class="sc">+</span></span>
<span id="cb29-80"><a href="#cb29-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">draw_plot</span>(</span>
<span id="cb29-81"><a href="#cb29-81" aria-hidden="true" tabindex="-1"></a>    inset_plot_darkening,</span>
<span id="cb29-82"><a href="#cb29-82" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fl">0.9</span>,     <span class="co"># X position of the inset (adjust as needed)</span></span>
<span id="cb29-83"><a href="#cb29-83" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fl">0.75</span>,     <span class="co"># Y position of the inset (adjust as needed)</span></span>
<span id="cb29-84"><a href="#cb29-84" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="fl">0.45</span>,  <span class="co"># Width of the inset (adjust as needed)</span></span>
<span id="cb29-85"><a href="#cb29-85" aria-hidden="true" tabindex="-1"></a>    <span class="at">height =</span> <span class="fl">0.45</span>,</span>
<span id="cb29-86"><a href="#cb29-86" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="dv">1</span>,</span>
<span id="cb29-87"><a href="#cb29-87" aria-hidden="true" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="dv">1</span><span class="co"># Height of the inset (adjust as needed)</span></span>
<span id="cb29-88"><a href="#cb29-88" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-89"><a href="#cb29-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-90"><a href="#cb29-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-91"><a href="#cb29-91" aria-hidden="true" tabindex="-1"></a><span class="co"># print(final_plot)</span></span>
<span id="cb29-92"><a href="#cb29-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-93"><a href="#cb29-93" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Paper/Figs/High_res/Map_darkening.png"</span>,final_plot, <span class="at">width =</span> <span class="dv">5</span>, <span class="at">height =</span> <span class="dv">9</span>, <span class="at">dpi =</span> <span class="dv">400</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [28]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>plt1 <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"Paper/Figs/High_res/Map_bathy.png"</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">values</span>(plt1)[<span class="fu">values</span>(plt1<span class="sc">$</span>Map_bathy_4)<span class="sc">==</span><span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>plt2 <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"Paper/Figs/High_res/Map_darkening.png"</span>)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="fu">values</span>(plt2)[<span class="fu">values</span>(plt2<span class="sc">$</span>Map_darkening_4)<span class="sc">==</span><span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ext</span>(plt2)[<span class="dv">1</span>]<span class="ot">&lt;-</span><span class="fu">ext</span>(plt2)[<span class="dv">1</span>]<span class="sc">+</span><span class="fu">ext</span>(plt1)[<span class="dv">2</span>]<span class="sc">-</span><span class="dv">100</span> </span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ext</span>(plt2)[<span class="dv">2</span>]<span class="ot">&lt;-</span><span class="fu">ext</span>(plt2)[<span class="dv">2</span>]<span class="sc">+</span><span class="fu">ext</span>(plt1)[<span class="dv">2</span>]<span class="sc">-</span><span class="dv">100</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>plt_combine <span class="ot">&lt;-</span> <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spatraster_rgb</span>(<span class="at">data =</span> plt2, <span class="at">maxcell =</span> <span class="fu">ext</span>(plt1)[<span class="dv">2</span>]<span class="sc">*</span><span class="fu">ext</span>(plt1)[<span class="dv">4</span>])<span class="sc">+</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spatraster_rgb</span>(<span class="at">data =</span> plt1, <span class="at">maxcell =</span> <span class="fu">ext</span>(plt1)[<span class="dv">2</span>]<span class="sc">*</span><span class="fu">ext</span>(plt1)[<span class="dv">4</span>])<span class="sc">+</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">expand =</span> F)<span class="sc">+</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()<span class="sc">+</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>( <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>))</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Paper/Figs/High_res/Map_darkening_Bathy.png"</span>,plt_combine, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="fl">9.35</span>, <span class="at">dpi =</span> <span class="dv">400</span>)</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Paper/Figs/Low_res/Map_darkening_Bathy.png"</span>,plt_combine, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="fl">9.35</span>, <span class="at">dpi =</span> <span class="dv">200</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [29]:</pre></div><div id="cell-fig-Map_darkening_Bathy" class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"Figs/Low_res/Map_darkening_Bathy.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-Map_darkening_Bathy" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-Map_darkening_Bathy-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="">
<a href="Figs/Low_res/Map_darkening_Bathy.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8" title="Figure&nbsp;8: Map of the Darkening of seagrasses during the heatwave events of September 2021 in Quiberon. A: 1m bathymetry isobar (golden line); B: Result of the detection of darkened seagrass patches (Blue plolygons)"><img src="Figs/Low_res/Map_darkening_Bathy.png" class="img-fluid figure-img" style="width:100.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Map_darkening_Bathy-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: Map of the Darkening of seagrasses during the heatwave events of September 2021 in Quiberon. A: 1m bathymetry isobar (golden line); B: Result of the detection of darkened seagrass patches (Blue plolygons)
</figcaption>
</figure>
</div>
</div>
</div></div>
</section>
</section>
</section>
<section id="bibliography" class="level1 unnumbered" data-number="4">
<h1 class="unnumbered" data-number="4"><span class="header-section-number">4</span> Bibliography</h1>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-akbar2020mangrove" class="csl-entry" role="listitem">
Akbar, M., Arisanto, P., Sukirno, B., Merdeka, P., Priadhi, M., Zallesa, S., 2020. Mangrove vegetation health index analysis by implementing NDVI (normalized difference vegetation index) classification method on sentinel-2 image data case study: Segara anakan, kabupaten cilacap, in: IOP Conference Series: Earth and Environmental Science. IOP Publishing, p. 012069.
</div>
<div id="ref-carlan2020identifying" class="csl-entry" role="listitem">
Cârlan, I., Mihai, B.-A., Nistor, C., Große-Stoltenberg, A., 2020. Identifying urban vegetation stress factors based on open access remote sensing imagery and field observations. Ecological Informatics 55, 101032.
</div>
<div id="ref-CMEMS_1" class="csl-entry" role="listitem">
CMEMS, 2024. European north west shelf/iberia biscay irish seas – high resolution ODYSSEA sea surface temperature multi-sensor L3 observations reprocessed, e.u. Copernicus marine service information (CMEMS). Marine data store (MDS). (Accessed on 17-10-2024). <a href="https://doi.org/10.48670/moi-00311">https://doi.org/10.48670/moi-00311</a>
</div>
<div id="ref-deguette2022physiological" class="csl-entry" role="listitem">
Deguette, A., Barrote, I., Silva, J., 2022. Physiological and morphological effects of a marine heatwave on the seagrass cymodocea nodosa. Scientific Reports 12, 7950.
</div>
<div id="ref-sen2cor" class="csl-entry" role="listitem">
European Space Agency, 2024b. Sen2Cor: Sentinel-2 atmospheric correction processor.
</div>
<div id="ref-copernicus_sentinel2" class="csl-entry" role="listitem">
European Space Agency, 2024a. Copernicus open access hub.
</div>
<div id="ref-gardner2018global" class="csl-entry" role="listitem">
Gardner, R.C., Finlayson, C., 2018. Global wetland outlook: State of the world’s wetlands and their services to people, in: Ramsar Convention Secretariat. pp. 2020–5.
</div>
<div id="ref-guerrero2020heat" class="csl-entry" role="listitem">
Guerrero-Meseguer, L., Marı́n, A., Sanz-Lázaro, C., 2020. Heat wave intensity can vary the cumulative effects of multiple environmental stressors on posidonia oceanica seedlings. Marine Environmental Research 159, 105001.
</div>
<div id="ref-hobday2016hierarchical" class="csl-entry" role="listitem">
Hobday, A.J., Alexander, L.V., Perkins, S.E., Smale, D.A., Straub, S.C., Oliver, E.C., Benthuysen, J.A., Burrows, M.T., Donat, M.G., Feng, M., others, 2016. A hierarchical approach to defining marine heatwaves. Progress in oceanography 141, 227–238.
</div>
<div id="ref-hobday2018categorizing" class="csl-entry" role="listitem">
Hobday, A.J., Oliver, E.C., Gupta, A.S., Benthuysen, J.A., Burrows, M.T., Donat, M.G., Holbrook, N.J., Moore, P.J., Thomsen, M.S., Wernberg, T., others, 2018. Categorizing and naming marine heatwaves. Oceanography 31, 162–173.
</div>
<div id="ref-huete2012vegetation" class="csl-entry" role="listitem">
Huete, A.R., 2012. Vegetation indices, remote sensing and forest monitoring. Geography Compass 6, 513–532.
</div>
<div id="ref-ioc_sea_level_lecy" class="csl-entry" role="listitem">
IOC, 2024. Intergovernmental oceanographic commission ; sea level monitoring station - le conquet, france (LECY).
</div>
<div id="ref-jankowska2019stabilizing" class="csl-entry" role="listitem">
Jankowska, E., Michel, L.N., Lepoint, G., Włodarska-Kowalczuk, M., 2019. Stabilizing effects of seagrass meadows on coastal water benthic food webs. Journal of Experimental Marine Biology and Ecology 510, 54–63.
</div>
<div id="ref-kloos2021agricultural" class="csl-entry" role="listitem">
Kloos, S., Yuan, Y., Castelli, M., Menzel, A., 2021. Agricultural drought detection with MODIS based vegetation health indices in southeast germany. Remote Sensing 13, 3907.
</div>
<div id="ref-louhaichi2001spatially" class="csl-entry" role="listitem">
Louhaichi, M., Borman, M.M., Johnson, D.E., 2001. Spatially located platform and aerial photography for documentation of grazing impacts on wheat. Geocarto International 16, 65–70.
</div>
<div id="ref-papathanasopoulou2019satellite" class="csl-entry" role="listitem">
Papathanasopoulou, E., Simis, S., Alikas, K., Ansper, A., Anttila, J., Barillé, A., Barillé, L., Brando, V., Bresciani, M., Bučas, M., others, 2019. Satellite-assisted monitoring of water quality to support the implementation of the water framework directive. EOMORES white paper.
</div>
<div id="ref-perkins2013measurement" class="csl-entry" role="listitem">
Perkins, S.E., Alexander, L.V., 2013. On the measurement of heat waves. Journal of climate 26, 4500–4517.
</div>
<div id="ref-ramesh2020seagrass" class="csl-entry" role="listitem">
Ramesh, C., Mohanraju, R., 2020. Seagrass ecosystems of andaman and nicobar islands: Status and future perspective. Environmental &amp; Earth Sciences Research Journal 7.
</div>
<div id="ref-rouse1974monitoring" class="csl-entry" role="listitem">
Rouse, J.W., Haas, R.H., Schell, J.A., Deering, D.W., others, 1974. Monitoring vegetation systems in the great plains with ERTS. NASA Spec. Publ 351, 309.
</div>
<div id="ref-sawall2021chronically" class="csl-entry" role="listitem">
Sawall, Y., Ito, M., Pansch, C., 2021. Chronically elevated sea surface temperatures revealed high susceptibility of the eelgrass zostera marina to winter and spring warming. Limnology and Oceanography 66, 4112–4124.
</div>
<div id="ref-schlegel2017nearshore" class="csl-entry" role="listitem">
Schlegel, R.W., Oliver, E.C., Wernberg, T., Smit, A.J., 2017. Nearshore and offshore co-occurrence of marine heatwaves and cold-spells. Progress in Oceanography 151, 189–205.
</div>
<div id="ref-heatwaveR" class="csl-entry" role="listitem">
Schlegel, R.W., Smit, A.J., 2018. <span class="nocase">heatwaveR</span>: A central algorithm for the detection of heatwaves and cold-spells. Journal of Open Source Software 3, 821. <a href="https://doi.org/10.21105/joss.00821">https://doi.org/10.21105/joss.00821</a>
</div>
<div id="ref-scott2018role" class="csl-entry" role="listitem">
Scott, A.L., York, P.H., Duncan, C., Macreadie, P.I., Connolly, R.M., Ellis, M.T., Jarvis, J.C., Jinks, K.I., Marsh, H., Rasheed, M.A., 2018. The role of herbivory in structuring tropical seagrass ecosystem service delivery. Frontiers in Plant Science 9, 127.
</div>
<div id="ref-sevgi2022bitkilerde" class="csl-entry" role="listitem">
Sevgi, K., Leblebici, S., 2022. Bitkilerde a<span>ğ</span><span>ı</span>r metal stresine verilen fizyolojik ve molek<span>ü</span>ler yan<span>ı</span>tlar. Journal of Anatolian Environmental and Animal Sciences 7, 528–536.
</div>
<div id="ref-shom_ram_2022" class="csl-entry" role="listitem">
Shom, 2022. <a href="https://diffusion.shom.fr/references-altimetriques-maritimes-ram.html">Service hydrographique et océanographique de la marine ; références altimétriques maritimes: Ports de france métropolitaine et d’outre-mer, cotes du zéro hydrographique et niveaux caractéristiques de la marée</a>. Shom, Brest, France.
</div>
<div id="ref-shom_bathymetry_litto3d_bzh_2018_2021" class="csl-entry" role="listitem">
SHOM, 2021. Service hydrographique et océanographique de la marine ; bathymétrie Litto3D® bretagne 2018-2021.
</div>
<div id="ref-simpson2016distribution" class="csl-entry" role="listitem">
Simpson, T.S., Wernberg, T., McDonald, J.I., 2016. Distribution and localised effects of the invasive ascidian didemnum perlucidum (monniot 1983) in an urban estuary. PLoS One 11, e0154201.
</div>
<div id="ref-sousa2019blue" class="csl-entry" role="listitem">
Sousa, A.I., Silva, J.F. da, Azevedo, A., Lillebø, A.I., 2019. Blue carbon stock in zostera noltei meadows at ria de aveiro coastal lagoon (portugal) over a decade. Scientific reports 9, 14387.
</div>
<div id="ref-thomsen2023meadow" class="csl-entry" role="listitem">
Thomsen, E., Herbeck, L.S., Viana, I.G., Jennerjahn, T.C., 2023. Meadow trophic status regulates the nitrogen filter function of tropical seagrasses in seasonally eutrophic coastal waters. Limnology and Oceanography 68, 1906–1919.
</div>
<div id="ref-unsworth2022planetary" class="csl-entry" role="listitem">
Unsworth, R.K., Cullen-Unsworth, L.C., Jones, B.L., Lilley, R.J., 2022. The planetary role of seagrass conservation. Science 377, 609–613.
</div>
<div id="ref-waycott2009accelerating" class="csl-entry" role="listitem">
Waycott, M., Duarte, C.M., Carruthers, T.J., Orth, R.J., Dennison, W.C., Olyarnik, S., Calladine, A., Fourqurean, J.W., Heck Jr, K.L., Hughes, A.R., others, 2009. Accelerating loss of seagrasses across the globe threatens coastal ecosystems. Proceedings of the national academy of sciences 106, 12377–12381.
</div>
<div id="ref-winters2011effects" class="csl-entry" role="listitem">
Winters, G., Nelle, P., Fricke, B., Rauch, G., Reusch, T.B., 2011. Effects of a simulated heat wave on photophysiology and gene expression of high-and low-latitude populations of zostera marina. Marine Ecology Progress Series 435, 83–95.
</div>
<div id="ref-zoffoli2021decadal" class="csl-entry" role="listitem">
Zoffoli, M.L., Gernez, P., Godet, L., Peters, S., Oiry, S., Barillé, L., 2021. Decadal increase in the ecological status of a north-atlantic intertidal seagrass meadow observed with multi-mission satellite time-series. Ecological Indicators 130, 108033.
</div>
<div id="ref-zoffoli2023remote" class="csl-entry" role="listitem">
Zoffoli, M.L., Gernez, P., Oiry, S., Godet, L., Dalloyau, S., Davies, B.F.R., Barillé, L., 2023. Remote sensing in seagrass ecology: Coupled dynamics between migratory herbivorous birds and intertidal meadows observed by satellite during four decades. Remote Sensing in Ecology and Conservation 9, 420–433.
</div>
<div id="ref-zoffoli2020sentinel" class="csl-entry" role="listitem">
Zoffoli, M.L., Gernez, P., Rosa, P., Le Bris, A., Brando, V.E., Barillé, A.-L., Harin, N., Peters, S., Poser, K., Spaias, L., others, 2020. Sentinel-2 remote sensing of zostera noltei-dominated intertidal seagrass meadows. Remote Sensing of Environment 251, 112020.
</div>
</div>
</section>
     </main>
<!-- /main column -->  <script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>  </div> <!-- /content -->  <script>var lightboxQuarto = GLightbox({"loop":false,"closeEffect":"zoom","selector":".lightbox","descPosition":"bottom","openEffect":"zoom"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script> 
  
</body></html>